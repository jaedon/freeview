
/* *************************************************************************************************** */
#define ___HEADER________________________________________________________________________________________
/* *************************************************************************************************** */

#include <hlib.h>


#include "_cp_internal.h"

/* *************************************************************************************************** */
#define ___GLOBAL_HEADER_________________________________________________________________________________
/* *************************************************************************************************** */


/* *************************************************************************************************** */
#define ___DEFINE________________________________________________________________________________________
/* *************************************************************************************************** */


/* *************************************************************************************************** */
#define ___TYPEDEF_______________________________________________________________________________________
/* *************************************************************************************************** */


/* *************************************************************************************************** */
#define ___STATIC_VARIABLES______________________________________________________________________________
/* *************************************************************************************************** */

//1 National Option Character Subsets

static const HUINT16	s_Nos[eHxCP_TELETEXT_G0_LATIN + 1][13] =
{
	// English
	{0x00A3, 0x0024, 0x0040, 0x2190, 0x00BD, 0x2192, 0x2191, 0x0023, 0x2015, 0x00BC, 0x01C1, 0x00BE, 0x00F7},
	// German
	{0x0023, 0x0024, 0x00A7, 0x00C4, 0x00D6, 0x00DC, 0x005E, 0x005F, 0x00B0, 0x00E4, 0x00F6, 0x00FC, 0x03B2},
	// Swedish / Finnish / Hungarian
	{0x0023, 0x00A4, 0x00C9, 0x00C4, 0x00D6, 0x00C5, 0x00DC, 0x005F, 0x00E9, 0x00E4, 0x00F6, 0x00E5, 0x00FC},
	// Italian
	{0x00A3, 0x0024, 0x00E9, 0x00B0, 0x00E7, 0x2192, 0x2191, 0x0023, 0x00F9, 0x00E0, 0x00F2, 0x00E8, 0x00EC},
	// French
	{0x00E9, 0x00EF, 0x00E0, 0x00EB, 0x00EA, 0x00F9, 0x00EE, 0x0023, 0x00E8, 0x00E2, 0x00F4, 0x00FB, 0x00E7},
	// Portuguese / Spanish
	{0x00E7, 0x0024, 0x0069, 0x00E1, 0x00E9, 0x00ED, 0x00F3, 0x00FA, 0x00BF, 0x00FC, 0x00F1, 0x00E8, 0x00E0},
	// Czech / Slovak
	{0x0023, 0x016F, 0x010D, 0xF802, 0x017E, 0x00FD, 0x00ED, 0x0159, 0x00E9, 0x00E1, 0x011B, 0x00FA, 0x0161},
	// Polish
	{0x0023, 0x0144, 0x0105, 0x01B5, 0x015A, 0x0141, 0x0107, 0x00F3, 0x0119, 0x017C, 0x015B, 0x0142, 0x017A},
	// Estonian
	{0x0023, 0x00F5, 0x0160, 0x00C4, 0x00D6, 0x017D, 0x00DC, 0x00D5, 0x0161, 0x00E4, 0x00F6, 0x017E, 0x00FC},
	// Lettish, Lithuanian
	{0x0023, 0x0024, 0x0160, 0x0117, 0x0229, 0x017D, 0x010D, 0x016B, 0x0161, 0x0105, 0x0173, 0x017E, 0xF800},
	// Rumanian
	{0x0023, 0x00A4, 0x0162, 0x00C2, 0x015E, 0x01CD, 0x00CE, 0x0131, 0x0163, 0x00E2, 0x015F, 0x01CE, 0x00EE},
	// Serbian / Croatian / Slovenian
	{0x0023, 0x00CB, 0x010C, 0x0106, 0x017D, 0x0110, 0x0160, 0x00EB, 0x010D, 0x0107, 0x017E, 0x0111, 0x0161},
	// Turkish
	{0xF801, 0x01E7, 0x0130, 0x015E, 0x00D6, 0x00C7, 0x00DC, 0x01E6, 0x0131, 0x015F, 0x00F6, 0x00E7, 0x00FC},
	// Empty
	{0xFFFD, 0xFFFD, 0xFFFD, 0xFFFD, 0xFFFD, 0xFFFD, 0xFFFD, 0xFFFD, 0xFFFD, 0xFFFD, 0xFFFD, 0xFFFD, 0xFFFD}
};

static const HUINT8 	s_NosIndex[] = {
	0x23, 0x24, 0x40, 0x5B, 0x5C, 0x5D, 0x5E, 0x5F, 0x60, 0x7B, 0x7C, 0x7D, 0x7E
};


//1 Composite Character Map

static const HUINT16	s_CompositeChar_Latin_UPPER[26][16] = 	// [A-Z][Diacritical Marks]
{
	{0x0041, 0x00C0, 0x00C1, 0x00C2, 0x00C3, 0x0100, 0x0102, 0x0226, 0x00C4, 0x0000, 0x00C5, 0x0000, 0x0000, 0x0000, 0x0104, 0x01CD},
	{0x0042, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x0043, 0x0000, 0x0106, 0x0108, 0x0000, 0x0000, 0x0000, 0x010A, 0x0000, 0x0000, 0x0000, 0x00C7, 0x0000, 0x0000, 0x0000, 0x010C},
	{0x0044, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x010E},
	{0x0045, 0x00C8, 0x00C9, 0x00CA, 0x0000, 0x0112, 0x0114, 0x0116, 0x00CB, 0x0000, 0x0000, 0x0228, 0x0000, 0x0000, 0x0118, 0x011A},
	{0x0046, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x0047, 0x0000, 0x01F4, 0x011C, 0x0000, 0x0000, 0x011E, 0x0120, 0x0000, 0x0000, 0x0000, 0x0122, 0x0000, 0x0000, 0x0000, 0x01E6},
	{0x0048, 0x0000, 0x0000, 0x0124, 0x0000, 0x0126, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x021E},
	{0x0049, 0x00CC, 0x00CD, 0x00CE, 0x0128, 0x012A, 0x012C, 0x0130, 0x00CF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x012E, 0x01CF},
	{0x004A, 0x0000, 0x0000, 0x0134, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x004B, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0136, 0x0000, 0x0000, 0x0000, 0x01E8},
	{0x004C, 0x0000, 0x0139, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x013B, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x004D, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x004E, 0x01F8, 0x0143, 0x0000, 0x00D1, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0145, 0x0000, 0x0000, 0x0000, 0x0147},
	{0x004F, 0x00D2, 0x00D3, 0x00D4, 0x00D5, 0x014C, 0x014E, 0x022E, 0x00D6, 0x0000, 0x0000, 0x0000, 0x0000, 0x0150, 0x01EA, 0x01D1},
	{0x0050, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x0051, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x0052, 0x0000, 0x0154, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0156, 0x0000, 0x0000, 0x0000, 0x0158},
	{0x0053, 0x0000, 0x015A, 0x015C, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x015E, 0x0000, 0x0000, 0x0000, 0x0160},
	{0x0054, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0162, 0x0000, 0x0000, 0x0000, 0x0164},
	{0x0055, 0x00D9, 0x00DA, 0x00DB, 0x0168, 0x016A, 0x016C, 0x0000, 0x00DC, 0x0000, 0x016E, 0x0000, 0x0000, 0x0170, 0x0172, 0x01D3},
	{0x0056, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x0057, 0x0000, 0x0000, 0x0174, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x0058, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x0059, 0x1EF2, 0x00DD, 0x0176, 0x1EF8, 0x0232, 0x0000, 0x0000, 0x0178, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x005A, 0x0000, 0x0179, 0x0000, 0x0000, 0x0000, 0x0000, 0x017B, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x017D}
};


static const HUINT16	s_CompositeChar_Latin_LOWER[26][16] = 	// [a-z][Diacritical Marks]
{
	{0x0061, 0x00E0, 0x00E1, 0x00E2, 0x00E3, 0x0101, 0x0103, 0x0227, 0x00E4, 0x0000, 0x00E5, 0x0000, 0x0000, 0x0000, 0x0105, 0x01CE},
	{0x0062, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x0063, 0x0000, 0x0107, 0x0109, 0x0000, 0x0000, 0x0000, 0x010B, 0x0000, 0x0000, 0x0000, 0x00E7, 0x0000, 0x0000, 0x0000, 0x010D},
	{0x0064, 0x0000, 0x010F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x0065, 0x00E8, 0x00E9, 0x00EA, 0x0000, 0x0113, 0x0115, 0x0117, 0x00EB, 0x0000, 0x0000, 0x0229, 0x0000, 0x0000, 0x0119, 0x011B},
	{0x0066, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x0067, 0x0000, 0x01F5, 0x011D, 0x0000, 0x0000, 0x011F, 0x0121, 0x0000, 0x0000, 0x0000, 0x0123, 0x0000, 0x0000, 0x0000, 0x01E7},
	{0x0068, 0x0000, 0x0000, 0x0125, 0x0000, 0x0127, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x021F},
	{0x0131, 0x00EC, 0x00ED, 0x00EE, 0x0129, 0x012B, 0x012D, 0x0000, 0x00EF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x012F, 0x01D0},
	{0x006A, 0x0000, 0x0000, 0x0135, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x006B, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0137, 0x0000, 0x0000, 0x0000, 0x01E9},
	{0x006C, 0x0000, 0x013A, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x013C, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x006D, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x006E, 0x01F9, 0x0144, 0x0000, 0x00F1, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0146, 0x0000, 0x0000, 0x0000, 0x0148},
	{0x006F, 0x00F2, 0x00F3, 0x00F4, 0x00F5, 0x014D, 0x014F, 0x022F, 0x00F6, 0x0000, 0x0000, 0x0000, 0x0000, 0x0151, 0x01EB, 0x01D2},
	{0x0070, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x0071, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x0072, 0x0000, 0x0155, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0157, 0x0000, 0x0000, 0x0000, 0x0159},
	{0x0073, 0x0000, 0x015B, 0x015D, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x015F, 0x0000, 0x0000, 0x0000, 0x0161},
	{0x0074, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0163, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x0075, 0x00F9, 0x00FA, 0x00FB, 0x0169, 0x016B, 0x016D, 0x0000, 0x00FC, 0x0000, 0x016F, 0x0000, 0x0000, 0x0171, 0x0173, 0x01D4},
	{0x0076, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x0077, 0x0000, 0x0000, 0x0175, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x0078, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x0079, 0x1EF3, 0x00FD, 0x0177, 0x1EF9, 0x0233, 0x0000, 0x0000, 0x00FF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
	{0x007A, 0x0000, 0x017A, 0x0000, 0x0000, 0x0000, 0x0000, 0x017C, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x017E}
};


//1 G0 Primary Sets
static const HUINT16	s_G0_Latin[96]	=
{
	0x0020, 0x0021, 0x0022, 0x0023, 0x00A4, 0x0025, 0x0026, 0x0027,
	0x0028, 0x0029, 0x002A, 0x002B, 0x002C, 0x002D, 0x002E, 0x002F,
	0x0030, 0x0031, 0x0032, 0x0033, 0x0034, 0x0035, 0x0036, 0x0037,
	0x0038, 0x0039, 0x003A, 0x003B, 0x003C, 0x003D, 0x003E, 0x003F,
	0x0040, 0x0041, 0x0042, 0x0043, 0x0044, 0x0045, 0x0046, 0x0047,
	0x0048, 0x0049, 0x004A, 0x004B, 0x004C, 0x004D, 0x004E, 0x004F,
	0x0050, 0x0051, 0x0052, 0x0053, 0x0054, 0x0055, 0x0056, 0x0057,
	0x0058, 0x0059, 0x005A, 0x005B, 0x005C, 0x005D, 0x005E, 0x005F,
	0x0060, 0x0061, 0x0062, 0x0063, 0x0064, 0x0065, 0x0066, 0x0067,
	0x0068, 0x0069, 0x006A, 0x006B, 0x006C, 0x006D, 0x006E, 0x006F,
	0x0070, 0x0071, 0x0072, 0x0073, 0x0074, 0x0075, 0x0076, 0x0077,
	0x0078, 0x0079, 0x007A, 0x007B, 0x00A6, 0x007D, 0x007E, 0x2588
};


static const HUINT16	s_G0_Cyrillic_Opt1[96] =
{
	0x0020, 0x0021, 0x0022, 0x0023, 0x0024, 0x0025, 0x0026, 0x0027,
	0x0028, 0x0029, 0x002A, 0x002B, 0x002C, 0x002D, 0x002E, 0x002F,
	0x0030, 0x0031, 0x0032, 0x0033, 0x0034, 0x0035, 0x0036, 0x0037,
	0x0038, 0x0039, 0x003A, 0x003B, 0x003C, 0x003D, 0x003E, 0x003F,
	0x0427, 0x0410, 0x0411, 0x0426, 0x0414, 0x0415, 0x0424, 0x0413,
	0x0425, 0x0418, 0x0408, 0x041A, 0x041B, 0x041C, 0x041D, 0x041E,
	0x041F, 0x040C, 0x0420, 0x0421, 0x0422, 0x0423, 0x0412, 0x0403,
	0x0409, 0x040A, 0x0417, 0X040b, 0x0416, 0x0494, 0x0428, 0x040F,
	0x0447, 0x0430, 0x0431, 0x0446, 0x0434, 0x0435, 0x0444, 0x0433,
	0x0445, 0X0438, 0X0458, 0X043A, 0x043B, 0x043C, 0x043D, 0x043E,
	0x043F, 0x045C, 0x0440, 0x0441, 0x0442, 0x0443, 0x0432, 0x0453,
	0x0459, 0x045A, 0X0437, 0x045B, 0x0436, 0x0495, 0x0448, 0x2588
};


static const HUINT16	s_G0_Cyrillic_Opt2[96] =
{
	0x0020, 0x0021, 0x0022, 0x0023, 0x0024, 0x0025, 0x044B, 0x0027,
	0x0028, 0x0029, 0x002A, 0x002B, 0x002C, 0x002D, 0x002E, 0x002F,
	0x0030, 0x0031, 0x0032, 0x0033, 0x0034, 0x0035, 0x0036, 0x0037,
	0x0038, 0x0039, 0x003A, 0x003B, 0x003C, 0x003D, 0x003E, 0x003F,
	0x042E, 0x0410, 0x0411, 0x0426, 0x0414, 0x0415, 0x0424, 0x0413,
	0x0425, 0x0418, 0x040D, 0x041A, 0x041B, 0x041C, 0x041D, 0x041E,
	0x041F, 0x042F, 0x0420, 0x0421, 0x0422, 0x0423, 0x0416, 0x0412,
	0x042C, 0x042A, 0x0417, 0x0428, 0x042D, 0x0429, 0x0427, 0x042B,
	0x044E, 0x0430, 0x0431, 0x0446, 0x0434, 0x0435, 0x0444, 0x0433,
	0x0445, 0X0438, 0x045D, 0X043A, 0x043B, 0x043C, 0x043D, 0x043E,
	0x043F, 0x044F, 0x0440, 0x0441, 0x0442, 0x0443, 0x0436, 0x0432,
	0x044C, 0x044A, 0X0437, 0x0448, 0x044D, 0x0449, 0x0447, 0x2588
};


static const HUINT16	s_G0_Cyrillic_Opt3[96] =
{
	0x0020, 0x0021, 0x0022, 0x0023, 0x0024, 0x0025, 0x0457, 0x0027,
	0x0028, 0x0029, 0x002A, 0x002B, 0x002C, 0x002D, 0x002E, 0x002F,
	0x0030, 0x0031, 0x0032, 0x0033, 0x0034, 0x0035, 0x0036, 0x0037,
	0x0038, 0x0039, 0x003A, 0x003B, 0x003C, 0x003D, 0x003E, 0x003F,
	0x042E, 0x0410, 0x0411, 0x0426, 0x0414, 0x0415, 0x0424, 0x0413,
	0x0425, 0x0418, 0x040D, 0x041A, 0x041B, 0x041C, 0x041D, 0x041E,
	0x041F, 0x042F, 0x0420, 0x0421, 0x0422, 0x0423, 0x0416, 0x0412,
	0x042C, 0x0406, 0x0417, 0x0428, 0x0404, 0x0429, 0x0427, 0x0407,
	0x044E, 0x0430, 0x0431, 0x0446, 0x0434, 0x0435, 0x0444, 0x0433,
	0x0445, 0X0438, 0x045D, 0X043A, 0x043B, 0x043C, 0x043D, 0x043E,
	0x043F, 0x044F, 0x0440, 0x0441, 0x0442, 0x0443, 0x0436, 0x0432,
	0x044C, 0x0456, 0X0437, 0x0448, 0x0454, 0x0449, 0x0447, 0x2588
};


static const HUINT16	s_G0_Greek[96] =
{
	0x0020, 0x0021, 0x0022, 0x0023, 0x0024, 0x0025, 0x0026, 0x0027,
	0x0028, 0x0029, 0x002A, 0x002B, 0x002C, 0x002D, 0x002E, 0x002F,
	0x0030, 0x0031, 0x0032, 0x0033, 0x0034, 0x0035, 0x0036, 0x0037,
	0x0038, 0x0039, 0x003A, 0x003B, 0x00AB, 0x003D, 0x00BB, 0x003F,
	0x0390, 0x0391, 0x0392, 0x0393, 0x0394, 0x0395, 0x0396, 0x0397,
	0x0398, 0x0399, 0x039A, 0x039B, 0x039C, 0x039D, 0x039E, 0x039F,
	0x03A0, 0x03A1, 0x0384, 0x03A3, 0x03A4, 0x03A5, 0x03A6, 0x03A7,
	0x03A8, 0x03A9, 0x03AA, 0x03AB, 0x03AC, 0x03AD, 0x03AE, 0x03AF,
	0x03B0, 0x03B1, 0x03B2, 0x03B3, 0x03B4, 0x03B5, 0x03B6, 0x03B7,
	0x03B8, 0x03B9, 0x03BA, 0x03BB, 0x03BC, 0x03BD, 0x03BE, 0x03BF,
	0x03C0, 0x03C1, 0x03C2, 0x03C3, 0x03C4, 0x03C5, 0x03C6, 0x03C7,
	0x03C8, 0x03C9, 0x03CA, 0x03CB, 0x03CC, 0x03CD, 0x03CE, 0x2588
};


static const HUINT16	s_G0_Arabic[96] =
{
	0x0020, 0x0021, 0x0022, 0x00A3, 0x0024, 0x0025, 0x06BA, 0x064A,
	0x0028, 0x0029, 0x002A, 0x002B, 0x002C, 0x002D, 0x002E, 0x002F,
	0x0030, 0x0031, 0x0032, 0x0033, 0x0034, 0x0035, 0x0036, 0x0037,
	0x0038, 0x0039, 0x003A, 0x061B, 0x003C, 0x003D, 0x003E, 0x061F,
	0xFE94, 0x0621, 0xFE92, 0x0628, 0xFE98, 0x062A, 0xFE8E, 0x0627,
	0xFE91, 0x0629, 0xFE97, 0xFE9B, 0xFE9F, 0xFEA3, 0xFEA7, 0x062F,
	0x0630, 0x0631, 0x0632, 0x0633, 0x0634, 0x0635, 0x0636, 0x0637,
	0x0638, 0xFECB, 0xFECF, 0xFE9C, 0xFEA0, 0xFEA4, 0xFEA8, 0x0023,
	0x0640, 0x0641, 0x0642, 0x06A9, 0xFEDF, 0xFEE3, 0xFEE7, 0xFBAA,
	0x0648, 0x0649, 0xFEF3, 0x062B, 0x062C, 0x062D, 0x062E, 0xFEF4,
	0xFEEF, 0xFECC, 0xFED0, 0xFED4, 0xFED1, 0xFED8, 0xFED5, 0x0643,
	0xFEE0, 0x0644, 0xFEE4, 0x0645, 0xFEE8, 0x0646, 0x0263, 0x2588
};

//static const HUINT16	s_HebrewG0[] = {};


//1 G2 Supplementary Sets


static const HUINT16	s_G2_Latin[96] =
{
	0x0020, 0x00A1, 0x00A2, 0x00A3, 0x0024, 0x00A5, 0x0023, 0x00A7,
	0x00A4, 0x0027, 0x0022, 0x00AB, 0x2190, 0x2191, 0x2192, 0x2193,
	0x00B0, 0x00B1, 0x00B2, 0x00B3, 0x00D7, 0x00B5, 0x00B6, 0x00B7,
	0x00F7, 0x0027, 0x0022, 0x00BB, 0x00BC, 0x00BD, 0x00BE, 0x00BF,
	0x0020, 0x0300, 0x0301, 0x0302, 0x0303, 0x0304, 0x0306, 0x0307,
	0x0308, 0x0323, 0x030A, 0x0327, 0x0332, 0x030B, 0x0328, 0x030C,
	0x0336, 0x00B9, 0x00AE, 0x00A9, 0x2122, 0x266A, 0x0276, 0x2030,
	0x221D, 0x0020, 0x0020, 0x0020, 0x215B, 0x215C, 0x215D, 0x215E,
	0x2126, 0x00C6, 0x00D0, 0x2376, 0x0126, 0x0020, 0x0132, 0x013F,
	0x0141, 0x00D8, 0x0152, 0x00BA, 0x00DE, 0x0166, 0x014A, 0x0149,
	0x0138, 0x00E6, 0x00F0, 0x00F0, 0x0127, 0x0131, 0x0133, 0x0140,
	0x0142, 0x00F8, 0x0153, 0x03B2, 0x00FE, 0x0167, 0x014B, 0x2588
};


static const HUINT16	s_G2_Cyrillic[96] =
{
	0x0020, 0x00A1, 0x00A2, 0x00A3, 0x0024, 0x00A5, 0x0020, 0x00A7,
	0x0020, 0x0027, 0x0022, 0x00AB, 0x2190, 0x2191, 0x2192, 0x2193,
	0x00B0, 0x00B1, 0x00B2, 0x00B3, 0x00D7, 0x00B5, 0x00B6, 0x00B7,
	0x00F7, 0x0027, 0x0022, 0x00BB, 0x00BC, 0x00BD, 0x00BE, 0x00BF,
	0x0020, 0x0300, 0x0301, 0x0302, 0x0303, 0x0304, 0x0306, 0x0307,
	0x0308, 0x0323, 0x030A, 0x0327, 0x0332, 0x030B, 0x0328, 0x030C,
	0x0336, 0x00B9, 0x00AE, 0x00A9, 0x2122, 0x266A, 0x0276, 0x2030,
	0x221D, 0x0141, 0x0142, 0x03B2, 0x215B, 0x215C, 0x215D, 0x215E,
	0x0044, 0x0045, 0x0046, 0x0047, 0x0049, 0x004A, 0x004B, 0x004C,
	0x004E, 0x0051, 0x0052, 0x0053, 0x0055, 0x0056, 0x0057, 0x005A,
	0x0064, 0x0065, 0x0066, 0x0067, 0x0069, 0x006A, 0x006B, 0x006C,
	0x006E, 0x0071, 0x0072, 0x0073, 0x0075, 0x0076, 0x0077, 0x007A
};


static const HUINT16	s_G2_Greek[96] =
{
	0x0020, 0x0061, 0x0062, 0x00A3, 0x0065, 0x0068, 0x0069, 0x00A7,
	0x003A, 0x0027, 0x0022, 0x006B, 0x2190, 0x2191, 0x2192, 0x2193,
	0x00B0, 0x00B1, 0x00B2, 0x00B3, 0x00D7, 0x006D, 0x006E, 0x0070,
	0x00F7, 0x0027, 0x0022, 0x0074, 0x00BC, 0x00BD, 0x00BE, 0x00BF,
	0x0020, 0x0300, 0x0301, 0x0302, 0x0303, 0x0304, 0x0306, 0x0307,
	0x0308, 0x0323, 0x030A, 0x0327, 0x0332, 0x030B, 0x0328, 0x030C,
	0x003F, 0x00B9, 0x00AE, 0x00A9, 0x2122, 0x266A, 0x0276, 0x2030,
	0x221D, 0x038A, 0x038E, 0x038F, 0x215B, 0x215C, 0x215D, 0x215E,
	0x0043, 0x0044, 0x0046, 0x0047, 0x004A, 0x004C, 0x0051, 0x0052,
	0x0053, 0x0055, 0x0056, 0x0057, 0x0059, 0x005A, 0x0386, 0x0389,
	0x0063, 0x0064, 0x0066, 0x0067, 0x006A, 0x006C, 0x0071, 0x0072,
	0x0073, 0x0075, 0x0076, 0x0077, 0x0079, 0x007A, 0x0388, 0x2588
};


static const HUINT16	s_G2_Arabic[96] =
{
	0x0020, 0x0639, 0x0622, 0x0623, 0x0624, 0x0625, 0xFE8B, 0x0626,
	0xFB7C, 0xFB7C, 0x0686, 0xFB58, 0xFB59, 0x067E, 0x0698, 0x06AF,
	0x0660, 0x0661, 0x0662, 0x0663, 0x0664, 0x0665, 0x0666, 0x0667,
	0x0668, 0x0669, 0xFEA6, 0x063A, 0xFEFC, 0xFEEC, 0xFEEA, 0xFEE9,
	0x00E0, 0x0041, 0x0042, 0x0043, 0x0044, 0x0045, 0x0046, 0x0047,
	0x0048, 0x0049, 0x004A, 0x004B, 0x004C, 0x004D, 0x004E, 0x004F,
	0x0050, 0x0051, 0x0052, 0x0053, 0x0054, 0x0055, 0x0056, 0x0057,
	0x0058, 0x0059, 0x005A, 0x00EB, 0x00EA, 0x00F9, 0x00EE, 0xFEA2,
	0x00E8, 0x0061, 0x0062, 0x0063, 0x0064, 0x0065, 0x0066, 0x0067,
	0x0068, 0x0069, 0x006A, 0x006B, 0x006C, 0x006D, 0x006E, 0x006F,
	0x0070, 0x0071, 0x0072, 0x0073, 0x0074, 0x0075, 0x0076, 0x0077,
	0x0078, 0x0079, 0x007A, 0x00E2, 0x00F4, 0x00FB, 0x00E7, 0x0020
};


//1 Teletext code to UNICODE
static const HUINT16	* s_TTXCodeToUnicode[eHxCP_TELETEXT_MAX] =
{
	s_G0_Latin,				///< Latin G0 Primary Set - English
	s_G0_Latin,				///< Latin G0 Primary Set - Germen
	s_G0_Latin,				///< Latin G0 Primary Set - Swedish/Finnish
	s_G0_Latin,				///< Latin G0 Primary Set - Italian
	s_G0_Latin,				///< Latin G0 Primary Set - French
	s_G0_Latin,				///< Latin G0 Primary Set - Portuguese/Spanish
	s_G0_Latin,				///< Latin G0 Primary Set - Czech/Slovak
	s_G0_Latin,				///< Latin G0 Primary Set - Polish
	s_G0_Latin,				///< Latin G0 Primary Set - Estonian
	s_G0_Latin,				///< Latin G0 Primary Set - Lettish/Lithuanian
	s_G0_Latin,				///< Latin G0 Primary Set - Rumanian
	s_G0_Latin,				///< Latin G0 Primary Set - Serbian/Croatian/Slovenian
	s_G0_Latin,				///< Latin G0 Primary Set - Turkish
	s_G0_Latin,				///< Latin G0 Primary Set
	s_G0_Cyrillic_Opt1,		///< Cyrillic G0 Primary Set - Option 1 - Serbian/Croatian
	s_G0_Cyrillic_Opt2,		///< Cyrillic G0 Primary Set - Option 2 - Russian/Bulgarian
	s_G0_Cyrillic_Opt3,		///< Cyrillic G0 Primary Set - Option 3 - Ukrainian
	s_G0_Greek,				///< Greek G0 Priamry Set
	s_G0_Arabic,			///< Arbic G0 Primary Set
	(const HUINT16 *)NULL,	///< Hebrew G0 Primary Set
	(const HUINT16 *)NULL,	///< G1 Block Mosaics Set - Contiguous
	(const HUINT16 *)NULL,	///< G1 Block Mosaics Set - Separated
	s_G2_Latin,				///< Latin G2 Supplementary Set
	s_G2_Cyrillic,			///< Cyrillic G2 Supplementary Set
	s_G2_Greek,				///< Greek G2 Supplementary Set
	s_G2_Arabic,			///< Arbic G2 Supplementary Set
	(const HUINT16 *)NULL	///< G3 line Drawing & Smooth Mosaic
};


/* *************************************************************************************************** */
#define ___Private_FUNCTION______________________________________________________________________________
/* *************************************************************************************************** */

static HINT32	_hcodepage_ttx_NosTo (HUINT8 charset, HUINT8 ch, HUINT16 *ucs2)
{
	HINT32	i, n;

	if (charset >= eHxCP_TELETEXT_G0_LATIN)
		return 0;

	n = sizeof(s_NosIndex) / sizeof(s_NosIndex[0]);
	for (i = 0 ; i < n && s_NosIndex[i] != ch ; i++)
		;
	if (i == n)
		return 0;

	*ucs2 = s_Nos[charset][i];
	if (*ucs2 == 0)
		return 0;
	return sizeof(HUINT16);
}

static HINT32	_hcodepage_ttx_CharTo(HUINT8 charset, HUINT8 ch, HUINT16 *ucs2)
{
	HINT32	n;
	const HUINT16 *	charmap;

	charmap = s_TTXCodeToUnicode[(HINT32)charset];
	if (charmap == NULL)
		return 0;

	n = _hcodepage_ttx_NosTo(charset, ch, ucs2);
	if (n <= 0)
	{
		*ucs2 = charmap[(HINT32)(ch - 0x20)];
		n = (*ucs2 == 0) ? 0 : 2;
	}
	return n;
}

static HINT32	_hcodepage_ttx_CompositeCharTo (HUINT8 charset, HUINT8 ch, HUINT8 mark, HUINT16 *ucs2)
{
	HINT32	n = 0;

	if (charset <= eHxCP_TELETEXT_G0_LATIN)
	{
		if (isupper(ch))
			*ucs2 = s_CompositeChar_Latin_UPPER[ch - 'A'][mark];
		else if (islower(ch))
			*ucs2 = s_CompositeChar_Latin_LOWER[ch - 'a'][mark];
		else if (mark == 0)
			*ucs2 = s_G0_Latin[ch - 0x20];
		else
			*ucs2 = 0x0000;
	}

	if (*ucs2 == 0x0000)
	{
		mark += 0x40;
		if (0x20 <= mark && mark < 0x80) // mark -> char 순으로 넣는다.. 왜?? 그래야 제대로 그려짐!
		{
			*ucs2++ = s_G2_Latin[(HINT32)(mark - 0x20)];
			n += 2;
		}
		n += _hcodepage_ttx_CharTo(charset, ch, ucs2);
	}
	else
	{
		n = 2;
	}
	return n;
}


STATIC	HINT32	_hcodepage_ttx_NumOfBytes(const void *pSrc)
{
	const HUINT8 *src = (const HUINT8 *)pSrc;

	if (*src++ >= eHxCP_TELETEXT_MAX)
	{
		return 0;
	}
	return strlen((const char*)src) + 1;
}

STATIC	HINT32	_hcodepage_ttx_NumOfChars(const void *pSrc)
{
	return _hcodepage_ttx_NumOfBytes(pSrc);
}


/**
 *
 *
 * @param	src		source string
 * @param	dst		destination (UCS2) string
 * @param	bytes	number of bytes of 'dst'
 * @return
 */
STATIC	HINT32 	_hcodepage_ttx_ConvertCodepageToUCS2(const void *_src, HUINT16 *dst, HINT32 bytes)
{
	HINT32 	n;
	HUINT16	ucs2[3];
	const HUINT8 *src = (const HUINT8 *)_src;

	HxLOG_Assert(src && dst);

	if (bytes < 6)
		return eHxCP_ERROR_FAIL;

	ucs2[0] = ucs2[1] = ucs2[2] = 0x0000;

	n = _hcodepage_ttx_NumOfChars(src);
	switch (n)
	{
	case 2:
		n = _hcodepage_ttx_CharTo(src[0], src[1], ucs2);
		break;

	case 3:
		n = _hcodepage_ttx_CompositeCharTo(src[0], src[1], src[2], ucs2);
		break;

	default:
		n = eHxCP_ERROR_FAIL;
		break;
	}

	HxSTD_MemCopy(dst, ucs2, 3 * sizeof(HUINT16));

	return n;
}



STATIC	HERROR	_hcodepage_ttx_GetInfo(eHxCP_Slot_t *pCPSlot)
{
	if(pCPSlot == NULL)
	{
		return ERR_FAIL;
	}

	pCPSlot->cbNumOfBytes = _hcodepage_ttx_NumOfBytes;
	pCPSlot->cbNumOfChars = _hcodepage_ttx_NumOfChars;
	pCPSlot->cbGetCharAt  = NULL;
	pCPSlot->cbUCS2ToCodepage = NULL;
	pCPSlot->cbCodeapgeToUCS2 = _hcodepage_ttx_ConvertCodepageToUCS2;

	pCPSlot->ucEndCharBytes = 1;

	pCPSlot->stCPTagSlot.eCodepage = eHxCP_TELETEXT;
	pCPSlot->stCPTagSlot.nCPTagLen = 0;

	return ERR_OK;
}


/* *************************************************************************************************** */
#define ___PUBLIC_FUNCTION_______________________________________________________________________________
/* *************************************************************************************************** */


HERROR	INT_HCodepage_TELETEXT(void)
{
	HERROR		hErr = ERR_FAIL;
	eHxCP_Slot_t	stCPSlot;

	HxSTD_MemSet(&stCPSlot, 0, sizeof(eHxCP_Slot_t));

	hErr = _hcodepage_ttx_GetInfo(&stCPSlot);
	if(hErr != ERR_OK)
	{
		return hErr;
	}

	hErr = HLIB_CP_AddCodepage(&stCPSlot);
	if(hErr != ERR_OK)
	{
		return hErr;
	}

	return ERR_OK;
}


/*********************** End of File ******************************/

