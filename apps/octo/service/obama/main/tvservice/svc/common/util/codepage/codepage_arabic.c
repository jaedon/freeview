/*******************************************************************/
/********************      Header Files    *************************/
/*******************************************************************/

/* global header file */
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdarg.h>
#include <ctype.h>
#include <mwc_codepage.h>

#include <octo_common.h>

/* local header file */
#include <isosvc.h>


/*******************************************************************/
/********************      Debug     ********************/
/*******************************************************************/




/*******************************************************************/
/********************      Global Variables     ********************/
/*******************************************************************/


/*******************************************************************/
/********************      Defines         *************************/
/*******************************************************************/



/*******************************************************************/
/********************      Typedef         *************************/
/*******************************************************************/
typedef struct UNICODE_PositionItem
{
	HUINT16 	usIsolated;
	HUINT16 	usFinal;
	HUINT16 	usInitial;
	HUINT16 	usMedial;
}UNICODE_toPositionItem;


/*******************************************************************/
/********************      Static Variables     ********************/
/*******************************************************************/

//win1256       for Farsi
STATIC CHARMAPITEM_toUnicode WinCode_TO_Arabic[] =
{
	{0x80,	0x0020}, //
	{0x81,	0x067E}, // ARABIC LETTER PEH
	{0x82,	0x0020}, //
	{0x83,	0x0020}, //
	{0x84,	0x0020}, //
	{0x85,	0x0020}, //
	{0x86,  0x0020}, //
	{0x87,  0x0020}, //
	{0x88,  0x0020}, //
	{0x89,  0x0020}, //
	{0x8A,  0x0020}, //ARABIC LETTER TTEH
	{0x8B,  0x0020}, //
	{0x8C,  0x0020}, //
	{0x8D,  0x0686}, //ARABIC LETTER TCHEH
	{0x8E,  0x0698}, //ARABIC LETTER JEH
	{0x8F,  0x0020}, //ARABIC LETTER RREH
	{0x90,  0x06A9}, //ARABIC LETTER KEHEH
	{0x91,  0x0020}, //
	{0x92,  0x0020}, //
	{0x93,  0x0020}, //
	{0x94,  0x0020}, //
	{0x95,  0x0020}, //
	{0x96,  0x0020}, //
	{0x97,  0x0020}, //
	{0x98,  0x069F}, //ARABIC LETTER GAF
	{0x99,  0x0020}, //
	{0x9A,  0x060C}, //ARABIC LETTER RREH
	{0x9B,  0x0020}, //
	{0x9C,  0x0020}, //
	{0x9D,  0x0020}, //
	{0x9E,  0x0020}, //
	{0x9F,  0x06BA}, //ARABIC LETTER NOON GHUNNA
	{0xA0,  0x00A0}, //NO-BREAK SPACE
	{0xA1,  0x060C}, //ARABIC COMMA
	{0xA2,	0x0020},	//TEMP SPACE
	{0xA3,	0x0020},	//TEMP SPACE
	{0xA4,	0x00A4},	//CURRENCY SIGN
	{0xA5,	0x0020},	//TEMP SPACE
	{0xA6,	0x0020},	//TEMP SPACE
	{0xA7,	0x0020},	//TEMP SPACE
	{0xA8,	0x0020},	//TEMP SPACE
	{0xA9,	0x0020},	//TEMP SPACE
	{0xAA,	0x0020},	//TEMP SPACE
	{0xAB,	0x0020},	//TEMP SPACE
	{0xAC,  0x0020}, //TEMP SPACE
	{0xAD,	0x00AD},	//SOFT HYPHEN
	{0xAE,	0x0020},	//TEMP SPACE
	{0xAF,	0x0020},	//TEMP SPACE
	{0xB0,	0x0020},	//TEMP SPACE
	{0xB1,	0x0020},	//TEMP SPACE
	{0xB2,	0x0020},	//TEMP SPACE
	{0xB3,	0x0020},	//TEMP SPACE
	{0xB4,	0x0020},	//TEMP SPACE
	{0xB5,	0x0020},	//TEMP SPACE
	{0xB6,	0x0020},	//TEMP SPACE
	{0xB7,	0x0020},	//TEMP SPACE
	{0xB8,	0x0020},	//TEMP SPACE
	{0xB9,	0x0020},	//TEMP SPACE
	{0xBA,  0x061B}, //ARABIC SEMICOLON
	{0xBB,  0x0020}, //TEMP SPACE
	{0xBC,	0x0020},	//TEMP SPACE
	{0xBD,	0x0020},	//TEMP SPACE
	{0xBE,	0x0020},	//TEMP SPACE
	{0xBF,	0x061F},	//ARABIC QUESTION MARK
	{0xC0,	0x0020},	//TEMP SPACE
	{0xC1,	0x0621},	//ARABIC LETTER HAMZA
	{0xC2,	0x0622},	//ARABIC LETTER ALEF WITH MADDA ABOVE
	{0xC3,	0x0623},	//ARABIC LETTER ALEF WITH HAMZA ABOVE
	{0xC4,	0x0624},	//ARABIC LETTER WAW WITH HAMZA ABOVE
	{0xC5,	0x0625},	//ARABIC LETTER ALEF WITH HAMZA BELOW
	{0xC6,	0x0626},	//ARABIC LETTER YEH WITH HAMZA ABOVE
	{0xC7,	0x0627},	//ARABIC LETTER ALEF
	{0xC8,	0x0628},	//ARABIC LETTER BEH
	{0xC9,	0x0629},	//ARABIC LETTER TEH MARBUTA
	{0xCA,	0x062A},	//ARABIC LETTER TEH
	{0xCB,	0x062B},	//ARABIC LETTER THEH
	{0xCC,	0x062C},	//ARABIC LETTER JEEM
	{0xCD,	0x062D},	//ARABIC LETTER HAH
	{0xCE,	0x062E},	//ARABIC LETTER KHAH
	{0xCF,	0x062F},	//ARABIC LETTER DAL
	{0xD0,	0x0630},	//ARABIC LETTER THAL
	{0xD1,	0x0631},	//ARABIC LETTER REH
	{0xD2,	0x0632},	//ARABIC LETTER ZAIN
	{0xD3,	0x0633},	//ARABIC LETTER SEEN
	{0xD4,	0x0634},	//ARABIC LETTER SHEEN
	{0xD5,	0x0635},	//ARABIC LETTER SAD
	{0xD6,	0x0636},	//ARABIC LETTER DAD
	{0xD7,  0x0020}, //TEMP SPACE
	{0xD8,	0x0637},	//ARABIC LETTER TAH
	{0xD9,	0x0638},	//ARABIC LETTER ZAH
	{0xDA,	0x0639},	//ARABIC LETTER AIN
	{0xDB,	0x063A},	//ARABIC LETTER GHAIN
	{0xDC,  0x0640}, //ARABIC TATWEEL
	{0xDD,  0x0641}, //ARABIC LETTER FEH
	{0xDE,  0x0642}, //ARABIC LETTER QAF
	{0xDF,  0x0643}, //ARABIC LETTER KAF
	{0xE0,  0x0020}, //TEMP SPACE
	{0xE1,	0x0644},	//ARABIC LETTER LAM
	{0xE2,  0x0020}, //TEMP SPACE
	{0xE3,	0x0645},	//ARABIC LETTER MEEM
	{0xE4,	0x0646},	//ARABIC LETTER NOON
	{0xE5,	0x0647},	//ARABIC LETTER HEH
	{0xE6,	0x0648},	//ARABIC LETTER WAW
	{0xE7,  0x0020}, //TEMP SPACE
	{0xE8,  0x0020}, //TEMP SPACE
	{0xE9,  0x0020}, //TEMP SPACE
	{0xEA,  0x0020}, //TEMP SPACE
	{0xEB,  0x0020}, //TEMP SPACE
	{0xEC,	0x0649},	//ARABIC LETTER ALEF MAKSURA
	{0xED,	0x064A},	//ARABIC LETTER YEH
	{0xEE,  0x0020}, //TEMP SPACE
	{0xEF,  0x0020}, //TEMP SPACE
	{0xF0,  0x064B}, //ARABIC FATHATAN
	{0xF1,  0x064C}, //ARABIC DAMMATAN
	{0xF2,  0x064D}, //ARABIC KASRATAN
	{0xF3,  0x064E}, //ARABIC FATHA
	{0xF4,  0x0020}, //TEMP SPACE
	{0xF5,  0x064F}, //ARABIC DAMMA
	{0xF6,  0x0650}, //ARABIC KASRA
	{0xF7,  0x0020}, //TEMP SPACE
	{0xF8,  0x0651}, //ARABIC SHADDA
	{0xF9,  0x0020}, //TEMP SPACE
	{0xFA,  0x0652}, //ARABIC SUKUN
	{0xFB,  0x0020}, //TEMP SPACE
	{0xFC,  0x0020}, //TEMP SPACE
	{0xFD,  0x0020}, //TEMP SPACE
	{0xFE,  0x0020}, //TEMP SPACE
	{0xFF,  0x0020}, //TEMP SPACE



};

//0x06xx가 아랍어인데 편의상 0x0621~0x06CC 까지만 작성. 이 범위 외의 것은 FE, FB시리즈로 변환 없이 그냥 찍는다.
//0x06xx 에서 0xFE나 0xFB로 변환 안되는 부분도 일단 작성. 현재 DejaVu Sans에는 Arabic Presentation Form B에 해당하는 다수의 0xFBxx 가 없기는 하지만,
//나중에 다른 폰트를 쓰게되면 혹시 필요할지도. -> Ligature와 Glyphs들 때문에.
//{isolated, final, initail, medial}
STATIC UNICODE_toPositionItem UNICODE_TO_POSITION_CONTEXTUAL[] =
{
		{0xFE80,	0xFE80,		0xFE80,		0xFE80},	//0x0621
		{0xFE81,	0xFE82,		0xFE81,		0xFE81}, 	//0x0622
		{0xFE83,	0xFE84,		0xFE83,		0xFE83},	//0x0623
		{0xFE85,	0xFE86,		0xFE85,		0xFE85},	//0x0624
		{0xFE87,	0xFE88,		0xFE87,		0xFE87},	//0x0625
		{0xFE89,	0xFE8A,		0xFE8B,		0xFE8C},	//0x0626
		{0xFE8D, 	0xFE8E,		0xFE8D,		0xFE8D},	//0x0627
		{0xFE8F,	0xFE90,		0xFE91,		0xFE92},	//0x0628
		{0xFE93,	0xFE94,		0xFE93,		0xFE93},	//0x0629
		{0xFE95,	0xFE96,		0xFE97,		0xFE98},	//0x062A
		{0xFE99,	0xFE9A,		0xFE9B,		0xFE9C},	//0x062B
		{0xFE9D,	0xFE9E,		0xFE9F,		0xFEA0},	//0x062C
		{0xFEA1,	0xFEA2,		0xFEA3,		0xFEA4},	//0x062D
		{0xFEA5,	0xFEA6,		0xFEA7,		0xFEA8},	//0x062E
		{0xFEA9,	0xFEAA,		0xFEA9,		0xFEA9},	//0x062F
		{0xFEAB,	0xFEAC,		0xFEAB,		0xFEAB},	//0x0630
		{0xFEAD,	0xFEAE,		0xFEAD,		0xFEAD},	//0x0631
		{0xFEAF,	0xFEB0,		0xFEAF,		0xFEAF},	//0x0632
		{0xFEB1,	0xFEB2,		0xFEB3,		0xFEB4},	//0x0633
		{0xFEB5,	0xFEB6,		0xFEB7,		0xFEB8},	//0x0634
		{0xFEB9,	0xFEBA,		0xFEBB,		0xFEBC},	//0x0635
		{0xFEBD,	0xFEBE,		0xFEBF,		0xFEC0},	//0x0636
		{0xFEC1,	0xFEC2,		0xFEC3,		0xFEC4},	//0x0637
		{0xFEC5,	0xFEC6,		0xFEC7,		0xFEC8},	//0x0638
		{0xFEC9,	0xFECA,		0xFECB,		0xFECC},	//0x0639
		{0xFECD,	0xFECE,		0xFECF,		0xFED0},	//0x063A
		{0x063B,	0x063B,		0x063B,		0x063B},		//0x063B
		{0x063C,	0x063C,		0x063C,		0x063C},		//0x063C
		{0x063D,	0x063D,		0x063D,		0x063D},		//0x063D
		{0x063E,	0x063E,		0x063E,		0x063E},		//0x063E
		{0x063F,	0x063F,		0x063F,		0x063F},		//0x063F
		{0x0640,	0x0640,		0x0640,		0x0640},	    //0x0640
		{0xFED1,	0xFED2,		0xFED3,		0xFED4},	//0x0641
		{0xFED5,	0xFED6,		0xFED7,		0xFED8},	//0x0642
		{0xFED9,	0xFEDA,		0xFEDB,		0xFEDC},	//0x0643
		{0xFEDD,	0xFEDE,		0xFEDF,		0xFEE0},	//0x0644  //LAM
		{0xFEE1,	0xFEE2,		0xFEE3,		0xFEE4},	//0x0645
		{0xFEE5,	0xFEE6,		0xFEE7,		0xFEE8},	//0x0646
		{0xFEE9,	0xFEEA,		0xFEEB,		0xFEEC},	//0x0647
		{0xFEED,	0xFEEE,		0xFEED,		0xFEED},	//0x0648
		{0xFEEF,	0xFEF0,		0xFEEF,		0xFEEF},	//0x0649
		{0xFEF1,	0xFEF2,		0xFEF3,		0xFEF4},	//0x064A
		{0x064B,	0x064B,		0x064B,		0x064B},	    //0x064B
		{0x064C,	0x064C,		0x064C,		0x064C},	    //0x064C
		{0x064D,	0x064D,		0x064D,		0x064D},	    //0x064D
		{0x064E,	0x064E,		0x064E,		0x064E},	    //0x064E
		{0x064F,	0x064F,		0x064F,		0x064F},	    //0x064F
		{0x0650,	0x0650,		0x0650,		0x0650},	    //0x0650
		{0x0651,	0x0651,		0x0651,		0x0651},	    //0x0651
		{0x0652,	0x0652,		0x0652,		0x0652},	    //0x0652
		{0x0653,	0x0653,		0x0653,		0x0653},	    //0x0653
		{0x0654,	0x0654,		0x0654,		0x0654},	    //0x0654
		{0x0655,	0x0655,		0x0655,		0x0655},	    //0x0655
		{0x0656,	0x0656,		0x0656,		0x0656},	    //0x0656
		{0x0657,	0x0657,		0x0657,		0x0657},	    //0x0657
		{0x0658,	0x0658,		0x0658,		0x0658},	    //0x0658
		{0x0659,	0x0659,		0x0659,		0x0659},	    //0x0659
		{0x065A,	0x065A,		0x065A,		0x065A},	    //0x065A
		{0x065B,	0x065B,		0x065B,		0x065B},	    //0x065B
		{0x065C,	0x065C,		0x065C,		0x065C},	    //0x065C
		{0x065D,	0x065D,		0x065D,		0x065D},	    //0x065D
		{0x065E,	0x065E,		0x065E,		0x065E},	    //0x065E
		{0x0000,	0x0000,		0x0000,		0x0000},	    //0x065F   NULL SPACE
		{0x0660,	0x0660,		0x0660,		0x0660},	    //0x0660
		{0x0661,	0x0661,		0x0661,		0x0661},	    //0x0661
		{0x0662,	0x0662,		0x0662,		0x0662},	    //0x0662
		{0x0663,	0x0663,		0x0663,		0x0663},	    //0x0663
		{0x0664,	0x0664,		0x0664,		0x0664},	    //0x0664
		{0x0665,	0x0665,		0x0665,		0x0665},	    //0x0665
		{0x0666,	0x0666,		0x0666,		0x0666},	    //0x0666
		{0x0667,	0x0667,		0x0667,		0x0667},	    //0x0667
		{0x0668,	0x0668,		0x0668,		0x0668},	    //0x0668
		{0x0669,	0x0669,		0x0669,		0x0669},	    //0x0669
		{0x066A,	0x066A,		0x066A,		0x066A},	    //0x066A
		{0x066B,	0x066B,		0x066B,		0x066B},	    //0x066B
		{0x066C,	0x066C,		0x066C,		0x066C},	    //0x066C
		{0x066D,	0x066D,		0x066D,		0x066D},	    //0x066D
		{0x066E,	0x066E,		0x066E,		0x066E},	    //0x066E
		{0x066F,	0x066F,		0x066F,		0x066F},	    //0x066F
		{0x0670,	0x0670,		0x0670,		0x0670},	    //0x0670
		{0x0671,	0x0671,		0x0671,		0x0671},	    //0x0671
		{0x0672,	0x0672,		0x0672,		0x0672},	    //0x0672
		{0x0673,	0x0673,		0x0673,		0x0673},	    //0x0673
		{0x0674,	0x0674,		0x0674,		0x0674},	    //0x0674
		{0x0675,	0x0675,		0x0675,		0x0675},	    //0x0675
		{0x0676,	0x0676,		0x0676,		0x0676},	    //0x0676
		{0x0677,	0x0677,		0x0677,		0x0677},	    //0x0677
		{0x0678,	0x0678,		0x0678,		0x0678},	    //0x0678
		{0x0679,	0x0679,		0x0679,		0x0679},	    //0x0679
		{0x067A,	0x067A,		0x067A,		0x067A},	    //0x067A
		{0x067B,	0x067B,		0x067B,		0x067B},	    //0x067B
		{0x067C,	0x067C,		0x067C,		0x067C},	    //0x067C
		{0x067D,	0x067D,		0x067D,		0x067D},	    //0x067D
		{0xFB56,	0xFB57,		0xFB58,		0xFB59},	//0x067E		For Persian
		{0x067F,	0x067F,		0x067F,		0x067F},	    //0x067F
		{0x0680,	0x0680,		0x0680,		0x0680},	    //0x0680
		{0x0681,	0x0681,		0x0681,		0x0681},	    //0x0681
		{0x0682,	0x0682,		0x0682,		0x0682},	    //0x0682
		{0x0683,	0x0683,		0x0683,		0x0683},	    //0x0683
		{0x0684,	0x0684,		0x0684,		0x0684},	    //0x0684
		{0x0685,	0x0685,		0x0685,		0x0685},	    //0x0685
		{0xFB7A,	0xFB7B,		0xFB7C,		0xFB7D},	//0x0686		For Persian
		{0x0687,	0x0687,		0x0687,		0x0687},	    //0x0687
		{0x0688,	0x0688,		0x0688,		0x0688},	    //0x0688
		{0x0689,	0x0689,		0x0689,		0x0689},	    //0x0689
		{0x068A,	0x068A,		0x068A,		0x068A},	    //0x068A
		{0x068B,	0x068B,		0x068B,		0x068B},	    //0x068B
		{0x068C,	0x068C,		0x068C,		0x068C},	    //0x068C
		{0x068D,	0x068D,		0x068D,		0x068D},	    //0x068D
		{0x068E,	0x068E,		0x068E,		0x068E},	    //0x068E
		{0x068F,	0x068F,		0x068F,		0x068F},	    //0x068F
		{0x0690,	0x0690,		0x0690,		0x0690},	    //0x0690
		{0x0691,	0x0691,		0x0691,		0x0691},	    //0x0691
		{0x0692,	0x0692,		0x0692,		0x0692},	    //0x0692
		{0x0693,	0x0693,		0x0693,		0x0693},	    //0x0693
		{0x0694,	0x0694,		0x0694,		0x0694},	    //0x0694
		{0x0695,	0x0695,		0x0695,		0x0695},	    //0x0695
		{0x0696,	0x0696,		0x0696,		0x0696},	    //0x0696
		{0x0697,	0x0697,		0x0697,		0x0697},	    //0x0697
		{0xFB8A,	0xFB8B,		0xFB8A,		0xFB8A},	//0x0698		For Persian
		{0x0699,	0x0699,		0x0699,		0x0699},	    //0x0699
		{0x069A,	0x069A,		0x069A,		0x069A},	    //0x069A
		{0x069B,	0x069B,		0x069B,		0x069B},	    //0x069B
		{0x069C,	0x069C,		0x069C,		0x069C},	    //0x069C
		{0x069D,	0x069D,		0x069D,		0x069D},	    //0x069D
		{0x069E,	0x069E,		0x069E,		0x069E},	    //0x069E
		{0x069F,	0x069F,		0x069F,		0x069F},	    //0x069F
		{0x06A0,	0x06A0,		0x06A0,		0x06A0},	    //0x06A0
		{0x06A1,	0x06A1,		0x06A1,		0x06A1},	    //0x06A1
		{0x06A2,	0x06A2,		0x06A2,		0x06A2},	    //0x06A2
		{0x06A3,	0x06A3,		0x06A3,		0x06A3},	    //0x06A3
		{0x06A4,	0x06A4,		0x06A4,		0x06A4},	    //0x06A4
		{0x06A5,	0x06A5,		0x06A5,		0x06A5},	    //0x06A5
		{0x06A6,	0x06A6,		0x06A6,		0x06A6},	    //0x06A6
		{0x06A7,	0x06A7,		0x06A7,		0x06A7},	    //0x06A7
		{0x06A8,	0x06A8,		0x06A8,		0x06A8},	    //0x06A8
		{0xFB8E,	0xFB8F,		0xFB90,		0xFB91},	//0x06A9		For Persian
		{0x06AA,	0x06AA,		0x06AA,		0x06AA},	    //0x06AA
		{0x06AB,	0x06AB,		0x06AB,		0x06AB},	    //0x06AB
		{0x06AC,	0x06AC,		0x06AC,		0x06AC},	    //0x06AC
		{0x06AD,	0x06AD,		0x06AD,		0x06AD},	    //0x06AD
		{0x06AE,	0x06AE,		0x06AE,		0x06AE},	    //0x06AE
		{0xFB92,	0xFB93,		0xFB94,		0xFB95},	//0x06AF		For Persian
		{0x06B0,	0x06B0,		0x06B0,		0x06B0},	    //0x06B0
		{0x06B1,	0x06B1,		0x06B1,		0x06B1},	    //0x06B1
		{0x06B2,	0x06B2,		0x06B2,		0x06B2},	    //0x06B2
		{0x06B3,	0x06B3,		0x06B3,		0x06B3},	    //0x06B3
		{0x06B4,	0x06B4,		0x06B4,		0x06B4},	    //0x06B4
		{0x06B5,	0x06B5,		0x06B5,		0x06B5},	    //0x06B5
		{0x06B6,	0x06B6,		0x06B6,		0x06B6},	    //0x06B6
		{0x06B7,	0x06B7,		0x06B7,		0x06B7},	    //0x06B7
		{0x06B8,	0x06B8,		0x06B8,		0x06B8},	    //0x06B8
		{0x06B9,	0x06B9,		0x06B9,		0x06B9},	    //0x06B9
		{0x06BA,	0x06BA,		0x06BA,		0x06BA},	    //0x06BA
		{0x06BB,	0x06BB,		0x06BB,		0x06BB},	    //0x06BB
		{0x06BC,	0x06BC,		0x06BC,		0x06BC},	    //0x06BC
		{0x06BD,	0x06BD,		0x06BD,		0x06BD},	    //0x06BD
		{0x06BE,	0x06BE,		0x06BE,		0x06BE},	    //0x06BE
		{0x06BF,	0x06BF,		0x06BF,		0x06BF},	    //0x06BF
		{0x06C0,	0x06C0,		0x06C0,		0x06C0},	    //0x06C0
		{0x06C1,	0x06C1,		0x06C1,		0x06C1},	    //0x06C1
		{0x06C2,	0x06C2,		0x06C2,		0x06C2},	    //0x06C2
		{0x06C3,	0x06C3,		0x06C3,		0x06C3},	    //0x06C3
		{0x06C4,	0x06C4,		0x06C4,		0x06C4},	    //0x06C4
		{0x06C5,	0x06C5,		0x06C5,		0x06C5},	    //0x06C5
		{0x06C6,	0x06C6,		0x06C6,		0x06C6},	    //0x06C6
		{0x06C7,	0x06C7,		0x06C7,		0x06C7},	    //0x06C7
		{0x06C8,	0x06C8,		0x06C8,		0x06C8},	    //0x06C8
		{0x06C9,	0x06C9,		0x06C9,		0x06C9},	    //0x06C9
		{0x06CA,	0x06CA,		0x06CA,		0x06CA},	    //0x06CA
		{0x06CB,	0x06CB,		0x06CB,		0x06CB},	    //0x06CB
		{0xFBFC,	0xFBFD,		0xFBFE,		0xFBFF},	//0x06CC		For Persian


};


STATIC CHARMAPITEM_toUnicode ISO_8859_06_NUM_TO_UNICODE[] =
{
	{0x30,	0x0660},	//Digit Zero
	{0x31,	0x0661},
	{0x32,	0x0662},
	{0x33,	0x0663},
	{0x34,	0x0664},
	{0x35,	0x0665},
	{0x36,	0x0666},
	{0x37,	0x0667},
	{0x38,	0x0668},
	{0x39,	0x0669},

};



HBOOL MWC_UTIL_CheckSpecialCharacterInString(CH_UTF8 *pStr)
{
	if( pStr == NULL )
	{
		return FALSE;
	}

	while (*pStr)
	{
		if (*pStr >= 0xa0)
		{
			return TRUE;
		}
		pStr++;
	}
	return FALSE;

}

HBOOL MWC_UTIL_IsDualJoiningArabicChar(CH_UCS2 oneChar)
{
	if( (oneChar == 0x0626) ||
		(oneChar == 0x0628) ||
		(0x062A <= oneChar && oneChar <= 0x062E) ||
		(0x0633 <= oneChar && oneChar <= 0x063A) ||
		(0x0641 <= oneChar && oneChar <= 0x064A) ||
		(0x0678 <= oneChar && oneChar <= 0x067E) ||
		(0x0680 <= oneChar && oneChar <= 0x0687) ||
		(0x069A <= oneChar && oneChar <= 0x06BF) ||
		(oneChar == 0x06C1) ||
		(oneChar == 0x06CC) ||
		(oneChar == 0x06CE) ||
		(0x06D0 <= oneChar && oneChar <= 0x06D1) ||
		(0x06FA <= oneChar && oneChar <= 0x06FC) )
	{
		return TRUE;
	}

	return FALSE;
}

HBOOL MWC_UTIL_IsRightJoiningArabicChar(CH_UCS2 oneChar)
{
	if( (0x0622 <= oneChar && oneChar <= 0x0625) ||
		(oneChar == 0x0627) ||
		(oneChar == 0x0629) ||
		(0x062F <= oneChar && oneChar <= 0x0632) ||
		(oneChar == 0x0648) ||
		(0x0671 <= oneChar && oneChar <= 0x0673) ||
		(0x0675 <= oneChar && oneChar <= 0x0677) ||
		(0x0688 <= oneChar && oneChar <= 0x0689) ||
		(0x0690 <= oneChar && oneChar <= 0x0699) ||
		(oneChar == 0x06C0) ||
		(0x06C2 <= oneChar && oneChar <= 0x06CB) ||
		(oneChar == 0x06CD) ||
		(oneChar == 0x06CF) ||
		(0x06D2 <= oneChar && oneChar <= 0x06D3) )
	{
		return TRUE;
	}

	return FALSE;

}

HBOOL MWC_UTIL_CheckUnicodeArabicCharacterInString(CH_UCS2 *pStr)
{

	if( pStr == NULL )
	{
		return FALSE;
	}
	while (*pStr)
	{
		if( (*pStr >= 0x0621 && *pStr <= 0x06F9) ||
			(*pStr >= 0xFB50 && *pStr <= 0xFEFC) )
		{
			return TRUE;
		}
		pStr++;
	}
	return FALSE;

}

/**************************************************
//revert writing direction to right-to-left
//don't do this on numbers, though
//depending on context (preceding/succeeding letter), for each "abstract" letter select one of two or four shape variants (glyphs) which are happily also in the Unicode, page FE)
//substitute punctuations (parentheses go the other way round!)
//line-breaks need much more treatment, otherwise Arabic text seems to run bottom-up!
//optionally (if the font allows), use multi-letter ligatures
****************************************************************/
ConvEncoding_Err_t	MWC_UTIL_ConvertLogicalAraToVisualAra(CH_UCS2 *pLogStr, HINT32 nUnicodeStrLen, CH_UCS2 *pVisStr, HINT32 nBufSize, HINT32 *nVisualOrderStrLen)
{
	HINT32			i = 0;
	HINT32			j = 0;
	HINT32			temp = 0;
	HINT32			nStrLen = 0;
	HINT32			startPoint = 0;

	CH_UCS2 	*contextFormStr = NULL;
	CH_UCS2		nextCh = NULL;
	CH_UCS2		prevCh = NULL;
	CH_UCS2		currCh = NULL;
	CH_UCS2		tempCh = NULL;

	if( pLogStr == NULL || pVisStr == NULL || nVisualOrderStrLen == NULL)
	{
		return ERR_FAIL;
	}
	contextFormStr = (CH_UCS2 *)OxMW_Malloc(nBufSize * sizeof(CH_UCS2));
	if(contextFormStr == NULL)
	{
		return ERR_FAIL;
	}
	HxSTD_memset((CH_UCS2 *)(contextFormStr), 0, nBufSize * sizeof(CH_UCS2));


	/////////////////////// Basic glyphs for Arabic language contextual forms
	while(i <= nUnicodeStrLen)
	{
		if ( i == 0 )
		{
			prevCh = 0x0020;
		}
		else
		{
			prevCh = pLogStr[i-1];
		}

		currCh = pLogStr[i];

		if ( i == nUnicodeStrLen )
		{
			nextCh = 0x0020;
		}
		else
		{
			nextCh = pLogStr[i+1];
		}

		if( currCh >= 0x0621 && currCh <= 0x06CC )
		{
			if( MWC_UTIL_IsRightJoiningArabicChar(currCh) && MWC_UTIL_IsRightJoiningArabicChar(prevCh) )
			{
				if( (currCh == 0x0624 || currCh == 0x0648) && (prevCh == 0x0626 || prevCh == 0x064a)  )
				{
					contextFormStr[i] = UNICODE_TO_POSITION_CONTEXTUAL[currCh - 0x0621].usFinal;
					if ( i-2 > 0 &&
						(   pLogStr[i-2] == 0x0624 ||
						pLogStr[i-2] == 0x0648 ||
						pLogStr[i-2] == 0x062F ||
						pLogStr[i-2] == 0x0630 ||
						pLogStr[i-2] == 0x0631 ||
						pLogStr[i-2] == 0x0691 ||
						pLogStr[i-2] == 0x0692 ||
						pLogStr[i-2] == 0x0695 ||
						pLogStr[i-2] == 0x0698)	) //zain, dal, waw, reh
					{
						contextFormStr[i-1] = UNICODE_TO_POSITION_CONTEXTUAL[prevCh - 0x0621].usInitial;
					}
				}
				else
				{
					contextFormStr[i] = UNICODE_TO_POSITION_CONTEXTUAL[currCh - 0x0621].usIsolated;
				}
			}
			else if( MWC_UTIL_IsDualJoiningArabicChar(currCh) && MWC_UTIL_IsRightJoiningArabicChar(prevCh) )
			{
				if( nextCh >= 0x0621 && nextCh <= 0x06CC )
				{
					contextFormStr[i] = UNICODE_TO_POSITION_CONTEXTUAL[currCh - 0x0621].usInitial;
				}
				else
				{
					contextFormStr[i] = UNICODE_TO_POSITION_CONTEXTUAL[currCh - 0x0621].usFinal;
				}
			}
			else if( (prevCh >= 0x0621 && prevCh <= 0x06CC) && (nextCh >= 0x0621 && nextCh <= 0x06CC) )
			{
				contextFormStr[i] = UNICODE_TO_POSITION_CONTEXTUAL[currCh - 0x0621].usMedial;
			}
			else if( !(prevCh >= 0x0621 && prevCh <= 0x06CC) && (nextCh >= 0x0621 && nextCh <= 0x06CC) )
			{
				contextFormStr[i] = UNICODE_TO_POSITION_CONTEXTUAL[currCh - 0x0621].usInitial;
			}
			else if( !(prevCh >= 0x0621 && prevCh <= 0x06CC) && !(nextCh >= 0x0621 && nextCh <= 0x06CC) )
			{
				contextFormStr[i] = UNICODE_TO_POSITION_CONTEXTUAL[currCh - 0x0621].usIsolated;
			}
			else if( (prevCh >= 0x0621 && prevCh <= 0x06CC) && !(nextCh >= 0x0621 && nextCh <= 0x06CC) )
			{
				contextFormStr[i] = UNICODE_TO_POSITION_CONTEXTUAL[currCh - 0x0621].usFinal;
			}

			if( prevCh == 0x0622 || prevCh == 0x0623 || prevCh == 0x0625 || prevCh == 0x0627 ) //Alef
			{
				if( nextCh >= 0x0621 && nextCh <= 0x06CC )
				{
					contextFormStr[i] = UNICODE_TO_POSITION_CONTEXTUAL[currCh - 0x0621].usInitial;
				}
				else
				{
					contextFormStr[i] = UNICODE_TO_POSITION_CONTEXTUAL[currCh - 0x0621].usIsolated;
				}
			}

			////////ligature, LAM WITH ALEF form, LAM이 isolated 혹은 final일때
			if (contextFormStr[i]==0xFEDD || contextFormStr[i]==0xFEDE)
			{
				if( nextCh==0x0622 )
				{
					contextFormStr[i] = 0xFEF5 + (contextFormStr[i] - 0xFEDD);
					i++;
				}
				else if( nextCh==0x0623 )
				{
					contextFormStr[i] = 0xFEF7 + (contextFormStr[i] - 0xFEDD);
					i++;
				}
				else if( nextCh==0x0625 )
				{
					contextFormStr[i] = 0xFEF9 + (contextFormStr[i] - 0xFEDD);
					i++;
				}
				else if( nextCh==0x0627 )
				{
					contextFormStr[i] = 0xFEFB + (contextFormStr[i] - 0xFEDD);
					i++;
				}
			}
			else if (contextFormStr[i]==0xFEDF) // ligature,  LAM 이 initial일때
			{
				if (nextCh==0x0622 || nextCh==0x0623 || nextCh==0x0625 || nextCh==0x0627)
				{
					contextFormStr[i] = 0xFEFB;
					i++;
				}

			}
			else if (contextFormStr[i]==0xFEE0) // ligature,  LAM 이 medial일때
			{
				if (nextCh==0x0622 || nextCh==0x0623 || nextCh==0x0625 || nextCh==0x0627)
				{
					contextFormStr[i] = 0xFEFC;
					i++;
				}

			}

		}
		else if( !(currCh >= 0x0621 && currCh <= 0x064A) )
		{
			contextFormStr[i] = currCh;

		}

		i++;
	}


	///////////	//reverse the string, 영어,   숫자는 뒤집지 않는다, (아랍어로 표현되든, 1,2,3..으로 표현되든)


	i=0;
	nStrLen = nUnicodeStrLen;
	while(i <= nStrLen)
	{
		if( contextFormStr[i] == 0x0000)
		{
			startPoint++;
			i++;
			continue;

		}

		//괄호의 경우 반대 모양으로.
		if( contextFormStr[i] == 0x0028)
		{
			contextFormStr[i] = 0x0029;
		}
		else if( contextFormStr[i] == 0x0029)
		{
			contextFormStr[i] = 0x0028;
		}
		else if( contextFormStr[i] == 0x005B)
		{
			contextFormStr[i] = 0x005D;
		}
		else if( contextFormStr[i] == 0x005D)
		{
			contextFormStr[i] = 0x005B;
		}
		else if( contextFormStr[i] == 0x007B)
		{
			contextFormStr[i] = 0x007D;
		}
		else if( contextFormStr[i] == 0x007D)
		{
			contextFormStr[i] = 0x007B;
		}

		if( (contextFormStr[i] >= 0x060c && contextFormStr[i] <= 0x065A) ||
			(contextFormStr[i] >= 0x066A && contextFormStr[i] <= 0x06D5) ||
			(contextFormStr[i] >= 0xFB50 && contextFormStr[i] <= 0xFEFC) ||
			(contextFormStr[i] == 0x0020) ||
			(contextFormStr[i] == 0x0028) ||
			(contextFormStr[i] == 0x0029) ||
			(contextFormStr[i] == 0x005B) ||
			(contextFormStr[i] == 0x005D) ||
			(contextFormStr[i] == 0x007B) ||
			(contextFormStr[i] == 0x007D) ||
			(contextFormStr[i] == 0x2023) ||
			(contextFormStr[i] == 0x002C) )//||
			//	(contextFormStr[i] == 0x003A) ||
			//	(contextFormStr[i] == 0x0030) )// || (contextFormStr[i] == 0x002F))
		{
			pVisStr[nUnicodeStrLen] = contextFormStr[i];

		}
		else{

			temp = i;
			while(1)
			{
				if( temp > nStrLen )
				{
					break;

				}
				else if( (contextFormStr[temp] >= 0x060c && contextFormStr[temp] <= 0x065A) ||
					(contextFormStr[temp] >= 0x066A && contextFormStr[temp] <= 0x06D5) ||
					(contextFormStr[temp] >= 0xFB50 && contextFormStr[temp] <= 0xFEFC) ||
					(contextFormStr[temp] == 0x0020) ||
					(contextFormStr[temp] == 0x0028) ||
					(contextFormStr[temp] == 0x0029) ||
					(contextFormStr[temp] == 0x005B) ||
					(contextFormStr[temp] == 0x005D) ||
					(contextFormStr[temp] == 0x007B) ||
					(contextFormStr[temp] == 0x007D) ||
					(contextFormStr[temp] == 0x2023) ||
					(contextFormStr[temp] == 0x002C) )// ||
					//	 (contextFormStr[temp] == 0x003A))// || (contextFormStr[temp] == 0x002F))
				{

					if((temp+1<=nStrLen && temp+2<=nStrLen) && (contextFormStr[temp] == 0x0020 && (contextFormStr[temp+1] == 0x002d || contextFormStr[temp+1] == 0x007e) && contextFormStr[temp+2] == 0x0020) )
					{
						temp++;
					}
					else if((temp-1>=0 && temp-2>=0) && (contextFormStr[temp] == 0x0020 && (contextFormStr[temp-1] == 0x002d || contextFormStr[temp-1] == 0x007e) && contextFormStr[temp-2] == 0x0020) )
					{
						temp++;
					}
					else if(contextFormStr[temp] == 0x0020 && temp + 1 < nStrLen)
					{
						tempCh = NULL;
						tempCh = contextFormStr[temp+1];
						if( !((tempCh >= 0x060c && tempCh <= 0x06F9) || (tempCh >= 0xFB50 && tempCh <= 0xFEFC)) )
							temp++;
						else
							break;
					}
					else
					{
						break;
					}

				}
				else
				{
					temp++;
				}
			}
			temp--;

			for(j=temp; j >= i; j--)
			{
				pVisStr[nUnicodeStrLen] = contextFormStr[j];

				nUnicodeStrLen--;
			}
			i = temp + 1;
			continue;

		}


		nUnicodeStrLen--;
		i++;

	}

	i=0;
	while(startPoint <= (nStrLen+1))
	{
		pVisStr[i] = pVisStr[startPoint];
		i++;
		startPoint++;
	}


	if(contextFormStr != NULL)
	{
		OxMW_Free(contextFormStr);
	}

	*nVisualOrderStrLen = MWC_UTIL_UCS2Strlen(pVisStr);

	return ERR_OK;
}

#define _________________________PUBLIC_FUNCTION__________________________________

HERROR MWC_UTIL_CodePage_RegisterArabic(void)
{

	return ERR_OK;
}


