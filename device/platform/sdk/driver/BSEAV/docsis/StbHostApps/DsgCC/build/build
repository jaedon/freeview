#!/bin/bash

CROSS_ROOT=`which mipsel-linux-gcc`
export CROSSDEV_ROOT=${CROSS_ROOT%/bin/mipsel-linux-gcc}
export CROSS_COMPILE=$CROSSDEV_ROOT/bin/mipsel-linux

case $1 in
	dsgcc )
		builddir=../StbApp_DsgCC/linux
		outputdir=../StbApp_DsgCC/linux/bcm
                if [ "$2" == "slim" ]; then
                  outputdir=../StbApp_DsgCC/linux/bcm\_$2
                fi
		outputfilename=Linux
		outputfile=$outputdir/$outputfilename
		targetdir=`pwd`
		targetfilename=dsgcc
		
		echo "  Outputfile= $outputfile Outputdir= $outputdir"
		echo "  Building DSGCC using TOOLCHAIN: '$CROSSDEV_ROOT/bin/$ARCH' "

		cd $builddir
		./makeapp $2 $3 $4 $5 $6
		cd $targetdir
		if [ -e $outputfile ]; then
   		    cp -u $outputfile $targetdir/$targetfilename
		else
   		    rm -f $targetdir/$targetfilename
		fi
		
		outputfile=$outputdir/dsgcclib.a
		targetfilename=dsgcclib.a
		if [ -e $outputfile ]; then
		    cp -u $outputfile $targetdir/$targetfilename
		fi
		;;

	dsgtestclient )
		# - Linux defaults
		export TARGET_OS=Linux
		export CPU=RC32364
		export LINUX_VERSION=18
		builddir=../DsgCC/ClientInterface/SampleApp/Linux
		outputdir=../DsgCC/ClientInterface/SampleApp/Linux
		outputfilename=Linux
		outputfile=$outputdir/$outputfilename
		targetdir=.
		targetfilename=dsgtestclient
		
		cd $builddir
		make -f ./Makefile Linux $2
		if [ -e $outputfile ]; then
   		    cp -u $outputfile $targetdir/$targetfilename
		else
   		    rm -f $targetdir/$targetfilename
		fi
		echo "  Building DSG test client"
		echo "  Using '$CROSSDEV_ROOT/bin/$ARCH' toolchain"
		;;

	* )
		echo "This batch file is used to build various components of Docsis for Bcm$PLATFORM."
		echo
		echo "Usage: build type [clean]"
		echo
		echo "Parameters:"
		echo "   type            = bsp, cmapp, dsgcc, estbsnmp or dsgtestclient"
 		echo "   clean           = clean all binaries for build type specified"
		echo "Examples:"
		echo "    build dsgcc    - Builds DSG Client Controller"
		echo "    build dsgtestclient    - Builds a sample DSG Client to test the dsgcc application"
		;;
esac
