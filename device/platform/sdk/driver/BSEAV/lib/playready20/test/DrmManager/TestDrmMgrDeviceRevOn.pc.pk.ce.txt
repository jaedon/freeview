-------------------BVT ends here--------------------------
'REVOCATION TESTS

30030: Add device revocation list to secure store, and retrieve it using Drm_Revocation_GetList and then call DRM_MGR_GetRevInfo
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(!3x8NSroVg4eXCzWqPU!BA==,{00000507-0000-0010-8000-00AA006D2EA4},64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<REVINFOVERSION>1</REVINFOVERSION><ONACTION type=\"Play\"><RESTRICTIONS><COMPRESSEDDIGITALVIDEO level='300'/></RESTRICTIONS><CONDITION><![CDATA[1]]></CONDITION></ONACTION>",ERdtAxucAFKJnAWxuFQYuyVd3BAFR7N!PO8vPJWRPzxV0MaUNCXrSQ==,300RGKoeuuIsIX04ZRKnNVZVP3fFXjykdp0o2hRG)
TestManagerSetRevocationInfo(files\rlvi_1_device_1.b64.signed_wchar)
TestManagerSetRevocation({3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_1.b64_wchar)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
TestManagerPrepareOPLCallback(300,100,100,100,100,0,0)
TestManagerBind(0 don't overwrite drmmanager context, Dump,Dump, Use Callback function)
TestManagerCommit 
TestManagerGetRevocationList(DRM_REVOCATION_TYPE_WMDRM_REVINFO, files\rlvi_1_device_1.b64.signed_wchar,TRUE)
TestManagerGetRevocationList({3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_1.b64_wchar)
TestManagerReinitialize( Reset, FALSE, FALSE )
EndIf


30050: Process a different license response containing the same Device revocation list
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(!3x8NSroVg4eXCzWqPU!BA==,{00000507-0000-0010-8000-00AA006D2EA4},64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<REVINFOVERSION>1</REVINFOVERSION><ONACTION type=\"Play\"><RESTRICTIONS><COMPRESSEDDIGITALVIDEO level='300'/></RESTRICTIONS><CONDITION><![CDATA[1]]></CONDITION></ONACTION>",ERdtAxucAFKJnAWxuFQYuyVd3BAFR7N!PO8vPJWRPzxV0MaUNCXrSQ==,300RGKoeuuIsIX04ZRKnNVZVP3fFXjykdp0o2hRG)
TestManagerSetRevocationInfo(files\rlvi_1_device_1.b64.signed_wchar)
TestManagerSetRevocation({3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_1.b64_wchar)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
TestManagerGetRevocationList(DRM_REVOCATION_TYPE_WMDRM_REVINFO, files\rlvi_1_device_1.b64.signed_wchar,TRUE)
TestManagerGetRevocationList({3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_1.b64_wchar)
TestManagerInitResponse
TestManagerAddLicenseToResponse(Ygiiuk82iokl11==,{00000504-0000-0010-8000-00AA006D2EA4},0,NULL,ERdtAxucAFKJnAWxuFQYuyVd3BAFR7N!PO8vPJWRPzxV0MaUNCXrSQ==,300RGKoeuuIsIX04ZRKnNVZVP3fFXjykdp0o2hRG)
TestManagerSetRevocationInfo(files\rlvi_1_device_1.b64.signed_wchar)
TestManagerSetRevocation({3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_1.b64_wchar)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
TestManagerGetRevocationList(DRM_REVOCATION_TYPE_WMDRM_REVINFO, files\rlvi_1_device_1.b64.signed_wchar,TRUE)
TestManagerGetRevocationList({3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_1.b64_wchar)
TestManagerReinitialize( Reset, FALSE, FALSE )
EndIf


30140: Process a license response containing Device revocation list with higher index
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(!3x8NSroVg4eXCzWqPU!BA==,{00000507-0000-0010-8000-00AA006D2EA4},64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<REVINFOVERSION>1</REVINFOVERSION><ONACTION type=\"Play\"><RESTRICTIONS><COMPRESSEDDIGITALVIDEO level='300'/></RESTRICTIONS><CONDITION><![CDATA[1]]></CONDITION></ONACTION>",ERdtAxucAFKJnAWxuFQYuyVd3BAFR7N!PO8vPJWRPzxV0MaUNCXrSQ==,300RGKoeuuIsIX04ZRKnNVZVP3fFXjykdp0o2hRG)
TestManagerSetRevocationInfo(files\rlvi_1_device_1.b64.signed_wchar)
TestManagerSetRevocation({3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_1.b64_wchar)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
TestManagerGetRevocationList({3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_1.b64_wchar)
TestManagerGetRevocationList(DRM_REVOCATION_TYPE_WMDRM_REVINFO, files\rlvi_1_device_1.b64.signed_wchar,TRUE)
TestManagerInitResponse
TestManagerAddLicenseToResponse(Ygiiuk82iokl11==,{00000504-0000-0010-8000-00AA006D2EA4},0,NULL,ERdtAxucAFKJnAWxuFQYuyVd3BAFR7N!PO8vPJWRPzxV0MaUNCXrSQ==,300RGKoeuuIsIX04ZRKnNVZVP3fFXjykdp0o2hRG)
TestManagerSetRevocationInfo(files\rlvi_2_device_2.b64.signed_wchar)
TestManagerSetRevocation({3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_2.b64_wchar)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
TestManagerGetRevocationList({3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_2.b64_wchar)
TestManagerGetRevocationList(DRM_REVOCATION_TYPE_WMDRM_REVINFO, files\rlvi_2_device_2.b64.signed_wchar,TRUE)
TestManagerReinitialize( Reset, FALSE, FALSE )
EndIf


30150: Process a license response containing Device revocation list with lower index
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(!3x8NSroVg4eXCzWqPU!BA==,{00000507-0000-0010-8000-00AA006D2EA4},64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<REVINFOVERSION>1</REVINFOVERSION><ONACTION type=\"Play\"><RESTRICTIONS><COMPRESSEDDIGITALVIDEO level='300'/></RESTRICTIONS><CONDITION><![CDATA[1]]></CONDITION></ONACTION>",ERdtAxucAFKJnAWxuFQYuyVd3BAFR7N!PO8vPJWRPzxV0MaUNCXrSQ==,300RGKoeuuIsIX04ZRKnNVZVP3fFXjykdp0o2hRG)
TestManagerSetRevocationInfo(files\rlvi_1_device_2.b64.signed_wchar)
TestManagerSetRevocation({3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_2.b64_wchar)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
TestManagerGetRevocationList({3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_2.b64_wchar)
TestManagerGetRevocationList(DRM_REVOCATION_TYPE_WMDRM_REVINFO, files\rlvi_1_device_2.b64.signed_wchar,TRUE)
TestManagerInitResponse
TestManagerAddLicenseToResponse(Ygiiuk82iokl11==,{00000504-0000-0010-8000-00AA006D2EA4},0,NULL,ERdtAxucAFKJnAWxuFQYuyVd3BAFR7N!PO8vPJWRPzxV0MaUNCXrSQ==,300RGKoeuuIsIX04ZRKnNVZVP3fFXjykdp0o2hRG)
TestManagerSetRevocationInfo(files\rlvi_2_device_1.b64.signed_wchar)
TestManagerSetRevocation({3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_1.b64_wchar)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
TestManagerGetRevocationList({3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_2.b64_wchar)
TestManagerGetRevocationList(DRM_REVOCATION_TYPE_WMDRM_REVINFO, files\rlvi_2_device_1.b64.signed_wchar,TRUE)
TestManagerReinitialize( Reset, FALSE, FALSE )
EndIf


30210: Process a license response containing invalid device revocation list, it should fail 
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(!3x8NSroVg4eXCzWqPU!BA==,{00000507-0000-0010-8000-00AA006D2EA4},64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<REVINFOVERSION>1</REVINFOVERSION><ONACTION type=\"Play\"><RESTRICTIONS><COMPRESSEDDIGITALVIDEO level='300'/></RESTRICTIONS><CONDITION><![CDATA[1]]></CONDITION></ONACTION>",ERdtAxucAFKJnAWxuFQYuyVd3BAFR7N!PO8vPJWRPzxV0MaUNCXrSQ==,300RGKoeuuIsIX04ZRKnNVZVP3fFXjykdp0o2hRG)
TestManagerSetRevocationInfo(files\rlvi_1_device_1.b64.signed_wchar)
TestManagerSetRevocation({3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\invalid_crl_device_1.b64_wchar)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)=-2147024809
TestManagerReinitialize( Reset, FALSE, FALSE )

' DRM_MGR_StoreRevocationLists test cases

30480: Set Device CRL and RLVI using DRM_MGR_StoreRevocationLists.  Then update the RLVI.  Then update the Device CRL and RLVI.
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(!3x8NSroVg4eXCzWqPU!BA==,{00000507-0000-0010-8000-00AA006D2EA4},64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<REVINFOVERSION>1</REVINFOVERSION><ONACTION type=\"Play\"><RESTRICTIONS><COMPRESSEDDIGITALVIDEO level='300'/></RESTRICTIONS><CONDITION><![CDATA[1]]></CONDITION></ONACTION>",ERdtAxucAFKJnAWxuFQYuyVd3BAFR7N!PO8vPJWRPzxV0MaUNCXrSQ==,300RGKoeuuIsIX04ZRKnNVZVP3fFXjykdp0o2hRG)
TestManagerStoreRevocationLists(FALSE, 2, {3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_1, {CCDE5A55-A688-4405-A88B-D13F90D5BA3E}, files\rlvi_1_device_1.b64.signed_wchar)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
TestManagerGetRevocationList({3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_1.b64_wchar)
TestManagerGetRevocationList(DRM_REVOCATION_TYPE_WMDRM_REVINFO, files\rlvi_1_device_1.b64.signed_wchar,TRUE)
'update RLVI
TestManagerInitResponse
TestManagerAddLicenseToResponse(!3x8NSroVg4eXCzWqPU!BA==,{00000507-0000-0010-8000-00AA006D2EA6},64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<REVINFOVERSION>1</REVINFOVERSION><ONACTION type=\"Play\"><RESTRICTIONS><COMPRESSEDDIGITALVIDEO level='300'/></RESTRICTIONS><CONDITION><![CDATA[1]]></CONDITION></ONACTION>",ERdtAxucAFKJnAWxuFQYuyVd3BAFR7N!PO8vPJWRPzxV0MaUNCXrSQ==,300RGKoeuuIsIX04ZRKnNVZVP3fFXjykdp0o2hRG)
TestManagerStoreRevocationLists(FALSE, 1, {CCDE5A55-A688-4405-A88B-D13F90D5BA3E}, files\rlvi_2_device_1.b64.signed_wchar)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
TestManagerGetRevocationList({3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_1.b64_wchar)
TestManagerGetRevocationList(DRM_REVOCATION_TYPE_WMDRM_REVINFO, files\rlvi_2_device_1.b64.signed_wchar,TRUE)
'update device CRL
TestManagerInitResponse
TestManagerAddLicenseToResponse(!3x8NSroVg4eXCzWqPU!BA==,{00000507-0000-0010-8000-00AA006D2EA8},64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<REVINFOVERSION>1</REVINFOVERSION><ONACTION type=\"Play\"><RESTRICTIONS><COMPRESSEDDIGITALVIDEO level='300'/></RESTRICTIONS><CONDITION><![CDATA[1]]></CONDITION></ONACTION>",ERdtAxucAFKJnAWxuFQYuyVd3BAFR7N!PO8vPJWRPzxV0MaUNCXrSQ==,300RGKoeuuIsIX04ZRKnNVZVP3fFXjykdp0o2hRG)
TestManagerStoreRevocationLists(FALSE, 1, {3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_2)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
TestManagerGetRevocationList({3129E375-CEB0-47D5-9CCA-9DB74CFD4332}, files\crl_device_2.b64_wchar)
TestManagerGetRevocationList(DRM_REVOCATION_TYPE_WMDRM_REVINFO, files\rlvi_2_device_1.b64.signed_wchar,TRUE)
TestManagerReinitialize( Reset, FALSE, FALSE )
EndIf

