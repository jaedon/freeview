' =================================================================================================
8000:DRT: Create a license with an Aux Key object and then verify it.
TestStartLicense()
TestAddAuxKeyObject(3,6,12)
TestFinishLicense()
TestUnpackLicense()
TestVerifyLicense(3,6,12)

' =================================================================================================
8001:DRT: Create a license with an UplinkX object and then verify it.
TestStartLicense()
TestAddUplinkXObject(1 TRUE,3,6,12)
TestFinishLicense()
TestUnpackLicense()
TestVerifyLicense(3,6,12)   

' =================================================================================================
'8002:DRT: Create Aux Key and UplinkX and then try to derive the keys from UplinkX locations (success).
'TestStartLicense()
'TestAddAuxKeyObject(16)
'TestFinishLicense()
'TestAddUplinkXObject(0 FALSE,5,17)
'TestBBXCalculateKeysDerived()

' =================================================================================================
'8003:DRT: Create Aux Key and UplinkX and then try to derive the keys from UplinkX locations (fail).
'TestStartLicense()
'TestAddAuxKeyObject(6,12,20)
'TestFinishLicense()
'TestAddUplinkXObject(0 FALSE,7,15,25)
'TestBBXCalculateKeysDerived() = 0x8004CC01 DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE

' =================================================================================================
8004:BVT: No Key Derivation Needed (location 6 in both root and leaf)
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root 2 6 12" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 6" )
TestManagerGenerateXMRResponse( LEAF, ROOT)
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump, NULL, NULL )

' =================================================================================================
8005:FUNC: Root with Zero locations, Leaf with Zero locations
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 0 locations" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf with 0 locations" )
TestManagerGenerateXMRResponse( LEAF, ROOT)
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump, NULL, NULL )=DRM_E_INVALIDARG

' =================================================================================================
8006:FUNC: Verify checksum, leaf with an incorrect seed
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 1 location" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf with incorrect seed" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UPLINKLICENSENOTFOUND

' =================================================================================================
8100:BVT: Scalable licenses with Key derivation towards left side only in the tree
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root 2 6 12" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 1 5 9" )
TestManagerGenerateXMRResponse( LEAF, ROOT)
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL,NULL, {95227A28-3FEE-4EB5-AF13-F77A5258A919})

' =================================================================================================
8101:BVT: Scalable licenses with Key derivation towards right side only in the tree
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root 2 6 12" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 3 7 15" )
TestManagerGenerateXMRResponse( LEAF, ROOT)
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL,NULL)

' =================================================================================================
8102:BVT: Scalable licenses with Key derivation towards left and then right side in the tree
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root 2 6 12" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 11" )
TestManagerGenerateXMRResponse( LEAF, ROOT)
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL,NULL)

' =================================================================================================
8103:BVT: Scalable licenses with Key derivation towards right and then left side in the tree
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root 8" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 9 13" )
TestManagerGenerateXMRResponse( LEAF, ROOT)
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL,NULL)

' =================================================================================================
8104:BVT: Negative test - Scalable licenses with Key derivation leaf on the left side can't be derived
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root 12" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 1 7" )

TestManagerGenerateXMRResponse( LEAF, ROOT)
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL,NULL)=0x8004CC01 ( DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE )

' =================================================================================================
8105:BVT: Negative test - Scalable licenses with Key derivation leaf on the right side can't be derived
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root 6" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 9" )
TestManagerGenerateXMRResponse( LEAF, ROOT)
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL,NULL)=0x8004CC01 ( DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE )

' =================================================================================================
8106:BVT: Negative test - Scalable licenses with Key derivation towards the middle can't be derived
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root 2 12" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 5 7" )
TestManagerGenerateXMRResponse( LEAF, ROOT)
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL,NULL)=0x8004CC01 ( DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE )

' =================================================================================================
21276:BVT: Scale to 2500 locations in the root
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Permanent Root with 2500 locations" )
TestManagerGenerateXMRResponse( ROOT)
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerCleanLicenseStore(1)
TestManagerCreateXMRLicenseFromPool( LEAF0, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF0 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump, NULL, NULL)
TestManagerCleanLicenseStore(1)
TestManagerCreateXMRLicenseFromPool( LEAF1, LiveTVLicenses.xml, "Leaf 1" )
TestManagerGenerateXMRResponse( LEAF1 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump, NULL, NULL)
TestManagerCleanLicenseStore(1)
TestManagerCreateXMRLicenseFromPool( LEAF2499, LiveTVLicenses.xml, "Leaf 2499" )
TestManagerGenerateXMRResponse( LEAF2499 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump, NULL, NULL)
TestManagerCleanLicenseStore(1)
TestManagerCreateXMRLicenseFromPool( LEAF0_2499, LiveTVLicenses.xml, "Leaf 0 2499" )
TestManagerGenerateXMRResponse( LEAF0_2499 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump, NULL, NULL)
TestManagerCleanLicenseStore(1)
TestManagerCreateXMRLicenseFromPool( LEAF0_2500, LiveTVLicenses.xml, "Leaf 0 2500" )
TestManagerGenerateXMRResponse( LEAF0_2500 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump, NULL, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)
TestManagerCreateXMRLicenseFromPool( LEAF2500, LiveTVLicenses.xml, "Leaf 2500" )
TestManagerGenerateXMRResponse( LEAF2500 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump, NULL, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)
TestManagerCreateXMRLicenseFromPool( LEAF64L, LiveTVLicenses.xml, "Leaf with 64 locations" )
TestManagerGenerateXMRResponse( LEAF64L )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump, NULL, NULL)
TestManagerCleanLicenseStore(1)
TestManagerCreateXMRLicenseFromPool( LEAF2500L, LiveTVLicenses.xml, "Leaf with 2500 locations" )
TestManagerGenerateXMRResponse( LEAF2500L )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump, NULL, NULL)

' =================================================================================================
21278:BVT: Verify scalable licenses with 129 keys in the leaf
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCreateXMRLicenseFromPool( ROOT1512, LiveTVLicenses.xml, "Root with 1512 locations" )
TestManagerGenerateXMRResponse( ROOT1512 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Permanent Leaf with 129 locations" )
TestManagerGenerateXMRResponse( LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump, NULL, NULL)
TestManagerCleanLicenseStore(1)
TestManagerCreateXMRLicenseFromPool( ROOT2000, LiveTVLicenses.xml, "Root with 2000 locations" )
TestManagerGenerateXMRResponse( ROOT2000 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump, NULL, NULL)
TestManagerCleanLicenseStore(1)
TestManagerCreateXMRLicenseFromPool( ROOT2048, LiveTVLicenses.xml, "Root with 2048 locations" )
TestManagerGenerateXMRResponse( ROOT2048 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump, NULL, NULL)
TestManagerCleanLicenseStore(1)
TestManagerCreateXMRLicenseFromPool( ROOT2304, LiveTVLicenses.xml, "Root with 2304 locations" )
TestManagerGenerateXMRResponse( ROOT2304 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump, NULL, NULL)
TestManagerCleanLicenseStore(1)
TestManagerCreateXMRLicenseFromPool( ROOT2447, LiveTVLicenses.xml, "Root with 2447 locations" )
TestManagerGenerateXMRResponse( ROOT2447 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump, NULL, NULL)
TestManagerCleanLicenseStore(1)
TestManagerCreateXMRLicenseFromPool( ROOT2500, LiveTVLicenses.xml, "Root with 2500 locations" )
TestManagerGenerateXMRResponse( ROOT2500 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump, NULL, NULL)

' =================================================================================================
8107:BVT:Add and delete many licenses with multiple removal dates
TestManagerAddManyXMRLicensesFromPool( 57, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInPast" )
TestManagerAddManyXMRLicensesFromPool( 36, LiveTVLicenses.xml, "KID02LicenseWithRemovalDate10SecsInPast" )
TestManagerAddManyXMRLicensesFromPool( 25, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInFuture" )
TestManagerAddManyXMRLicensesFromPool( 25, LiveTVLicenses.xml, "KID02LicenseWithRemovalDate10SecsInFuture" )
TestManagerAddManyXMRLicensesFromPool( 20, LiveTVLicenses.xml, "LicenseWithRemovalDate1000SecsInFuture" )
TestManagerAddManyXMRLicensesFromPool( 20, LiveTVLicenses.xml, "KID02LicenseWithRemovalDate1000SecsInFuture" )
VerifyNumRemovalDateLicenses( -5s, 93 )
VerifyNumRemovalDateLicenses( 15s, 143 )
VerifyNumRemovalDateLicenses( 1005s, 183 )
' Clean the license store of expired licenses - no licenses should be deleted so the counts remain the same
TestManagerCleanLicenseStore( 1, 0, DELETE_EXPIRED_LICENSES)
VerifyNumRemovalDateLicenses( -5s, 93 )
VerifyNumRemovalDateLicenses( 15s, 143 )
VerifyNumRemovalDateLicenses( 1005s, 183 )
' Clean the license store or licenses with expired removal dates should delete the 93 licenses with removal date = -5 or earlier 
TestManagerCleanLicenseStore( 1, 0, DELETE_REMOVAL_DATE_LICENSES)
VerifyNumRemovalDateLicenses( -5s, 0 )
VerifyNumRemovalDateLicenses( 15s, 50 )
VerifyNumRemovalDateLicenses( 1005s, 90 )
' Delete all licenses with the 2nd KID and verify the removal date entries were also deleted
TestManagerDeleteLicensesByKID( RemovalDateTestKID02aa==, 45 )
VerifyNumRemovalDateLicenses( 15s, 25 )
VerifyNumRemovalDateLicenses( 1005s, 45 )
' Delete all licenses with a removal date <= 1010 seconds in the future and verify the removal date entries were also deleted
TestManagerCleanLicenseStore( 1, 1010, ALL)
VerifyNumRemovalDateLicenses( 15s, 0 )
VerifyNumRemovalDateLicenses( 1005s, 0 )

' =================================================================================================
21279:FUNC: Verify 1000 licenses with expired RemovalDate objects are cleaned up after calling LicenseStoreCleanup
TestManagerAddManyXMRLicensesFromPool( 100, LiveTVLicenses.xml, "Root with random KID" )
TestManagerAddManyXMRLicensesFromPool( 250, LiveTVLicenses.xml, "Root with 30 second RemovalDate and random KID" )
TestManagerAddManyXMRLicensesFromPool( 100, LiveTVLicenses.xml, "Root with random KID"T )
TestManagerAddManyXMRLicensesFromPool( 250, LiveTVLicenses.xml, "Root with 2 hour RemovalDate and random KID" )
TestManagerAddManyXMRLicensesFromPool( 100, LiveTVLicenses.xml, "Root with random KID" )
TestManagerAddManyXMRLicensesFromPool( 250, LiveTVLicenses.xml, "Root with 30 second RemovalDate and random KID" )
TestManagerAddManyXMRLicensesFromPool( 100, LiveTVLicenses.xml, "Root with random KID" )
TestManagerAddManyXMRLicensesFromPool( 250, LiveTVLicenses.xml, "Root with 72 hour RemovalDate and random KID" )
TestManagerAddManyXMRLicensesFromPool( 100, LiveTVLicenses.xml, "Root with random KID" )
TestVerifyStoreSlotCount( "LicStorexmr", 1500 )
TestVerifyStoreSlotCount( "removaldatestr", 1000 )
TestManagerCleanLicenseStore( 1, 120 )
TestVerifyStoreSlotCount( "LicStorexmr", 1000 )
TestVerifyStoreSlotCount( "removaldatestr", 500 )
TestManagerCleanLicenseStore( 1, 120 )
TestVerifyStoreSlotCount( "LicStorexmr", 1000 )
TestVerifyStoreSlotCount( "removaldatestr", 500 )
TestManagerCleanLicenseStore( 1, 10800  )
TestVerifyStoreSlotCount( "LicStorexmr", 750 )
TestVerifyStoreSlotCount( "removaldatestr", 250 )
TestManagerCleanLicenseStore( 1, 10800  )
TestVerifyStoreSlotCount( "LicStorexmr", 750 )
TestVerifyStoreSlotCount( "removaldatestr", 250 )
TestManagerCleanLicenseStore( 1, 176400  )
TestVerifyStoreSlotCount( "LicStorexmr", 750 )
TestVerifyStoreSlotCount( "removaldatestr", 250 )
TestManagerCleanLicenseStore( 1, 262800  )
TestVerifyStoreSlotCount( "LicStorexmr", 500 )
TestVerifyStoreSlotCount( "removaldatestr", 0 )

' =================================================================================================
8108:BVT:Add license with removal date, bind then delete the license
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE1, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInFuture" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE1 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerSetRights(Play)
TestManagerSetHeader( NORMAL, headerXMR.xml )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)
TestManagerCommit(0 don't overwrite decrypt context, Dump)
VerifyNumRemovalDateLicenses( 10s, 1 )
TestManagerDeleteLicensesByKID( lFmb2gxg0Cr5bfEnJXgJeA==, 1 )
VerifyNumRemovalDateLicenses( 10s, 0 )

' =================================================================================================
8109:BVT:Add multiple licenses with the same KID and removal date
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE1, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInFuture" )
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE2, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInFuture" )
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE3, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInFuture" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE1, SIMPLE_LICENSE2, SIMPLE_LICENSE3 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
VerifyNumRemovalDateLicenses( 10s, 3 )
TestManagerSetRights(Play)
TestManagerSetHeader( NORMAL, headerXMR.xml )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)
TestManagerCommit(0 don't overwrite decrypt context, Dump)

' =================================================================================================
8110:BVT:Attempt to add licenses with removal date and various restrictions requiring secure store entries
TestManagerSetRights(Play)
TestManagerSetHeader( NORMAL, headerXMR.xml )
' Play count
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE1, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInFutureWithPlayCount" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE1 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)=0x8004C013 DRM_E_LICENSENOTFOUND
' Expiration after play
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE2, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInFutureWithExpireAfterUse" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE2 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)=0x8004C013 DRM_E_LICENSENOTFOUND
' Expiration after first use
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE3, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInFutureWithExpireAfterPlay" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE3 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)=0x8004C013 DRM_E_LICENSENOTFOUND
' Expire after store
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE4, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInFutureWithExpireAfterStore" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE4 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)=0x8004C013 DRM_E_LICENSENOTFOUND
' License with expiration date
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE5, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInFutureWithExpiration" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE5 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)=0x8004C013 DRM_E_LICENSENOTFOUND
' Copy count
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE6, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInFutureWithCopyCount" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE6 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)=0x8004C013 DRM_E_LICENSENOTFOUND
' Begin date
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE7, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInFutureWithBeginDate" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE7 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)=0x8004C013 DRM_E_LICENSENOTFOUND

' =================================================================================================
8111:BVT:Add and delete licenses with multiple removal dates
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE1, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInFuture" )
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE2, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInPast" )
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE3, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInPast" )
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE4, LiveTVLicenses.xml, "KID02LicenseWithRemovalDate10SecsInPast" )
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE5, LiveTVLicenses.xml, "KID02LicenseWithRemovalDate10SecsInFuture" )
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE6, LiveTVLicenses.xml, "KID02LicenseWithRemovalDate1000SecsInFuture" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE1, SIMPLE_LICENSE2, SIMPLE_LICENSE3, SIMPLE_LICENSE4, SIMPLE_LICENSE5, SIMPLE_LICENSE6 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
' Verify the number of removal date entries.
' There should be 3 license for removal date = -10   (10 seconds in the past)
' There should be 5 licenses for removal date = 10   (3 with date = -10 and 2 with date = 10)
' There should be 6 licenses for removal date = 1000 (3 with date = -10, 2 with date = 10 and 1 with date = 1000)
VerifyNumRemovalDateLicenses( -10s, 3 )
VerifyNumRemovalDateLicenses( 10s, 5 )
VerifyNumRemovalDateLicenses( 1000s, 6 )
' Clean the license store should delete the 3 licenses with removal date = -10 
TestManagerCleanLicenseStore(1, 0, ALL)
VerifyNumRemovalDateLicenses( -10s, 0 )
VerifyNumRemovalDateLicenses( 10s, 2 )
VerifyNumRemovalDateLicenses( 1000s, 3 )
TestManagerDeleteLicensesByKID( RemovalDateTestKID02aa==, 2 )
VerifyNumRemovalDateLicenses( 10s, 1 )
VerifyNumRemovalDateLicenses( 1000s, 1 )

' =================================================================================================
8117:FUNC:Live TV Streaming with buffered decryptors, same channel (5.1.4.1.1)
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)

TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "LiveTV Root 1" )
TestManagerGenerateXMRResponse( ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader1, headerspool.xml, "Basic v4.1 AESCTR on demand", !3x8NSroVg4eXCzWqPU!BA==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader1, NULL, NULL, pro1.dat )
TestManagerSetHeader( NORMAL, pro1.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF1_1, LiveTVLicenses.xml, "LiveTV Leaf 1_1", NULL, "AESKey1" )
TestAddLicenseToPRO( !3x8NSroVg4eXCzWqPU!BA==, {63BAD16B-CE80-433E-80F4-8E6951B7382C}, LEAF1_1 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader2, headerspool.xml, "Basic v4.1 AESCTR on demand", 6Hnr4J9LTvGQnmJJR!uCCQ==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader2, NULL, NULL, pro2.dat )
TestManagerSetHeader( NORMAL, pro2.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF1_1_2, LiveTVLicenses.xml, "LiveTV Leaf 1_1 copy#2", NULL, "AESKey2" )
TestAddLicenseToPRO( 6Hnr4J9LTvGQnmJJR!uCCQ==, {12863DC2-8610-4E07-A23A-19CDEC8C7BF3}, LEAF1_1_2 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1_2.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_1_2.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_1_2.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1_2, NULL, NULL, {12863DC2-8610-4E07-A23A-19CDEC8C7BF3})

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader3, headerspool.xml, "Basic v4.1 AESCTR on demand", xmbG0Aj0SdirJ82uPKo5HA==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader3, NULL, NULL, pro3.dat )
TestManagerSetHeader( NORMAL, pro3.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF1_1_3, LiveTVLicenses.xml, "LiveTV Leaf 1_1 copy#3", NULL, "AESKey3" )
TestAddLicenseToPRO( xmbG0Aj0SdirJ82uPKo5HA==, {70EE09A0-0324-412C-B8F6-6AC175068396}, LEAF1_1_3 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1_3.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_1_3.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_1_3.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1_3, NULL, NULL, {70EE09A0-0324-412C-B8F6-6AC175068396})

TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_4, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey1" )
TestSetupDecryptor(Decryptor1_1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey2" )
TestSetupDecryptor(Decryptor1_1_2)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey3" )
TestSetupDecryptor(Decryptor1_1_3)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey1" )
TestSetupDecryptor(Decryptor1_4)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

TestManagerCommit

' =================================================================================================
8118:FUNC:Channel change with buffered decryptors, without root license switching (5.1.4.1.3)
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)

TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "LiveTV Root 1" )
TestManagerGenerateXMRResponse( ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader1, headerspool.xml, "Basic v4.1 AESCTR on demand", !3x8NSroVg4eXCzWqPU!BA==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader1, NULL, NULL, pro1.dat )
TestManagerSetHeader( NORMAL, pro1.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF1_1, LiveTVLicenses.xml, "LiveTV Leaf 1_1", NULL, "AESKey1" )
TestAddLicenseToPRO( !3x8NSroVg4eXCzWqPU!BA==, {63BAD16B-CE80-433E-80F4-8E6951B7382C}, LEAF1_1 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader2, headerspool.xml, "Basic v4.1 AESCTR on demand", 6Hnr4J9LTvGQnmJJR!uCCQ==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader2, NULL, NULL, pro2.dat )
TestManagerSetHeader( NORMAL, pro2.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF1_2, LiveTVLicenses.xml, "LiveTV Leaf 1_2", NULL, "AESKey2" )
TestAddLicenseToPRO( 6Hnr4J9LTvGQnmJJR!uCCQ==, {AF43C8A3-1E7B-46C4-8269-3AE78BA4CC6D}, LEAF1_2 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_2.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_2.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_2.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_2, NULL, NULL, {AF43C8A3-1E7B-46C4-8269-3AE78BA4CC6D})

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader3, headerspool.xml, "Basic v4.1 AESCTR on demand", xmbG0Aj0SdirJ82uPKo5HA==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader3, NULL, NULL, pro3.dat )
TestManagerSetHeader( NORMAL, pro3.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF1_3, LiveTVLicenses.xml, "LiveTV Leaf 1_3", NULL, "AESKey3" )
TestAddLicenseToPRO( xmbG0Aj0SdirJ82uPKo5HA==, {E3510748-61E1-440D-99FD-FD24DB1D561A}, LEAF1_3 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_3.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_3.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_3.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_3, NULL, NULL, {E3510748-61E1-440D-99FD-FD24DB1D561A})

TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_4, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey1" )
TestSetupDecryptor(Decryptor1_1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey2" )
TestSetupDecryptor(Decryptor1_2)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey3" )
TestSetupDecryptor(Decryptor1_3)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey1" )
TestSetupDecryptor(Decryptor1_4)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

TestManagerCommit

' =================================================================================================
8119:FUNC:Live TV Streaming without buffering of decryptors (for STB) (5.1.4.1.5)
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)

TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "LiveTV Root 1" )
TestManagerGenerateXMRResponse( ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader1, headerspool.xml, "Basic v4.1 AESCTR on demand", !3x8NSroVg4eXCzWqPU!BA==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader1, NULL, NULL, pro1.dat )
TestManagerSetHeader( NORMAL, pro1.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF1, LiveTVLicenses.xml, "LiveTV Leaf 1_1", NULL, "AESKey1" )
TestAddLicenseToPRO( !3x8NSroVg4eXCzWqPU!BA==, {63BAD16B-CE80-433E-80F4-8E6951B7382C}, LEAF1 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey1" )
TestSetupDecryptor(Decryptor1_1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader2, headerspool.xml, "Basic v4.1 AESCTR on demand", 6Hnr4J9LTvGQnmJJR!uCCQ==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader2, NULL, NULL, pro2.dat )
TestManagerSetHeader( NORMAL, pro2.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF2, LiveTVLicenses.xml, "LiveTV Leaf 1_1 copy#2", NULL, "AESKey2" )
TestAddLicenseToPRO( 6Hnr4J9LTvGQnmJJR!uCCQ==, {12863DC2-8610-4E07-A23A-19CDEC8C7BF3}, LEAF2 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1_2.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_1_2.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_1_2.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1_2, NULL, NULL, {12863DC2-8610-4E07-A23A-19CDEC8C7BF3})

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey2" )
TestSetupDecryptor(Decryptor1_1_2)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader3, headerspool.xml, "Basic v4.1 AESCTR on demand", xmbG0Aj0SdirJ82uPKo5HA==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader3, NULL, NULL, pro3.dat )
TestManagerSetHeader( NORMAL, pro3.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF3, LiveTVLicenses.xml, "LiveTV Leaf 1_1 copy#3", NULL, "AESKey3" )
TestAddLicenseToPRO( xmbG0Aj0SdirJ82uPKo5HA==, {70EE09A0-0324-412C-B8F6-6AC175068396}, LEAF3 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1_3.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_1_3.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_1_3.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1_3, NULL, NULL, {70EE09A0-0324-412C-B8F6-6AC175068396})

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey3" )
TestSetupDecryptor(Decryptor1_1_3)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_4, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey1" )
TestSetupDecryptor(Decryptor1_4)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

' =================================================================================================
8120:FUNC: PK: Channel change without buffering of decryptors, without root license switching (for STB)(5.1.4.1.7)
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)

TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "LiveTV Root 1" )
TestManagerGenerateXMRResponse( ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader1, headerspool.xml, "Basic v4.1 AESCTR on demand", !3x8NSroVg4eXCzWqPU!BA==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader1, NULL, NULL, pro1.dat )
TestManagerSetHeader( NORMAL, pro1.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF1_1, LiveTVLicenses.xml, "LiveTV Leaf 1_1", NULL, "AESKey1" )
TestAddLicenseToPRO( !3x8NSroVg4eXCzWqPU!BA==, {63BAD16B-CE80-433E-80F4-8E6951B7382C}, LEAF1_1 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey1" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader2, headerspool.xml, "Basic v4.1 AESCTR on demand", 6Hnr4J9LTvGQnmJJR!uCCQ==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader2, NULL, NULL, pro2.dat )
TestManagerSetHeader( NORMAL, pro2.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF1_2, LiveTVLicenses.xml, "LiveTV Leaf 1_2", NULL, "AESKey2" )
TestAddLicenseToPRO( 6Hnr4J9LTvGQnmJJR!uCCQ==, {AF43C8A3-1E7B-46C4-8269-3AE78BA4CC6D}, LEAF1_2 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_2.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_2.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_2.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor2, NULL, NULL, {AF43C8A3-1E7B-46C4-8269-3AE78BA4CC6D})

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey2" )
TestSetupDecryptor(Decryptor2)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader3, headerspool.xml, "Basic v4.1 AESCTR on demand", xmbG0Aj0SdirJ82uPKo5HA==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader3, NULL, NULL, pro3.dat )
TestManagerSetHeader( NORMAL, pro3.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF1_3, LiveTVLicenses.xml, "LiveTV Leaf 1_3", NULL, "AESKey3" )
TestAddLicenseToPRO( xmbG0Aj0SdirJ82uPKo5HA==, {E3510748-61E1-440D-99FD-FD24DB1D561A}, LEAF1_3 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_3.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_3.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_3.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor3, NULL, NULL, {E3510748-61E1-440D-99FD-FD24DB1D561A})

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey3" )
TestSetupDecryptor(Decryptor3)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor4, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey1" )
TestSetupDecryptor(Decryptor4)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

' =================================================================================================
8121:FUNC:Live TV Streaming with root license switching (5.1.4.1.9)
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)

TestManagerCreateXMRLicenseFromPool( ROOT1, LiveTVLicenses.xml, "LiveTV Root 1" )
TestManagerCreateXMRLicenseFromPool( ROOT2, LiveTVLicenses.xml, "LiveTV Root 2" )
TestManagerGenerateXMRResponse( ROOT1, ROOT2 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader1, headerspool.xml, "Basic v4.1 AESCTR on demand", !3x8NSroVg4eXCzWqPU!BA==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader1, NULL, NULL, pro1.dat )
TestManagerSetHeader( NORMAL, pro1.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF1_1, LiveTVLicenses.xml, "LiveTV Leaf 1_1", NULL, "AESKey1" )
TestAddLicenseToPRO( !3x8NSroVg4eXCzWqPU!BA==, {63BAD16B-CE80-433E-80F4-8E6951B7382C}, LEAF1_1 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader2, headerspool.xml, "Basic v4.1 AESCTR on demand", ewYVOLoESeOuY0cUFdAjBQ==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader2, NULL, NULL, pro2.dat )
TestManagerSetHeader( NORMAL, pro2.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF2_1, LiveTVLicenses.xml, "LiveTV Leaf 2_1", NULL, "AESKey2" )
TestAddLicenseToPRO( ewYVOLoESeOuY0cUFdAjBQ==, {B00054B1-3CC5-47A7-BFEE-167F1CD8F514}, LEAF2_1 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro2_1.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro2_1.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro2_1.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor2_1, NULL, NULL, {B00054B1-3CC5-47A7-BFEE-167F1CD8F514})

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader3, headerspool.xml, "Basic v4.1 AESCTR on demand", QckPgTI7Tfe32EMi3DFZOg==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader3, NULL, NULL, pro3.dat )
TestManagerSetHeader( NORMAL, pro3.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF2_2, LiveTVLicenses.xml, "LiveTV Leaf 2_2", NULL, "AESKey3" )
TestAddLicenseToPRO( QckPgTI7Tfe32EMi3DFZOg==, {425D754B-73EC-4464-8B5B-8D514B9BE6A5}, LEAF2_2 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro2_2.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro2_2.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro2_2.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor2_2, NULL, NULL, {425D754B-73EC-4464-8B5B-8D514B9BE6A5})

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader4, headerspool.xml, "Basic v4.1 AESCTR on demand", 6Hnr4J9LTvGQnmJJR!uCCQ==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader4, NULL, NULL, pro4.dat )
TestManagerSetHeader( NORMAL, pro4.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF1_2, LiveTVLicenses.xml, "LiveTV Leaf 1_2", NULL, "AESKey4" )
TestAddLicenseToPRO( 6Hnr4J9LTvGQnmJJR!uCCQ==, {AF43C8A3-1E7B-46C4-8269-3AE78BA4CC6D}, LEAF1_2 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_2.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_2.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_2.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_2, NULL, NULL, {AF43C8A3-1E7B-46C4-8269-3AE78BA4CC6D})

'verify with each decryptor
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey1" )
TestSetupDecryptor(Decryptor1_1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey2" )
TestSetupDecryptor(Decryptor2_1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey3" )
TestSetupDecryptor(Decryptor2_2)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey4" )
TestSetupDecryptor(Decryptor1_2)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

TestManagerCommit


' =================================================================================================
' Tests 8122-8126 are disabled until TFS#13655 is addressed. Otherwise binding fails with "invalid key" error, likely due to issue with license generation
'8122:FUNC:Live TV Streaming with buffered decryptors, same channel (5.1.4.1.1) non scalable licenses
'TestManagerSetRights(Play)

'TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "LiveTV Root 1 non scalable" )
'TestManagerGenerateXMRResponse( ROOT )
'TestManagerProcessResponse( Dump, Dump, 0, 0 )

'TestManagerReinitialize(Drm_Reinitialize)
'TestCreateWRMHeaderFromPool( WRMHeader1, headerspool.xml, "Basic v4.1 AESCTR on demand", !3x8NSroVg4eXCzWqPU!BA==, AAECAwQFBgcICQoLDA0ODw== )
'TestCreatePlayReadyDRMHeader( WRMHeader1, NULL, NULL, pro1.dat )
'TestManagerSetHeader( NORMAL, pro1.dat, BINARY )

'TestManagerCreateXMRLicenseFromPool( LEAF1_1, LiveTVLicenses.xml, "LiveTV Leaf 1_1 non scalable" )
'TestAddLicenseToPRO( !3x8NSroVg4eXCzWqPU!BA==, {63BAD16B-CE80-433E-80F4-8E6951B7382C}, LEAF1_1 )
'TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1.dat)
'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

'TestManagerReinitialize(Drm_Reinitialize)
'TestCreateWRMHeaderFromPool( WRMHeader2, headerspool.xml, "Basic v4.1 AESCTR on demand", 6Hnr4J9LTvGQnmJJR!uCCQ==, AAECAwQFBgcICQoLDA0ODw== )
'TestCreatePlayReadyDRMHeader( WRMHeader2, NULL, NULL, pro2.dat )
'TestManagerSetHeader( NORMAL, pro2.dat, BINARY )

'TestManagerCreateXMRLicenseFromPool( LEAF1_1_2, LiveTVLicenses.xml, "LiveTV Leaf 1_1 copy#2 non scalable" )
'TestAddLicenseToPRO( 6Hnr4J9LTvGQnmJJR!uCCQ==, {12863DC2-8610-4E07-A23A-19CDEC8C7BF3}, LEAF1_1_2 )
'TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1_2.dat)
'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro1_1_2.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro1_1_2.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1_2, NULL, NULL, {12863DC2-8610-4E07-A23A-19CDEC8C7BF3})

'TestManagerReinitialize(Drm_Reinitialize)
'TestCreateWRMHeaderFromPool( WRMHeader3, headerspool.xml, "Basic v4.1 AESCTR on demand", xmbG0Aj0SdirJ82uPKo5HA==, AAECAwQFBgcICQoLDA0ODw== )
'TestCreatePlayReadyDRMHeader( WRMHeader3, NULL, NULL, pro3.dat )
'TestManagerSetHeader( NORMAL, pro3.dat, BINARY )

'TestManagerCreateXMRLicenseFromPool( LEAF1_1_3, LiveTVLicenses.xml, "LiveTV Leaf 1_1 copy#3 non scalable" )
'TestAddLicenseToPRO( xmbG0Aj0SdirJ82uPKo5HA==, {70EE09A0-0324-412C-B8F6-6AC175068396}, LEAF1_1_3 )
'TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1_3.dat)
'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro1_1_3.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro1_1_3.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1_3, NULL, NULL, {70EE09A0-0324-412C-B8F6-6AC175068396})

'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_4, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

'TestSetupDecryptor(Decryptor1_1)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

'TestSetupDecryptor(Decryptor1_1_2)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

'TestSetupDecryptor(Decryptor1_1_3)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

'TestSetupDecryptor(Decryptor1_4)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

'TestManagerCommit
' =================================================================================================
'8123:FUNC:Channel change with buffered decryptors, without root license switching (5.1.4.1.3) non scalable licenses
'TestManagerSetRights(Play)

'TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "LiveTV Root 1 non scalable" )
'TestManagerGenerateXMRResponse( ROOT )
'TestManagerProcessResponse( Dump, Dump, 0, 0 )

'TestManagerReinitialize(Drm_Reinitialize)
'TestCreateWRMHeaderFromPool( WRMHeader1, headerspool.xml, "Basic v4.1 AESCTR on demand", !3x8NSroVg4eXCzWqPU!BA==, AAECAwQFBgcICQoLDA0ODw== )
'TestCreatePlayReadyDRMHeader( WRMHeader1, NULL, NULL, pro1.dat )
'TestManagerSetHeader( NORMAL, pro1.dat, BINARY )

'TestManagerCreateXMRLicenseFromPool( LEAF1_1, LiveTVLicenses.xml, "LiveTV Leaf 1_1 non scalable" )
'TestAddLicenseToPRO( !3x8NSroVg4eXCzWqPU!BA==, {63BAD16B-CE80-433E-80F4-8E6951B7382C}, LEAF1_1 )
'TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1.dat)
'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

'TestManagerReinitialize(Drm_Reinitialize)
'TestCreateWRMHeaderFromPool( WRMHeader2, headerspool.xml, "Basic v4.1 AESCTR on demand", 6Hnr4J9LTvGQnmJJR!uCCQ==, AAECAwQFBgcICQoLDA0ODw== )
'TestCreatePlayReadyDRMHeader( WRMHeader2, NULL, NULL, pro2.dat )
'TestManagerSetHeader( NORMAL, pro2.dat, BINARY )

'TestManagerCreateXMRLicenseFromPool( LEAF1_2, LiveTVLicenses.xml, "LiveTV Leaf 1_2 non scalable" )
'TestAddLicenseToPRO( 6Hnr4J9LTvGQnmJJR!uCCQ==, {AF43C8A3-1E7B-46C4-8269-3AE78BA4CC6D}, LEAF1_2 )
'TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_2.dat)
'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro1_2.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro1_2.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_2, NULL, NULL, {AF43C8A3-1E7B-46C4-8269-3AE78BA4CC6D})

'TestManagerReinitialize(Drm_Reinitialize)
'TestCreateWRMHeaderFromPool( WRMHeader3, headerspool.xml, "Basic v4.1 AESCTR on demand", xmbG0Aj0SdirJ82uPKo5HA==, AAECAwQFBgcICQoLDA0ODw== )
'TestCreatePlayReadyDRMHeader( WRMHeader3, NULL, NULL, pro3.dat )
'TestManagerSetHeader( NORMAL, pro3.dat, BINARY )

'TestManagerCreateXMRLicenseFromPool( LEAF1_3, LiveTVLicenses.xml, "LiveTV Leaf 1_3 non scalable" )
'TestAddLicenseToPRO( xmbG0Aj0SdirJ82uPKo5HA==, {E3510748-61E1-440D-99FD-FD24DB1D561A}, LEAF1_3 )
'TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_3.dat)
'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro1_3.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro1_3.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_3, NULL, NULL, {E3510748-61E1-440D-99FD-FD24DB1D561A})

'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_4, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

'TestSetupDecryptor(Decryptor1_1)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

'TestSetupDecryptor(Decryptor1_2)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

'TestSetupDecryptor(Decryptor1_3)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

'TestSetupDecryptor(Decryptor1_4)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

'TestManagerCommit

' =================================================================================================
'8124:FUNC:Live TV Streaming without buffering of decryptors (for STB) (5.1.4.1.5) non scalable licenses
'TestManagerSetRights(Play)

'TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "LiveTV Root 1 non scalable" )
'TestManagerGenerateXMRResponse( ROOT )
'TestManagerProcessResponse( Dump, Dump, 0, 0 )

'TestManagerReinitialize(Drm_Reinitialize)
'TestCreateWRMHeaderFromPool( WRMHeader1, headerspool.xml, "Basic v4.1 AESCTR on demand", !3x8NSroVg4eXCzWqPU!BA==, AAECAwQFBgcICQoLDA0ODw== )
'TestCreatePlayReadyDRMHeader( WRMHeader1, NULL, NULL, pro1.dat )
'TestManagerSetHeader( NORMAL, pro1.dat, BINARY )

'TestManagerCreateXMRLicenseFromPool( LEAF1, LiveTVLicenses.xml, "LiveTV Leaf 1_1 non scalable" )
'TestAddLicenseToPRO( !3x8NSroVg4eXCzWqPU!BA==, {63BAD16B-CE80-433E-80F4-8E6951B7382C}, LEAF1 )
'TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1.dat)
'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

'TestSetupDecryptor(Decryptor1_1)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
'TestManagerCommit

'TestManagerReinitialize(Drm_Reinitialize)
'TestCreateWRMHeaderFromPool( WRMHeader2, headerspool.xml, "Basic v4.1 AESCTR on demand", 6Hnr4J9LTvGQnmJJR!uCCQ==, AAECAwQFBgcICQoLDA0ODw== )
'TestCreatePlayReadyDRMHeader( WRMHeader2, NULL, NULL, pro2.dat )
'TestManagerSetHeader( NORMAL, pro2.dat, BINARY )

'TestManagerCreateXMRLicenseFromPool( LEAF2, LiveTVLicenses.xml, "LiveTV Leaf 1_1 copy#2 non scalable" )
'TestAddLicenseToPRO( 6Hnr4J9LTvGQnmJJR!uCCQ==, {12863DC2-8610-4E07-A23A-19CDEC8C7BF3}, LEAF2 )
'TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1_2.dat)
'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro1_1_2.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro1_1_2.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1_2, NULL, NULL, {12863DC2-8610-4E07-A23A-19CDEC8C7BF3})

'TestSetupDecryptor(Decryptor1_1_2)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
'TestManagerCommit

'TestManagerReinitialize(Drm_Reinitialize)
'TestCreateWRMHeaderFromPool( WRMHeader3, headerspool.xml, "Basic v4.1 AESCTR on demand", xmbG0Aj0SdirJ82uPKo5HA==, AAECAwQFBgcICQoLDA0ODw== )
'TestCreatePlayReadyDRMHeader( WRMHeader3, NULL, NULL, pro3.dat )
'TestManagerSetHeader( NORMAL, pro3.dat, BINARY )

'TestManagerCreateXMRLicenseFromPool( LEAF3, LiveTVLicenses.xml, "LiveTV Leaf 1_1 copy#3 non scalable" )
'TestAddLicenseToPRO( xmbG0Aj0SdirJ82uPKo5HA==, {70EE09A0-0324-412C-B8F6-6AC175068396}, LEAF3 )
'TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1_3.dat)
'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro1_1_3.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro1_1_3.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1_3, NULL, NULL, {70EE09A0-0324-412C-B8F6-6AC175068396})

'TestSetupDecryptor(Decryptor1_1_3)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
'TestManagerCommit

'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_4, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

'TestSetupDecryptor(Decryptor1_4)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
'TestManagerCommit

' =================================================================================================
'8125:FUNC: PK: Channel change without buffering of decryptors, without root license switching (for STB)(5.1.4.1.7) non scalable licenses
'TestManagerSetRights(Play)

'TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "LiveTV Root 1 non scalable" )
'TestManagerGenerateXMRResponse( ROOT )
'TestManagerProcessResponse( Dump, Dump, 0, 0 )

'TestManagerReinitialize(Drm_Reinitialize)
'TestCreateWRMHeaderFromPool( WRMHeader1, headerspool.xml, "Basic v4.1 AESCTR on demand", !3x8NSroVg4eXCzWqPU!BA==, AAECAwQFBgcICQoLDA0ODw== )
'TestCreatePlayReadyDRMHeader( WRMHeader1, NULL, NULL, pro1.dat )
'TestManagerSetHeader( NORMAL, pro1.dat, BINARY )

'TestManagerCreateXMRLicenseFromPool( LEAF1_1, LiveTVLicenses.xml, "LiveTV Leaf 1_1 non scalable" )
'TestAddLicenseToPRO( !3x8NSroVg4eXCzWqPU!BA==, {63BAD16B-CE80-433E-80F4-8E6951B7382C}, LEAF1_1 )
'TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1.dat)
'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

'TestSetupDecryptor(Decryptor1)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
'TestManagerCommit

'TestManagerReinitialize(Drm_Reinitialize)
'TestCreateWRMHeaderFromPool( WRMHeader2, headerspool.xml, "Basic v4.1 AESCTR on demand", 6Hnr4J9LTvGQnmJJR!uCCQ==, AAECAwQFBgcICQoLDA0ODw== )
'TestCreatePlayReadyDRMHeader( WRMHeader2, NULL, NULL, pro2.dat )
'TestManagerSetHeader( NORMAL, pro2.dat, BINARY )

'TestManagerCreateXMRLicenseFromPool( LEAF1_2, LiveTVLicenses.xml, "LiveTV Leaf 1_2 non scalable" )
'TestAddLicenseToPRO( 6Hnr4J9LTvGQnmJJR!uCCQ==, {AF43C8A3-1E7B-46C4-8269-3AE78BA4CC6D}, LEAF1_2 )
'TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_2.dat)
'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro1_2.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro1_2.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor2, NULL, NULL, {AF43C8A3-1E7B-46C4-8269-3AE78BA4CC6D})

'TestSetupDecryptor(Decryptor2)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
'TestManagerCommit

'TestManagerReinitialize(Drm_Reinitialize)
'TestCreateWRMHeaderFromPool( WRMHeader3, headerspool.xml, "Basic v4.1 AESCTR on demand", xmbG0Aj0SdirJ82uPKo5HA==, AAECAwQFBgcICQoLDA0ODw== )
'TestCreatePlayReadyDRMHeader( WRMHeader3, NULL, NULL, pro3.dat )
'TestManagerSetHeader( NORMAL, pro3.dat, BINARY )

'TestManagerCreateXMRLicenseFromPool( LEAF1_3, LiveTVLicenses.xml, "LiveTV Leaf 1_3 non scalable" )
'TestAddLicenseToPRO( xmbG0Aj0SdirJ82uPKo5HA==, {E3510748-61E1-440D-99FD-FD24DB1D561A}, LEAF1_3 )
'TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_3.dat)
'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro1_3.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro1_3.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor3, NULL, NULL, {E3510748-61E1-440D-99FD-FD24DB1D561A})

'TestSetupDecryptor(Decryptor3)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
'TestManagerCommit

'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor4, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

'TestSetupDecryptor(Decryptor4)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
'TestManagerCommit

' =================================================================================================
'8126:FUNC:Live TV Streaming with root license switching (5.1.4.1.9) non scalable licenses
'TestManagerSetRights(Play)
'TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)

'TestManagerCreateXMRLicenseFromPool( ROOT1, LiveTVLicenses.xml, "LiveTV Root 1 non scalable" )
'TestManagerCreateXMRLicenseFromPool( ROOT2, LiveTVLicenses.xml, "LiveTV Root 2 non scalable" )
'TestManagerGenerateXMRResponse( ROOT1, ROOT2 )
'TestManagerProcessResponse( Dump, Dump, 0, 0 )

'TestManagerReinitialize(Drm_Reinitialize)
'TestCreateWRMHeaderFromPool( WRMHeader1, headerspool.xml, "Basic v4.1 AESCTR on demand", !3x8NSroVg4eXCzWqPU!BA==, AAECAwQFBgcICQoLDA0ODw== )
'TestCreatePlayReadyDRMHeader( WRMHeader1, NULL, NULL, pro1.dat )
'TestManagerSetHeader( NORMAL, pro1.dat, BINARY )

'TestManagerCreateXMRLicenseFromPool( LEAF1_1, LiveTVLicenses.xml, "LiveTV Leaf 1_1 non scalable" )
'TestAddLicenseToPRO( !3x8NSroVg4eXCzWqPU!BA==, {63BAD16B-CE80-433E-80F4-8E6951B7382C}, LEAF1_1 )
'TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1.dat)
'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

'TestManagerReinitialize(Drm_Reinitialize)
'TestCreateWRMHeaderFromPool( WRMHeader2, headerspool.xml, "Basic v4.1 AESCTR on demand", ewYVOLoESeOuY0cUFdAjBQ==, AAECAwQFBgcICQoLDA0ODw== )
'TestCreatePlayReadyDRMHeader( WRMHeader2, NULL, NULL, pro2.dat )
'TestManagerSetHeader( NORMAL, pro2.dat, BINARY )

'TestManagerCreateXMRLicenseFromPool( LEAF2_1, LiveTVLicenses.xml, "LiveTV Leaf 2_1 non scalable" )
'TestAddLicenseToPRO( ewYVOLoESeOuY0cUFdAjBQ==, {B00054B1-3CC5-47A7-BFEE-167F1CD8F514}, LEAF2_1 )
'TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro2_1.dat)
'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro2_1.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro2_1.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor2_1, NULL, NULL, {B00054B1-3CC5-47A7-BFEE-167F1CD8F514})

'TestManagerReinitialize(Drm_Reinitialize)
'TestCreateWRMHeaderFromPool( WRMHeader3, headerspool.xml, "Basic v4.1 AESCTR on demand", QckPgTI7Tfe32EMi3DFZOg==, AAECAwQFBgcICQoLDA0ODw== )
'TestCreatePlayReadyDRMHeader( WRMHeader3, NULL, NULL, pro3.dat )
'TestManagerSetHeader( NORMAL, pro3.dat, BINARY )

'TestManagerCreateXMRLicenseFromPool( LEAF2_2, LiveTVLicenses.xml, "LiveTV Leaf 2_2 non scalable" )
'TestAddLicenseToPRO( QckPgTI7Tfe32EMi3DFZOg==, {425D754B-73EC-4464-8B5B-8D514B9BE6A5}, LEAF2_2 )
'TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro2_2.dat)
'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro2_2.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro2_2.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor2_2, NULL, NULL, {425D754B-73EC-4464-8B5B-8D514B9BE6A5})

'TestManagerReinitialize(Drm_Reinitialize)
'TestCreateWRMHeaderFromPool( WRMHeader4, headerspool.xml, "Basic v4.1 AESCTR on demand", 6Hnr4J9LTvGQnmJJR!uCCQ==, AAECAwQFBgcICQoLDA0ODw== )
'TestCreatePlayReadyDRMHeader( WRMHeader4, NULL, NULL, pro4.dat )
'TestManagerSetHeader( NORMAL, pro4.dat, BINARY )

'TestManagerCreateXMRLicenseFromPool( LEAF1_2, LiveTVLicenses.xml, "LiveTV Leaf 1_2 non scalable" )
'TestAddLicenseToPRO( 6Hnr4J9LTvGQnmJJR!uCCQ==, {AF43C8A3-1E7B-46C4-8269-3AE78BA4CC6D}, LEAF1_2 )
'TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_2.dat)
'TestManagerReinitialize(Drm_Reinitialize)
'TestManagerSetHeader( NORMAL, pro1_2.dat, BINARY )
'TestVerifyDecryptorSetupFlag( pro1_2.dat, 1 ONDEMAND )
'TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_2, NULL, NULL, {AF43C8A3-1E7B-46C4-8269-3AE78BA4CC6D})

'verify with each decryptor
'TestSetupDecryptor(Decryptor1_1)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

'TestSetupDecryptor(Decryptor2_1)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

'TestSetupDecryptor(Decryptor2_2)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

'TestSetupDecryptor(Decryptor1_2)
'TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
'TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
'TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

'TestManagerCommit

' =================================================================================================
8127:FUNC: A copy of key rotation test 8118 but with domain-bound licenses
If(DomainSupported)
' Reset the context back to default and join a domain
TestManagerReinitialize(Reset)
TestManagerSetRights(Play)
TestManagerCleanLicenseStore(1)
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "LiveTV Root 1", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerGenerateXMRResponse( ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader1, headerspool.xml, "Basic v4.1 AESCTR on demand", !3x8NSroVg4eXCzWqPU!BA==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader1, NULL, NULL, pro1.dat )
TestManagerSetHeader( NORMAL, pro1.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF1_1, LiveTVLicenses.xml, "LiveTV Leaf 1_1", NULL, "AESKey1" )
TestAddLicenseToPRO( !3x8NSroVg4eXCzWqPU!BA==, {63BAD16B-CE80-433E-80F4-8E6951B7382C}, LEAF1_1 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_1.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader2, headerspool.xml, "Basic v4.1 AESCTR on demand", 6Hnr4J9LTvGQnmJJR!uCCQ==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader2, NULL, NULL, pro2.dat )
TestManagerSetHeader( NORMAL, pro2.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF1_2, LiveTVLicenses.xml, "LiveTV Leaf 1_2", NULL, "AESKey2" )
TestAddLicenseToPRO( 6Hnr4J9LTvGQnmJJR!uCCQ==, {AF43C8A3-1E7B-46C4-8269-3AE78BA4CC6D}, LEAF1_2 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_2.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_2.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_2.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_2, NULL, NULL, {AF43C8A3-1E7B-46C4-8269-3AE78BA4CC6D})

TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader3, headerspool.xml, "Basic v4.1 AESCTR on demand", xmbG0Aj0SdirJ82uPKo5HA==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader3, NULL, NULL, pro3.dat )
TestManagerSetHeader( NORMAL, pro3.dat, BINARY )

TestManagerCreateXMRLicenseFromPool( LEAF1_3, LiveTVLicenses.xml, "LiveTV Leaf 1_3", NULL, "AESKey3" )
TestAddLicenseToPRO( xmbG0Aj0SdirJ82uPKo5HA==, {E3510748-61E1-440D-99FD-FD24DB1D561A}, LEAF1_3 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pro1_3.dat)
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_3.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_3.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_3, NULL, NULL, {E3510748-61E1-440D-99FD-FD24DB1D561A})

TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetHeader( NORMAL, pro1_1.dat, BINARY )
TestVerifyDecryptorSetupFlag( pro1_1.dat, 1 ONDEMAND )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_4, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey1" )
TestSetupDecryptor(Decryptor1_1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey2" )
TestSetupDecryptor(Decryptor1_2)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey3" )
TestSetupDecryptor(Decryptor1_3)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey1" )
TestSetupDecryptor(Decryptor1_4)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

TestManagerCommit

EndIf

' =================================================================================================
21454: SLS - Validate root licenses with the following number of keys - 1, 2, 1000, 2500, 3000, and 9000
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

' Device Bound - 1 Key
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 1 location" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' Device Bound - 2 Keys
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 2 locations" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' Device Bound - 1000 Keys
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 1000 locations" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' Device Bound - 2500 Keys
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 2500 locations" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' Device Bound - 3000 Keys
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 3000 locations" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' The next test needs a bigger buffer
TestManagerReinitialize(Reset)
TestManagerResizeOpaqueBuffer(208768)
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

' Device Bound - 9000 Keys
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 9000 locations" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

If(DomainSupported)
' Reset the context back to default and join a domain
TestManagerReinitialize(Reset)
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - 1 Key
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 1 location", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' Domain Bound - 2 Keys
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 2 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' Domain Bound - 1000 Keys
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 1000 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' Domain Bound - 2500 Keys
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 2500 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' Domain Bound - 3000 Keys
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 3000 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' The next test needs a bigger buffer
TestManagerReinitialize(Reset)
TestManagerResizeOpaqueBuffer(208768)
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

' Domain Bound - 9000 Keys
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 9000 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)
EndIf

' =================================================================================================
21463:FUNC: SLS - Validate root licenses with removaldate objects of - 30s, 1m, 30m, 1h, 2h, 8h, 1d, 3d, 30d
TestManagerSetRights(Play)
TestManagerCleanLicenseStore(1)

If(DomainSupported)
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )
EndIf

' Device Bound - PAIR A - 30s 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "PAIR A - Root with 1 location and 30s RemovalDate" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "PAIR A - Permanent Leaf 0", NULL, "AESKey1" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerSetKID(FHQrIOypwWBEvDjSOmWcTQ==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey1" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)

' Domain Bound - PAIR B - 1m 

If(DomainSupported)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "PAIR B - Root with 1 location and 60s RemovalDate", NjU0MzIxMDk4NzY1NDMyMQ== )
Else
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "PAIR B - Root with 1 location and 60s RemovalDate" )
EndIf

TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "PAIR B - Permanent Leaf 0", NULL, "AESKey2" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerSetKID(7nf21xWa9A/Q6hI/tIzD4g==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey2" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)


' Device Bound - PAIR C - 30m 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "PAIR C - Root with 1 location and 30m RemovalDate" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "PAIR C - Permanent Leaf 0", NULL, "AESKey3" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerSetKID(6AJ3hPjZwIqdNMzYAtua1A==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey3" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)

' Domain Bound - PAIR D - 1h 
If(DomainSupported)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "PAIR D - Root with 1 location and 1h RemovalDate", NjU0MzIxMDk4NzY1NDMyMQ== )
Else
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "PAIR D - Root with 1 location and 1h RemovalDate" )
EndIf

TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "PAIR D - Permanent Leaf 0", NULL, "AESKey4" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerSetKID(4DQyHSSNtXL6YHR/aEoI7w==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey4" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)

' Device Bound - PAIR E - 2h 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "PAIR E - Root with 1 location and 2h RemovalDate" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "PAIR E - Permanent Leaf 0", NULL, "AESKey5" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerSetKID(pKX0LBFu6KtLIHrzandW5w==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey5" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)

' Domain Bound - PAIR F - 8h 
If(DomainSupported)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "PAIR F - Root with 1 location and 8h RemovalDate", NjU0MzIxMDk4NzY1NDMyMQ== )
Else
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "PAIR F - Root with 1 location and 8h RemovalDate" )
EndIf

TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "PAIR F - Permanent Leaf 0", NULL, "AESKey6" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerSetKID(rmWHSfzKNP1mG0Pyx7ruAQ==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey6" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)

' Device Bound - PAIR G - 1d 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "PAIR G - Root with 1 location and 1d RemovalDate" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "PAIR G - Permanent Leaf 0", NULL, "AESKey7" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerSetKID(7YKqxog2Zy4hCWheJtUz8w==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey7" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)

' Domain Bound - PAIR H - 3d 
If(DomainSupported)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "PAIR H - Root with 1 location and 3d RemovalDate", NjU0MzIxMDk4NzY1NDMyMQ== )
Else
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "PAIR H - Root with 1 location and 3d RemovalDate" )
EndIf

TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "PAIR H - Permanent Leaf 0", NULL, "AESKey8" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerSetKID(MXb1z4TXYtu+ChD1gD1eUw==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey8" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)

' Device Bound - PAIR I - 30d 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "PAIR I - Root with 1 location and 30d RemovalDate" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "PAIR I - Permanent Leaf 0", NULL, "AESKey9" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerSetKID(w/4RzCz8htAXeG5eREGzVw==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey9" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

' Expire PAIR A - Verify Remaining 
TestManagerCleanLicenseStore( 1, 30, DELETE_REMOVAL_DATE_LICENSES )
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(FHQrIOypwWBEvDjSOmWcTQ==)

If(LicenseSyncSupported)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)= DRM_E_UPLINKLICENSENOTFOUND
Else
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)= DRM_E_UPLINKLICENSENOTFOUND
EndIf

TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(7nf21xWa9A/Q6hI/tIzD4g==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey2" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(6AJ3hPjZwIqdNMzYAtua1A==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey3" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(4DQyHSSNtXL6YHR/aEoI7w==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey4" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(pKX0LBFu6KtLIHrzandW5w==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey5" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(rmWHSfzKNP1mG0Pyx7ruAQ==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey6" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(7YKqxog2Zy4hCWheJtUz8w==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey7" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(MXb1z4TXYtu+ChD1gD1eUw==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey8" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(w/4RzCz8htAXeG5eREGzVw==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey9" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

' Expire PAIR B - Verify Remaining 
TestManagerCleanLicenseStore( 1, 60, DELETE_REMOVAL_DATE_LICENSES )
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(7nf21xWa9A/Q6hI/tIzD4g==)
If(LicenseSyncSupported)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)= DRM_E_UPLINKLICENSENOTFOUND
Else
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)= DRM_E_UPLINKLICENSENOTFOUND
EndIf

TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(6AJ3hPjZwIqdNMzYAtua1A==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey3" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(4DQyHSSNtXL6YHR/aEoI7w==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey4" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(pKX0LBFu6KtLIHrzandW5w==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey5" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(rmWHSfzKNP1mG0Pyx7ruAQ==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey6" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(7YKqxog2Zy4hCWheJtUz8w==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey7" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(MXb1z4TXYtu+ChD1gD1eUw==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey8" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(w/4RzCz8htAXeG5eREGzVw==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey9" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

' Expire PAIR C - Verify Remaining 
TestManagerCleanLicenseStore( 1, 1800, DELETE_REMOVAL_DATE_LICENSES )
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(6AJ3hPjZwIqdNMzYAtua1A==)

If(LicenseSyncSupported)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)= DRM_E_UPLINKLICENSENOTFOUND
Else
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)= DRM_E_UPLINKLICENSENOTFOUND
EndIf

TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(4DQyHSSNtXL6YHR/aEoI7w==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey4" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(pKX0LBFu6KtLIHrzandW5w==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey5" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(rmWHSfzKNP1mG0Pyx7ruAQ==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey6" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(7YKqxog2Zy4hCWheJtUz8w==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey7" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(MXb1z4TXYtu+ChD1gD1eUw==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey8" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(w/4RzCz8htAXeG5eREGzVw==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey9" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

' Expire PAIR D - Verify Remaining 
TestManagerCleanLicenseStore( 1, 3600, DELETE_REMOVAL_DATE_LICENSES )
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(4DQyHSSNtXL6YHR/aEoI7w==)

If(LicenseSyncSupported)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)= DRM_E_UPLINKLICENSENOTFOUND
Else
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)= DRM_E_UPLINKLICENSENOTFOUND
EndIf

TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(pKX0LBFu6KtLIHrzandW5w==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey5" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(rmWHSfzKNP1mG0Pyx7ruAQ==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey6" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(7YKqxog2Zy4hCWheJtUz8w==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey7" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(MXb1z4TXYtu+ChD1gD1eUw==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey8" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(w/4RzCz8htAXeG5eREGzVw==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey9" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

' Expire PAIR E - Verify Remaining 
TestManagerCleanLicenseStore( 1, 7200, DELETE_REMOVAL_DATE_LICENSES )
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(pKX0LBFu6KtLIHrzandW5w==)

If(LicenseSyncSupported)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)= DRM_E_UPLINKLICENSENOTFOUND
Else
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)= DRM_E_UPLINKLICENSENOTFOUND
EndIf

TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(rmWHSfzKNP1mG0Pyx7ruAQ==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey6" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(7YKqxog2Zy4hCWheJtUz8w==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey7" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(MXb1z4TXYtu+ChD1gD1eUw==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey8" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(w/4RzCz8htAXeG5eREGzVw==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey9" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

' Expire PAIR F - Verify Remaining 8x60*60=28800
TestManagerCleanLicenseStore( 1, 28800, DELETE_REMOVAL_DATE_LICENSES )
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(rmWHSfzKNP1mG0Pyx7ruAQ==)

If(LicenseSyncSupported)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)= DRM_E_UPLINKLICENSENOTFOUND
Else
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)= DRM_E_UPLINKLICENSENOTFOUND
EndIf

TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(7YKqxog2Zy4hCWheJtUz8w==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey7" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(MXb1z4TXYtu+ChD1gD1eUw==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey8" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(w/4RzCz8htAXeG5eREGzVw==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey9" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

' Expire PAIR G - Verify Remaining 24x60*60=86400
TestManagerCleanLicenseStore( 1, 86400, DELETE_REMOVAL_DATE_LICENSES )
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(7YKqxog2Zy4hCWheJtUz8w==)

If(LicenseSyncSupported)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)= DRM_E_UPLINKLICENSENOTFOUND
Else
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)= DRM_E_UPLINKLICENSENOTFOUND
EndIf

TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(MXb1z4TXYtu+ChD1gD1eUw==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey8" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(w/4RzCz8htAXeG5eREGzVw==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey9" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

' Expire PAIR H - Verify Remaining 3x24x60*60=259200
TestManagerCleanLicenseStore( 1, 259200, DELETE_REMOVAL_DATE_LICENSES )
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(MXb1z4TXYtu+ChD1gD1eUw==)

If(LicenseSyncSupported)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)= DRM_E_UPLINKLICENSENOTFOUND
Else
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)= DRM_E_UPLINKLICENSENOTFOUND
EndIf

TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(w/4RzCz8htAXeG5eREGzVw==)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt, NULL, NULL, NULL, "AESKey9" )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

' Expire PAIR I - 30x24x60*60=2592000
TestManagerCleanLicenseStore( 1, 2592000, DELETE_REMOVAL_DATE_LICENSES )
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetKID(w/4RzCz8htAXeG5eREGzVw==)

If(LicenseSyncSupported)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)= DRM_E_UPLINKLICENSENOTFOUND
Else
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)= DRM_E_UPLINKLICENSENOTFOUND
EndIf

TestManagerCleanLicenseStore(1)



' =================================================================================================
214910:BVT: SLS - Verify Drm_StoreMgmt_CleanupStore will clean up 2 and 4 root licenses with expired RemovalDate objects

TestManagerSetRights( Play )
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Verify 2 licenses with expired RemovalDate

TestManagerAddManyXMRLicensesFromPool( 2, LiveTVLicenses.xml, "Root with 30 second RemovalDate and random KID" )
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 72h RemovalDate" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Permanent Leaf" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestVerifyStoreSlotCount( "LicStorexmr", 4 )
TestManagerCleanLicenseStore( 1, 30, ALL )
TestVerifyStoreSlotCount( "LicStorexmr", 2 )
TestManagerBind( 0 don't overwrite drmmanager context, Dump, Dump, NULL )
TestManagerCommit
TestManagerDeleteLicensesByKID( KQNXs2nvVdiUypvlgcROrA==, 1 )
TestManagerDeleteLicensesByKID( !3x8NSroVg4eXCzWqPU!BA==, 1 )

' Verify 4 licenses with expired RemovalDate

TestManagerAddManyXMRLicensesFromPool( 4, LiveTVLicenses.xml, "Root with 30 second RemovalDate and random KID" )
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 72h RemovalDate" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Permanent Leaf" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestVerifyStoreSlotCount( "LicStorexmr", 6 )
TestManagerCleanLicenseStore( 1, 30, ALL )
TestVerifyStoreSlotCount( "LicStorexmr", 2 )
TestManagerBind( 0 don't overwrite drmmanager context, Dump, Dump, NULL )
TestManagerCommit
TestManagerDeleteLicensesByKID( KQNXs2nvVdiUypvlgcROrA==, 1 )
TestManagerDeleteLicensesByKID( !3x8NSroVg4eXCzWqPU!BA==, 1 )

' =================================================================================================
214911:FUNC: SLS - Verify Drm_StoreMgmt_CleanupStore will clean up 360 and 1000 root licenses with expired RemovalDate objects

TestManagerSetRights( Play )
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Verify 360 licenses with expired RemovalDate

TestManagerAddManyXMRLicensesFromPool( 360, LiveTVLicenses.xml, "Root with 30 second RemovalDate and random KID" )
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 72h RemovalDate" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Permanent Leaf" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestVerifyStoreSlotCount( "LicStorexmr", 362 )
TestManagerCleanLicenseStore( 1, 30, ALL )
TestVerifyStoreSlotCount( "LicStorexmr", 2 )
TestManagerBind( 0 don't overwrite drmmanager context, Dump, Dump, NULL )
TestManagerCommit
TestManagerDeleteLicensesByKID( KQNXs2nvVdiUypvlgcROrA==, 1 )
TestManagerDeleteLicensesByKID( !3x8NSroVg4eXCzWqPU!BA==, 1 )

' Verify 1000 licenses with expired RemovalDate

TestManagerAddManyXMRLicensesFromPool( 1000, LiveTVLicenses.xml, "Root with 30 second RemovalDate and random KID" )
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 72h RemovalDate" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Permanent Leaf" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestVerifyStoreSlotCount( "LicStorexmr", 1002 )
TestManagerCleanLicenseStore( 1, 30, ALL )
TestVerifyStoreSlotCount( "LicStorexmr", 2 )
TestManagerBind( 0 don't overwrite drmmanager context, Dump, Dump, NULL )
TestManagerCommit
TestManagerDeleteLicensesByKID( KQNXs2nvVdiUypvlgcROrA==, 1 )
TestManagerDeleteLicensesByKID( !3x8NSroVg4eXCzWqPU!BA==, 1 )

' =================================================================================================
21495: SLS - Verify license store cleanup will not remove a root license with an expired RemovalDate object that is in use in the same thread

TestManagerSetRights( Play )
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 30s RemovalDate" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Permanent Leaf" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestVerifyStoreSlotCount( "LicStorexmr", 2 )
TestManagerBind( 8 save decryptor into test variable, Dump, SLS21495Decryptor, NULL )
TestManagerCommit
TestManagerCleanLicenseStore( 1, 30, ALL )
TestVerifyStoreSlotCount( "LicStorexmr", 1 )
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor( SLS21495Decryptor )
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )

' =================================================================================================
21499: SLS - Verify license store cleanup will cleanly exit if a scalable root license with a non-expired RemovalDate object is in use in the same thread

TestManagerSetRights( Play )
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

TestManagerAddManyXMRLicensesFromPool( 1, LiveTVLicenses.xml, "Root with 30 second RemovalDate and random KID" )
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 1h RemovalDate" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Permanent Leaf" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestVerifyStoreSlotCount( "LicStorexmr", 3 )
TestManagerBind( 8 save decryptor into test variable, Dump, SLS21499Decryptor, NULL )
TestManagerCommit
TestManagerCleanLicenseStore( 1, 30, ALL )
TestVerifyStoreSlotCount( "LicStorexmr", 2 )
TestManagerBind( 4 load decrypt context from a test variable, Dump, SLS21499Decryptor, NULL )
TestManagerCommit
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor( SLS21499Decryptor )
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerDeleteLicensesByKID( KQNXs2nvVdiUypvlgcROrA==, 1 )
TestManagerDeleteLicensesByKID( !3x8NSroVg4eXCzWqPU!BA==, 1 )


' =================================================================================================
20000:DRT:P0:Process license responses with removal date
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE1, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInFuture" )
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE2, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInFuture" )
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE3, LiveTVLicenses.xml, "LicenseWithRemovalDate1000SecsInFuture" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE1, SIMPLE_LICENSE2, SIMPLE_LICENSE3 )
TestManagerProcessResponse( Dump, Dump, 0, 0, NULL, NULL, 3 )

' =================================================================================================
100008:BVT: Check that the removal date operates properly (XMR)
TestManagerSetRights(Play)
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE1, LiveTVLicenses.xml, "LicenseWithRemovalDate10SecsInFuture" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE1 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerSetKID(lFmb2gxg0Cr5bfEnJXgJeA==)
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)
If(VIEWRIGHTSSupported)
TestManagerGetLicenseData(Dump,3,Dump,1,0)
EndIf
Test_ChangeTimeSeconds(100)
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)
TestManagerCommit
If(VIEWRIGHTSSupported)
TestManagerGetLicenseData(Dump,3,Dump,1,0)
EndIf

' =================================================================================================
' Disabled for bug 14758
'100009:BVT: test of DRM_Reader_Bind capability with leaf and root embedded in PRO's embedded datastore
'TestManagerSetPROHeaderWithKID(NORMAL, DrmMgrPRONoHeaderLeafAndRootLicense.dat, "AVhTknNlJOjo7F6b7HeNxg==")
'TestManagerGetContentProperty(3,DrmMgrPRONoHeaderLeafAndRootLicense.dat, FILE)
'TestManagerSetRights(Play)
'TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)
'TestManagerCommit(0 don't overwrite decrypt context, Dump)

' =================================================================================================
100010:BVT: test of DRM_Reader_Bind capability with leaf but not root embedded in PRO's embedded datastore
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetPROHeaderWithKID(NORMAL, DrmMgrPRONoHeaderLeafNoRootLicense.dat, "AVhTknNlJOjo7F6b7HeNxg==")
TestManagerGetContentProperty(3,DrmMgrPRONoHeaderLeafNoRootLicense.dat, FILE)
TestManagerSetRights(Play)
' Bind should fail with DRM_E_LICENSENOTFOUND because the root license is not in the embedded store
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)=DRM_E_UPLINKLICENSENOTFOUND
' Add the root license to the permanent store.  
TestManagerAddXMRLicense( lFmb2gxg0Cr5bfEnJXgJeA==, RANDOM, XVBovsmzhP9gRIZxWfFta3VVRPzVEWmJsazEJ46I, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, AES_128_ECB ) 
TestManagerProcessResponse( Dump, Dump, 0, 0 ) 
' This time, bind should succeed since the root license has been added
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)
TestManagerCommit(0 don't overwrite decrypt context, Dump)

' =================================================================================================
' Disabled for bug 14758
'100011:BVT: test of DRM_Reader_Bind capability with simple license embedded in PRO's embedded data store
'TestManagerSetPROHeaderWithKID(NORMAL, DrmMgrPRONoHeaderSimpleLicense.dat, "MKQu3mhKRcy10AHia/h7/A==") 
'TestManagerGetContentProperty(3,DrmMgrPRONoHeaderSimpleLicense.dat, FILE)
'TestManagerSetRights(Play)
'TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)
'TestManagerCommit(0 don't overwrite decrypt context, Dump)

' =================================================================================================
100012:BVT:Set a Header with a PRO with no WRMHeader and a separately specified KID and attempt to generate a license challenge
TestManagerSetRights(Play)
TestCreatePlayReadyDRMHeader( NULL, NULL, NULL, pronoheader1.dat )
TestManagerSetPROHeaderWithKID(NORMAL, pronoheader1.dat, "!3x8NSroVg4eXCzWqPU!BA==")
' Expect failure because the KID is used as the header information instead of the WRMHeader in the PRO (if it exists)
TestManagerGenerateChallenge(Dump,NULL,0,NULL,0,NULL,0,http://www.contoso.com/licenseacq.asp,37,NULL,NULL,NULL,0,0)=0x8004C03C (DRM_E_HEADER_NOT_SET)

' =================================================================================================
100013:BVT:Set a Header with a PRO with an embedded license store and attempt to delete licenses
TestManagerSetPROHeaderWithKID(NORMAL, DrmMgrPRONoHeaderSimpleLicense.dat, "MKQu3mhKRcy10AHia/h7/A==") 
' TestManagerDeleteLicensesByKID does not currently delete licenses from an embedded store.
' So even though there is a license with the specified KID in the embedded store, no licenses will be deleted.
TestManagerDeleteLicensesByKID(MKQu3mhKRcy10AHia/h7/A==,0)
' Now try to delete licenses based on KID when there are licenses in both the embedded and permanent stores
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetPROHeaderWithKID(NORMAL, DrmMgrPRONoHeaderLeafAndRootLicense.dat, "AVhTknNlJOjo7F6b7HeNxg==")
TestManagerAddXMRLicense( lFmb2gxg0Cr5bfEnJXgJeA==, RANDOM, XVBovsmzhP9gRIZxWfFta3VVRPzVEWmJsazEJ46I, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, AES_128_ECB ) 
TestManagerProcessResponse( Dump, Dump, 0, 0 ) 
' TestManagerDeleteLicensesByKID does not currently delete licenses from an embedded store.
' So even though there is a license with the specified KID in the embedded store, 
' only the one license that was just added to the permanent store will be deleted.
TestManagerDeleteLicensesByKID(lFmb2gxg0Cr5bfEnJXgJeA==,1)

' =================================================================================================
30620:DRT:Test that the cleanup license store doesn't delete expired licenses when using removal date only
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(Acl2BY3ITE0qe11DalmK0D==,RANDOM,2112 OP_LICGEN_NO_LICENSE_PRIORITY|OP_LICGEN_NO_DEFAULT_RIGHTS,"<PRIORITY>15</PRIORITY><ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[(machine.datetime < secstate.ExpirationDate)?1:(secstate.drmreason=1;0)]]></CONDITION></ONSELECT><ONSTORE><ACTION><![CDATA[secstate.ExpirationDate=#",ERdtAxucAFKJnAWxuFQYuyVd3BAFR7N!PO8vPJWRPzxV0MaUNCXrSQ==,300RGKoeuuIsIX04ZRKnNVZVP3fFXjykdp0o2hRG,2,NULL,17520)
TestManagerAddLicenseToResponse(Acl2BY3ITE0qe11DalmK0D==,RANDOM,2112 OP_LICGEN_NO_LICENSE_PRIORITY|OP_LICGEN_NO_DEFAULT_RIGHTS,"<PRIORITY>10</PRIORITY><ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION><ACTION><![CDATA[secstate.PlayCount--]]></ACTION></ONACTION><ONSELECT><CONDITION><![CDATA[(secstate.PlayCount > 0)?1:(secstate.drmreason=1;0)]]></CONDITION></ONSELECT><ONSTORE><ACTION><![CDATA[secstate.PlayCount=2]]></ACTION></ONSTORE>",ERdtAxucAFKJnAWxuFQYuyVd3BAFR7N!PO8vPJWRPzxV0MaUNCXrSQ==,300RGKoeuuIsIX04ZRKnNVZVP3fFXjykdp0o2hRG,2)
TestManagerAddLicenseToResponse(!3x8NSroVg4eXCzWqPU!BA==,RANDOM,0,NULL,ERdtAxucAFKJnAWxuFQYuyVd3BAFR7N!PO8vPJWRPzxV0MaUNCXrSQ==,300RGKoeuuIsIX04ZRKnNVZVP3fFXjykdp0o2hRG,1,Acl2BY3ITE0qe11DalmK0D==)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
TestEnumLicense(Acl2BY3ITE0qe11DalmK0D==,XML,2)
TestManagerCleanLicenseStore(1)
TestEnumLicense(Acl2BY3ITE0qe11DalmK0D==,XML,2)
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)
TestManagerCommit
TestEnumLicense(Acl2BY3ITE0qe11DalmK0D==,XML,2)
'Change Time by two years + 2 days
Test_ChangeTimeSeconds(63244800)
'Verify that expired licenses are not deleted if only licenses with expired removal dates are supposed to be deleted 
TestManagerCleanLicenseStore( FALSE, 0, DELETE_REMOVAL_DATE_LICENSES)
TestEnumLicense(Acl2BY3ITE0qe11DalmK0D==,XML,2)
'Now verify the expired license is successfully deleted
TestManagerCleanLicenseStore( FALSE, 0, DELETE_EXPIRED_LICENSES)
TestEnumLicense(Acl2BY3ITE0qe11DalmK0D==,XML,1)
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)
TestManagerCommit
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)
TestManagerCommit
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)=DRM_E_UPLINKLICENSENOTFOUND
TestEnumLicense(Acl2BY3ITE0qe11DalmK0D==,XML,0)
EndIf

' =================================================================================================
12492:BVT: test of DRMManager Drm_Content_SetProperty function LiveTV only options
TestCreatePlayReadyDRMHeader( NULL, NULL, NULL, pronoheader1.dat )

TestManagerSetHeader( NORMAL, pronoheader1.dat, BINARY )=DRM_E_CH_INVALID_HEADER
TestManagerReinitialize(Drm_Reinitialize)

TestManagerSetPROHeaderWithKID(NORMAL, pronoheader1.dat, "!3x8NSroVg4eXCzWqPU!BA==")
TestManagerGetContentProperty(0,"!3x8NSroVg4eXCzWqPU!BA==")
TestManagerGetContentProperty(1 DRM_CGP_HEADER_TYPE,10)
TestManagerGetContentProperty(2,"!3x8NSroVg4eXCzWqPU!BA==")
TestManagerGetContentProperty(3,pronoheader1.dat, FILE)

TestManagerGetContentProperty(4 DRM_CGP_CIPHER_TYPE,1 eDRM_RC4_CIPHER)=DRM_E_RECORD_NOT_FOUND
TestManagerGetContentProperty(5 DRM_CGP_DECRYPTORSETUP,1 DRM_DECRYPTORSETUP_ONDEMAND)=DRM_E_RECORD_NOT_FOUND

TestManagerReinitialize(Drm_Reinitialize)

TestManagerSetPROHeaderWithKID(NORMAL, headerPR_NoELS.dat, "!3x8NSroVg4eXCzWqPU!BA==")
TestManagerGetContentProperty(0,"!3x8NSroVg4eXCzWqPU!BA==")
TestManagerGetContentProperty(1,10)
TestManagerGetContentProperty(2,"!3x8NSroVg4eXCzWqPU!BA==")
TestManagerGetContentProperty(3,headerPR_NoELS.dat, FILE)
TestManagerGetContentProperty(4,1)=0x8004C04F DRM_E_XMLNOTFOUND
TestManagerReinitialize(Drm_Reinitialize)

TestManagerSetHeader(NORMAL, v4_1header.xml)
TestManagerGetContentProperty(5 DRM_CGP_DECRYPTORSETUP,1 DRM_DECRYPTORSETUP_ONDEMAND)

' =================================================================================================
12493:BVT: set v4.1 header with WRMHeader and try composing license acquisition request.
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetRights(Play)
TestCreateWRMHeaderFromPool( WRMHeaderDefaultDecryptor, headerspool.xml, "v4.1 no DECRYPTORSETUP" )
TestCreatePlayReadyDRMHeader( WRMHeaderDefaultDecryptor, NULL, NULL, PRODefaultDecryptor.dat )
TestManagerSetHeader( NORMAL, PRODefaultDecryptor.dat, BINARY )
TestManagerGenerateChallenge(Dump,NULL,0,NULL,0,NULL,0,NULL,NULL,NULL,NULL,NULL,0,0)

' =================================================================================================
12494:BVT: Verify that request to DRM_Content_GetProperty() for DECRYPTORSETUP returns a "not found" error if it was not present in current WRMHeader
TestCreateWRMHeaderFromPool( WRMHeader1, headerspool.xml, "v4.1 no DECRYPTORSETUP", !3x8NSroVg4eXCzWqPU!BA==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader1, NULL, NULL, pro1.dat )
TestManagerReinitialize(Reset)
TestManagerSetHeader( NORMAL, pro1.dat, BINARY )
TestManagerGetContentProperty(5 DRM_CGP_DECRYPTORSETUP,1 DRM_DECRYPTORSETUP_ONDEMAND)=-2147172273(0X8004C04F, DRM_E_XMLNOTFOUND)

' =================================================================================================
12495:BVT:Verify that ALGID and VALUE attributes must be present in KID tag in WRMHeader
TestManagerReinitialize(Reset)
TestManagerSetHeader( NORMAL, pro_noalgid.dat, BINARY )=0X80041108(DRM_E_CH_INVALID_HEADER)
TestManagerReinitialize(Reset)
TestManagerSetHeader( NORMAL, pro_nokidvalue.dat, BINARY )=0X80041108(DRM_E_CH_INVALID_HEADER)

' =================================================================================================
12496:BVT:Call Drm_Content_SetProperty() with DRM_CSP_PLAYREADY_OBJ_WITH_KID params with v.4.1 header in PRO and KID different from one in the header. Confirm that KID specified in WRMHeader will be ignored.
TestCreateWRMHeaderFromPool( WRMHeader1, headerspool.xml, "Basic v4.1 AESCTR on demand", !3x8NSroVg4eXCzWqPU!BA==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader1, NULL, NULL, pro1.dat )
TestManagerReinitialize(Reset)
TestManagerSetPROHeaderWithKID(NORMAL, pro1.dat, "KQNXs2nvVdiUypvlgcROrA==")
TestManagerGetContentProperty(0,"KQNXs2nvVdiUypvlgcROrA==")
TestManagerGetContentProperty(1,10)

' =================================================================================================
12497:BVT:call Drm_Content_SetProperty() with DRM_CSP_PLAYREADY_OBJ_WITH_KID params with v.4.0 header in PRO. WRMHeader data should be ignored.
TestCreateWRMHeaderFromPool( WRMHeader1, headerspool.xml, "v4.0 header", !3x8NSroVg4eXCzWqPU!BA==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader1, NULL, NULL, pro1.dat )
TestManagerReinitialize(Reset)
TestManagerSetPROHeaderWithKID(NORMAL, pro1.dat, "KQNXs2nvVdiUypvlgcROrA==")
TestManagerGetContentProperty(0,"KQNXs2nvVdiUypvlgcROrA==")
TestManagerGetContentProperty(1,10)
TestManagerGetContentProperty(2,"KQNXs2nvVdiUypvlgcROrA==")
'TFS#285499: request to get cypher type should fail because of poAppContextInternal->eHeaderInContext == DRM_CSP_PLAYREADY_OBJ_WITH_KID.
'TestManagerGetContentProperty(4, 2)=0X80041108(DRM_E_CH_INVALID_HEADER)

' =================================================================================================
12498:FUNC:call Drm_Content_SetProperty() with DRM_CSP_PLAYREADY_OBJ_WITH_KID, use KID that does not match embedded license's KID. Verify that binding fails.
'Fill-in empty PRO with ELS
TestManagerReinitialize(Drm_Reinitialize)
TestCreatePlayReadyDRMHeader( NULL, NULL, NULL, pronoheader1.dat )
TestManagerSetPROHeaderWithKID(NORMAL, pronoheader1.dat, !3x8NSroVg4eXCzWqPU!BA==)
TestManagerCreateXMRLicenseFromPool( LEAF1_1, LiveTVLicenses.xml, "LiveTV Leaf 1_1" )
TestAddLicenseToPRO( !3x8NSroVg4eXCzWqPU!BA==, {63BAD16B-CE80-433E-80F4-8E6951B7382C}, LEAF1_1 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pronoheader1_1.dat)

'Reset app context, acquire root license and set PRO and KID combination where KID does not match what ELS contains
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetRights(Play)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "LiveTV Root 1" )
TestManagerGenerateXMRResponse( ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerSetPROHeaderWithKID(NORMAL, pronoheader1_1.dat, "6Hnr4J9LTvGQnmJJR!uCCQ==")

'Expect bind to fail
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})=0x8004C013 (DRM_E_LICENSENOTFOUND)

'Try the same scenario with PRO containing WRMHeader that matches embedded license KID. Expect binding to fail because WRMHeader's KID should be ignored.
TestManagerReinitialize(Drm_Reinitialize)
TestCreateWRMHeaderFromPool( WRMHeader1, headerspool.xml, "v4.0 header", 6Hnr4J9LTvGQnmJJR!uCCQ==, AAECAwQFBgcICQoLDA0ODw== )
TestCreatePlayReadyDRMHeader( WRMHeader1, NULL, NULL, pro40.dat )
TestManagerSetHeader( NORMAL, pro40.dat, BINARY )
TestManagerCreateXMRLicenseFromPool( LEAF1_1, LiveTVLicenses.xml, "LiveTV Leaf 1_1" )
TestAddLicenseToPRO( !3x8NSroVg4eXCzWqPU!BA==, {63BAD16B-CE80-433E-80F4-8E6951B7382C}, LEAF1_1 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE, pro40.dat)

'Reset app context, acquire root license and set PRO and KID combination where KID does not match what ELS contains
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetRights(Play)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "LiveTV Root 1" )
TestManagerGenerateXMRResponse( ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerSetPROHeaderWithKID(NORMAL, pro40.dat, "6Hnr4J9LTvGQnmJJR!uCCQ==")

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})=0x8004C013 (DRM_E_LICENSENOTFOUND)

'Now add a valid license with a matching KID into HDS. Binding should succeed.
TestManagerCreateXMRLicenseFromPool( LEAF1_2, LiveTVLicenses.xml, "LiveTV Leaf 1_1 copy#2" )
TestManagerGenerateXMRResponse( LEAF1_2 )
TestManagerProcessResponse( Dump, Dump, 0, 0 )

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1, NULL, NULL, {12863DC2-8610-4E07-A23A-19CDEC8C7BF3})

' =================================================================================================
12499:BVT:call Drm_Content_SetProperty() with DRM_CSP_PLAYREADY_OBJ_WITH_KID, use KID matching embedded license's KID. Bind should succeed.
'Fill-in empty PRO with ELS
TestManagerReinitialize(Drm_Reinitialize)
TestCreatePlayReadyDRMHeader( NULL, NULL, NULL, pronoheader1.dat )
TestManagerSetPROHeaderWithKID(NORMAL, pronoheader1.dat, !3x8NSroVg4eXCzWqPU!BA==)
TestManagerCreateXMRLicenseFromPool( LEAF1_1, LiveTVLicenses.xml, "LiveTV Leaf 1_1" )
TestAddLicenseToPRO( !3x8NSroVg4eXCzWqPU!BA==, {63BAD16B-CE80-433E-80F4-8E6951B7382C}, LEAF1_1 )
TestManagerGetContentProperty(3,NULL,NULL,SAVE_PRO_TO_FILE,pronoheader1_1.dat)

'Reset app context, acquire root license and set PRO and KID combination where KID does not match what ELS contains
TestManagerReinitialize(Drm_Reinitialize)
TestManagerSetRights(Play)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "LiveTV Root 1" )
TestManagerGenerateXMRResponse( ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerSetPROHeaderWithKID(NORMAL, pronoheader1_1.dat, "!3x8NSroVg4eXCzWqPU!BA==")

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1_1, NULL, NULL, {63BAD16B-CE80-433E-80F4-8E6951B7382C})


' V4 header testing

' =================================================================================================
83371:BVT:DRM_HDR_GetHeaderVersion should properly identify header version as 4.1
TestLoadHeader(V4_1validHeader.xml)
TestGetHeaderVersion(4 DRM_HEADER_VERSION_4_1)

' =================================================================================================
83372:BVT:DRM_HDR_Verify should sucessfully verify a valid V4.1 header with unknown, well-formed attributes in protectinfo, data, and wrmheader
TestLoadHeader(V4_1validHeader.xml)
TestContentHeaderVerify(NULL, NULL, NORMAL, 1)  

' =================================================================================================
83373:BVT:DRM_HDR_Verify should sucessfully verify a valid V4.1 header with no URLs and service ID
TestLoadHeader(V4_1validHeaderMin.xml)
TestContentHeaderVerify(NULL, NULL, NORMAL, 1)  

' =================================================================================================
83374:BVT:ContentHeaderGetAttribute, with v4.1 header, should return all supported indexed attributes
TestLoadHeader(V4_1validHeader.xml)
TestContentHeaderGetAttribute(NULL, 1 DRM_HEADER_ATTRIB_VERSION, NORMAL, 4.1.0.0)
TestContentHeaderGetAttribute(NULL, 2 DRM_HEADER_ATTRIB_KID, NORMAL, q4nloyNny0+cXV4jlSR38Q==)
TestContentHeaderGetAttribute(NULL, 7 DRM_HEADER_ATTRIB_LAURL, NORMAL, http://www.contoso.com/licenseacq.asp)
TestContentHeaderGetAttribute(NULL, 4 DRM_HEADER_ATTRIB_CHECKSUM, NORMAL, jPgQu30r1g==)
TestContentHeaderGetAttribute(NULL, 5 DRM_HEADER_ATTRIB_SECURITYVERSION, NORMAL, 2.2)
TestContentHeaderGetAttribute(NULL, 8 DRM_HEADER_ATTRIB_LUIINFO, NORMAL, http://www.contoso.com/licenseuiacq.asp)
TestContentHeaderGetAttribute(NULL, 9 DRM_HEADER_ATTRIB_SERVICEID, NORMAL, AH+03juKbUGbHl1V/QIwRA==)
TestContentHeaderGetAttribute(NULL, 10 DRM_HEADER_ATTRIB_DECRYPTOR_SETUP, NORMAL, ONDEMAND)
TestContentHeaderGetAttribute(NULL, 11 DRM_HEADER_ATTRIB_ALGID, NORMAL, COCKTAIL)

' =================================================================================================
83375:BVT:ContentHeaderGetAttribute, with v4.1 header,  should use the attribute name if the attribute index is 'Other'
TestLoadHeader(V4_1validHeader.xml)
TestContentHeaderGetAttribute(CID, 6 DRM_HEADER_ATTRIB_OTHER, NORMAL, 188)

' =================================================================================================
83376:FUNC:P0:ContentHeaderGetAttribute, with v4.1 header, should be able to get the entire attribute data if it has sub nodes
TestLoadHeader(V4_1validHeader.xml)
TestContentHeaderGetAttribute(OWNER, 6 DRM_HEADER_ATTRIB_OTHER, NORMAL, <NAME>V4SRV</NAME>)

' =================================================================================================
83377:FUNC:P0:ContentHeaderGetAttribute, with v4.1 header, should be able to get the first sub attribute using 'attr1/attr2'
TestLoadHeader(V4_1validHeader.xml)
TestContentHeaderGetAttribute(OWNER/NAME, 6 DRM_HEADER_ATTRIB_OTHER, NORMAL, V4SRV)
TestContentHeaderGetAttribute(PROTECTINFO/CUSTOM, 6 DRM_HEADER_ATTRIB_OTHER, NORMAL, data)

' =================================================================================================
83378:FUNC:P0:ContentHeaderGetUplink, with v4.1 header, should retrieve the uplink KID when the header has one uplink KID
TestLoadHeader(V4_1uplinkHeader.xml)
TestContentHeaderGetUplink(0, "4wEEq1ixJEC1na7nmgJT5g==")

' =================================================================================================
83379:DRT:ContentHeaderVerify, with v4.1 header, should fail if the header is not a well formed XML string
TestLoadHeader(V4_1NonXMLHeader.xml)
TestContentHeaderVerify(NULL, NULL, NORMAL)=0X80041108 DRM_E_CH_INVALID_HEADER

' =================================================================================================
83381:DRT:ContentHeaderGetAttribute, with v4.1 header, should return an error if an required attribute does not exist in the header (CHECKSUM is optional and should thus succeed if missing)
TestLoadHeader(V4_1HeaderEmptyKID.xml)
TestContentHeaderVerify(NULL, NULL, NORMAL)=0x80041108 DRM_E_CH_INVALID_HEADER

' =================================================================================================
83382:DRT:ContentHeaderGetAttribute, with v4.1 header, should fail if attribute name is not null and index is not 'other'
TestLoadHeader(V4_1validHeader.xml)
TestContentHeaderGetAttribute(Custom, 1 DRM_HEADER_ATTRIB_VERSION, NORMAL, VERSION)=-2147024809(0X80070057, E_INVALIDARG)
TestContentHeaderGetAttribute(Custom, 2 DRM_HEADER_ATTRIB_KID, NORMAL, KID)=-2147024809(0X80070057, E_INVALIDARG)

' =================================================================================================
83383:FUNC:P1:ContentHeaderGetAttribute, with v4.1 header, should return E_INVALIDARG if any required parameter is NULL
TestContentHeaderGetAttribute(NULL, 1 DRM_HEADER_ATTRIB_VERSION, NORMAL)=-2147024809(0X80070057, E_INVALIDARG)
TestLoadHeader(V4_1validHeader.xml)
TestContentHeaderGetAttribute(NULL, 1 DRM_HEADER_ATTRIB_VERSION, NULL)=-2147024809(0X80070057, E_INVALIDARG)
TestContentHeaderGetAttribute(NULL, 6 DRM_HEADER_ATTRIB_OTHER, NORMAL)=-2147024809(0X80070057, E_INVALIDARG)

' =================================================================================================
83384:FUNC:P1:ContentHeaderGetAttribute, with v4.1 header, should fail if attribute name is empty
TestLoadHeader(V4_1validHeader.xml)
TestContentHeaderGetAttribute(EMPTY, 6 DRM_HEADER_ATTRIB_OTHER, NORMAL)=-2147024809(0X80070057, E_INVALIDARG)

' =================================================================================================
83385:FUNC:P1:ContentHeaderGetAttribute, with v4.1 header, should return E_INVALIDARG for invalid attribute index
TestLoadHeader(V4_1validHeader.xml)
TestContentHeaderGetAttribute(EMPTY, 0 Invalid Attribute, NORMAL)=-2147024809(0X80070057, E_INVALIDARG)
TestContentHeaderGetAttribute(EMPTY, 11 Invalid Attribute, NORMAL)=-2147024809(0X80070057, E_INVALIDARG)

' =================================================================================================
83386:DRT:ContentHeaderGetAttribute, with v4.1 header, should return an error code if header is not a well formed XML string
TestLoadHeader(V4_1NonXMLHeader.xml)
TestContentHeaderGetAttribute(NULL, 10 DRM_HEADER_ATTRIB_DECRYPTOR_SETUP, NORMAL)=-2147217144(0X80041108,CH_INVALID_HEADER)

' =================================================================================================
83387:FUNC:P1:ContentHeaderGetUplink, with v4.1 header, should fail if asking for the second uplink KID but only one exists
TestLoadHeader(V4_1uplinkHeader.xml)
TestContentHeaderGetUplink(1, EMPTY)=-2147172273(0X8004C04F, DRM_E_XMLNOTFOUND)

' =================================================================================================
83388:DRT:ContentHeaderGetUplink, with v4.1 header, should fail if no uplink KID exists
TestLoadHeader(V4_1validHeader.xml)
TestContentHeaderGetUplink(0, EMPTY)=-2147172273(0X8004C04F, DRM_E_XMLNOTFOUND)

' =================================================================================================
83389:FUNC:P1:ContentHeaderGetUplink, with v4.1 header, can get the second uplink kid when the header has two KID's
TestLoadHeader(V4_1twouplinks.xml)
TestContentHeaderGetUplink(1, "5KEEq2jxJEc1na7nmgJT5g==")

' =================================================================================================
83392:BVT:P0:DRM_HDR_GetAttribute should successfully find AlgID from a valid V4.1 header which contains an ALGID within the ProtectInfo section
TestLoadHeader(V4_1validHeaderAes.xml)
TestContentHeaderGetAttribute(NULL, 11 DRM_HEADER_ATTRIB_ALGID, NORMAL, AESCTR)

' =================================================================================================
83393:FUNC:P1:DRM_HDR_Verify should successfully verify a valid V4.1 header with protectinfo but no KID nodes
TestLoadHeader(V4_1validHeader.xml)
TestContentHeaderVerify(7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==, ValidCrypto, NORMAL)

' =================================================================================================
83394:FUNC:P1:DRM_HDR_Verify should fail to verify a V4.1 header with no KID
TestLoadHeader(V4_1HeaderNoKID.xml)
TestContentHeaderVerify(NULL, NULL, NORMAL)

' =================================================================================================
83395:FUNC:P1:DRM_HDR_Verify should verify a V4.1 header with only a WRMHeader node, nothing else
TestLoadHeader(V4_1validHeaderMin.xml)
TestContentHeaderVerify(NULL, ValidCrypto, NORMAL)

' =================================================================================================
83396:FUNC:P1:DRM_HDR_Verify should return an appropriate error code when a V4.1 header to too long (> DRM_HEADER_MAX_SIZE_IN_BYTES(5120))
TestLoadHeader(V4_1LongHeader.xml)
TestContentHeaderVerify(NULL, ValidCrypto, NORMAL)=-2147217144(0X80041108, CH_INVALID_HEADER)

' =================================================================================================
83397:FUNC:P2:DRM_HDR_GetAttribute should return an appropriate error code when an attribute is not found in a V4.1 header
TestLoadHeader(V4_1validHeaderMin.xml)
TestContentHeaderGetAttribute(NULL, 9 DRM_HEADER_ATTRIB_SERVICEID, NORMAL) = 0X8004C04F(DRM_E_XMLNOTFOUND)
TestContentHeaderGetAttribute(NULL, 10 DRM_HEADER_ATTRIB_DECRYPTOR_SETUP, NORMAL) = 0X8004C04F(DRM_E_XMLNOTFOUND)

' =================================================================================================
570002:FUNC: Test creation of a v4.1 PR Rights Management Header with COCKTAIL cipher type and unset decryptor setup using Drm_Content_SetProperty.
TestCreateHeader( Drm_Content_SetProperty, V4_1CocktailHeaderGenerated.xml, COCKTAIL, AAECAwQFBgcICQoLDA0ODw==, BBB, http://someurl-LA.com, http://someurl-UI.com, 13, <A>B</A>, NULL, DRM_HEADER_VERSION_4_1 )

' =================================================================================================
570003:FUNC: Test creation of a v4.1 PR Rights Management Header with AESCTR cipher type and ONDEMAND decryptor setup using Drm_Content_SetProperty.
TestCreateHeader( Drm_Content_SetProperty, V4_1AesCtrHeaderGenerated.xml, AESCTR, AAECAwQFBgcICQoLDA0ODw==, CCC, http://someurl-LA.com, http://someurl-UI.com, 13, <A>B</A>, "ONDEMAND", DRM_HEADER_VERSION_4_1 )

' =================================================================================================
570004:FUNC: Test creation of a v4.0 PR Rights Management Header with minimal properties
TestCreateHeader( Drm_Content_SetProperty, V4_1EmptyHeaderGenerated.xml, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL )

' =================================================================================================

' PlayReady object testing

' =================================================================================================
83401:FUNC:P2:Extracting V4 and v4.1 XML header from PlayReady object and comparing extracted header to original one
TestPlayReadyObjectParser( "headerPR.dat", "header-V4-temp.xml" )
BinaryCompareFiles( NULL, "header-V4-temp.xml", NULL, "headerV4_U.xml" )
TestPlayReadyObjectParser( "V4_1headerPR.dat", "header-V4_1-temp.xml" )
BinaryCompareFiles( NULL, "header-V4_1-temp.xml", NULL, "V4_1header_U.xml" )

' =================================================================================================
83402:FUNC:P2:Same as 83401 but PlayReady header consist of 5 different record: 
'signature, random, embedded license, xml v4 header and the same random record again 
TestPlayReadyObjectParser( "headerPR-5records.dat", "header-V4-temp.xml" )
BinaryCompareFiles( NULL, "header-V4-temp.xml", NULL, "headerV4_U.xml" )
TestPlayReadyObjectParser( "V4_1headerPR-5records.dat", "header-V4_1-temp.xml" )
BinaryCompareFiles( NULL, "header-V4_1-temp.xml", NULL, "V4_1header_U.xml" )

' Header creation testing

' =================================================================================================
520007:FUNC:P0:CATT:Testing creation of v4.1 PlayReady Header. Just straightfoward case
Test_DRM_PRO_CreatePlayReadyDRMHeader( V4_1UNICODE.xml, NORMAL, NULL, NULL )

' =================================================================================================
520008:FUNC:P0:CATT:Testing creation of v4.1 PlayReady Header. If buffer for header NULL should return DRM_E_BUFFERTOOSMALL.
Test_DRM_PRO_CreatePlayReadyDRMHeader( V4_1UNICODE.xml, NULL, 0, NULL )=2147942522(DRM_E_BUFFERTOOSMALL). 

' =================================================================================================
520009:FUNC:P0:CATT:Testing creation of v4.1 PlayReady Header. Passing 10 bytes buffer for header.
Test_DRM_PRO_CreatePlayReadyDRMHeader( V4_1UNICODE.xml, NORMAL, 10, NULL )=2147942522(DRM_E_BUFFERTOOSMALL). 

' =================================================================================================
520010:FUNC:P0:CATT:Testing creation of v4.1 PlayReady Header with a cocktail V4 header.
Test_DRM_PRO_CreatePlayReadyDRMHeader( V4_1Cocktail_UNICODE.xml, NORMAL, NULL, 1 )


' =================================================================================================
21472:FUNC: SLS - Validate leaf licenses with the following number of keys - 1, 2, 236, 1000, 1512, and 2000
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

' Device Bound - Root 2000 - Leaf 1 Key )
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 2000 locations" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf with 1 location" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' Device Bound - Root 2000 - Leaf 2 Keys )
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 2000 locations" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf with 2 locations" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' Device Bound - Root 2000 - Leaf 236 Keys )
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 2000 locations" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf with 236 locations" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' Device Bound - Root 2000 - Leaf 1000 Keys )
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 2000 locations" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf with 1000 locations" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' Device Bound - Root 2000 - Leaf 1512 Keys )
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 2000 locations" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf with 1512 locations" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' Device Bound - Root 2000 - Leaf 2000 Keys )
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 2000 locations" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf with 2000 locations" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

If(DomainSupported)
' Join a domain
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Root 2000 - Leaf 1 Key )
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 2000 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf with 1 location" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' Domain Bound - Root 2000 - Leaf 2 Keys )
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 2000 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf with 2 locations" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' Domain Bound - Root 2000 - Leaf 236 Keys )
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 2000 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf with 236 locations" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' Domain Bound - Root 2000 - Leaf 1000 Keys )
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 2000 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf with 1000 locations" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' Domain Bound - Root 2000 - Leaf 1512 Keys )
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 2000 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf with 1512 locations" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

' Domain Bound - Root 2000 - Leaf 2000 Keys )
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 2000 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf with 2000 locations" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)
EndIf

' =================================================================================================
21507:FUNC: SLS - Non-scalable root licenses with state-full rights and restrictions are rejected if the license contains a RemovalDate object

TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

' Device Bound - Expiration Date 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Non-scalable Root with RemovalDate - Expiration Date" )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Device Bound - Expire Afer First Use 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Non-scalable Root with RemovalDate - Expire Afer First Use" )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Device Bound - Expire Afer First Play 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Non-scalable Root with RemovalDate - Expire Afer First Play" ) 
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 dont overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Device Bound - Expire Afer First Store 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Non-scalable Root with RemovalDate - Expire Afer First Store" ) 
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 dont overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Device Bound - Play Count 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Non-scalable Root with RemovalDate - Play Count" )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 dont overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Device Bound - Metering 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Non-scalable Root with RemovalDate - Metering" )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 dont overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Device Bound - Playlist Burn 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Non-scalable Root with RemovalDate - Playlist Burn" )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 dont overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Device Bound - Cannot Persist 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Non-scalable Root with RemovalDate - Cannot Persist" )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 dont overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

If(DomainSupported)
' Reset the context back to default and join a domain
TestManagerReinitialize(Reset)
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Expiration Date 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Non-scalable Root with RemovalDate - Expiration Date", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 dont overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Domain Bound - Expire Afer First Use 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Non-scalable Root with RemovalDate - Expire Afer First Use", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 dont overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Domain Bound - Expire Afer First Play 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Non-scalable Root with RemovalDate - Expire Afer First Play", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 dont overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Domain Bound - Expire Afer First Store 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Non-scalable Root with RemovalDate - Expire Afer First Store", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 dont overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Domain Bound - Play Count 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Non-scalable Root with RemovalDate - Play Count", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 dont overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Domain Bound - Metering 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Non-scalable Root with RemovalDate - Metering", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 dont overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Domain Bound - Playlist Burn 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Non-scalable Root with RemovalDate - Playlist Burn", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 dont overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Domain Bound - Cannot Persist 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Non-scalable Root with RemovalDate - Cannot Persist", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 dont overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

TestManagerCleanLicenseStore(1)
EndIf

' =================================================================================================
21508:FUNC: SLS - Scalable root licenses with state-full rights and restrictions are rejected if the license contains a RemovalDate object
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

' Device Bound - Expiration Date 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Root with RemovalDate - Expiration Date" )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Device Bound - Expire Afer First Use 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Root with RemovalDate - Expire Afer First Use" )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Device Bound - Expire Afer First Play 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Root with RemovalDate - Expire Afer First Play" )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Device Bound - Expire Afer First Store 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Root with RemovalDate - Expire Afer First Store" )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Device Bound - Play Count 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Root with RemovalDate - Play Count" )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Device Bound - Metering 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Root with RemovalDate - Metering" )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Device Bound - Playlist Burn 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Root with RemovalDate - Playlist Burn" )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Device Bound - Cannot Persist 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Root with RemovalDate - Cannot Persist" )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

If(DomainSupported)
' Reset the context back to default and join a domain
TestManagerReinitialize(Reset)
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Expiration Date 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Root with RemovalDate - Expiration Date", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Domain Bound - Expire Afer First Use 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Root with RemovalDate - Expire Afer First Use", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND
 
' Domain Bound - Expire Afer First Play 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Root with RemovalDate - Expire Afer First Play", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Domain Bound - Expire Afer First Store 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Root with RemovalDate - Expire Afer First Store", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Domain Bound - Play Count 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Root with RemovalDate - Play Count", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Domain Bound - Metering 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Root with RemovalDate - Metering", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Domain Bound - Playlist Burn 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Root with RemovalDate - Playlist Burn", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

' Domain Bound - Cannot Persist 
TestManagerCreateXMRLicenseFromPool( ROOT_LICENSE, LiveTVLicenses.xml, "Root with RemovalDate - Cannot Persist", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerGenerateXMRResponse( ROOT_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(0 don't overwrite drmmanager context, Dump, Dump,NULL)= DRM_E_LICENSENOTFOUND

TestManagerCleanLicenseStore(1)
EndIf

' =================================================================================================
21509:FUNC: SLS - Scalable root licenses with state-full rights and restrictions are accepted if the license does not contain a RemovalDate object
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

'  Device Bound - Expiration Date 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root without RemovalDate - Expiration Date" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

'  Device Bound - Expire Afer First Play 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root without RemovalDate - Expire Afer First Play" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

'  Device Bound - Copy Count 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root without RemovalDate - Copy Count" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

'  Device Bound - Metering 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root without RemovalDate - Metering" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

'  Device Bound - Cannot Persist 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root without RemovalDate - Cannot Persist")
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

If(DomainSupported)
' Reset the context back to default and join a domain
TestManagerReinitialize(Reset)
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )


'  Domain Bound - Expiration Date 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root without RemovalDate - Expiration Date", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

'  Domain Bound - Expire Afer First Play 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root without RemovalDate - Expire Afer First Play", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

'  Domain Bound - Copy Count 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root without RemovalDate - Copy Count", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

'  Domain Bound - Metering 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root without RemovalDate - Metering", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

'  Domain Bound - Cannot Persist 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root without RemovalDate - Cannot Persist", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1)

EndIf

' =================================================================================================
21543:FUNC: SLS - Root licenses with keys not in ascending order are rejected
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

'  Device Bound - Root with 10 locations - All descending order 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - All descending order" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

'  Device Bound - Root with 10 locations - First ascending then descending 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - First ascending then descending" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

'  Device Bound - Root with 10 locations - ascending then one earlier then ascending 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - ascending then one earlier then ascending" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

'  Device Bound - Root with 10 locations - ascending then one later then ascending 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - ascending then one later then ascending" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

'  Device Bound - Root with 10 locations - random order 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - random order" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

'  Device Bound - Root with 10 locations - first two keys have same location 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - first two keys have same location" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

'  Device Bound - Root with 10 locations - last two keys have same location 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - last two keys have same location" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

'  Device Bound - Root with 10 locations - middle two keys have same location 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - middle two keys have same location" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

'  Device Bound - Root with 10 locations - first and last keys have same location 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - first and last keys have same location" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

'  Device Bound - Root with 10 locations - 2 nonadjacent keys have same location 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - 2 nonadjacent keys have same location" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

If(DomainSupported)
' Reset the context back to default and join a domain
TestManagerReinitialize(Reset)
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

'  Domain Bound - Root with 10 locations - All descending order 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - All descending order", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

'  Domain Bound - Root with 10 locations - First ascending then descending 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - First ascending then descending", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

'  Domain Bound - Root with 10 locations - ascending then one earlier then ascending 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - ascending then one earlier then ascending", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

'  Domain Bound - Root with 10 locations - ascending then one later then ascending 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - ascending then one later then ascending", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

'  Domain Bound - Root with 10 locations - random order 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - random order", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

'  Domain Bound - Root with 10 locations - first two keys have same location 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - first two keys have same location", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

'  Domain Bound - Root with 10 locations - last two keys have same location 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - last two keys have same location", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

'  Domain Bound - Root with 10 locations - middle two keys have same location 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - middle two keys have same location", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

'  Domain Bound - Root with 10 locations - first and last keys have same location 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - first and last keys have same location", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

'  Domain Bound - Root with 10 locations - 2 nonadjacent keys have same location 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 10 locations - 2 nonadjacent keys have same location", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse(LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

EndIf

' =================================================================================================
21544:FUNC: SLS - Root license with an expired RemovalDate object is usable before being cleaned up
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

' Device Bound 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 30s RemovalDate" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
Test_ChangeTimeSeconds(30)
TestEnumLicense( KQNXs2nvVdiUypvlgcROrA==,XMR,1)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore( 1, 30, ALL )

If(DomainSupported)
' Domain Bound 
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

TestManagerCreateXMRLicenseFromPool( ROOT , LiveTVLicenses.xml, "Root with 30s RemovalDate", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
Test_ChangeTimeSeconds(30)
TestEnumLicense( KQNXs2nvVdiUypvlgcROrA==,XMR,1)
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore( 1, 30, ALL )

EndIf

' =================================================================================================
21536:FUNC: SLS - Leaf with a key that is not in the root is not usable
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

' Device Bound 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 1000 locations" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0 2500" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)

If(DomainSupported)
' Domain Bound 
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

TestManagerCreateXMRLicenseFromPool( ROOT , LiveTVLicenses.xml, "Root with 1000 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0 2500" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UNABLE_TO_RESOLVE_LOCATION_TREE
TestManagerCleanLicenseStore(1)
EndIf

' =================================================================================================
21537:FUNC: SLS - Leaf that uses a root with an expired RemovelDate object can still be acquired
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

' Device Bound 
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 30s RemovalDate" )
Test_ChangeTimeSeconds(30)
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1, 30, ALL)

If(DomainSupported)
' Domain Bound 
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

TestManagerCreateXMRLicenseFromPool( ROOT , LiveTVLicenses.xml, "Root with 30s RemovalDate", NjU0MzIxMDk4NzY1NDMyMQ== )
Test_ChangeTimeSeconds(30)
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
TestManagerCleanLicenseStore(1, 30, ALL )
EndIf

' =================================================================================================
21548: SLS - A simple license can have a RemovalDate object
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

' Device Bound 
TestManagerCreateXMRLicenseFromPool(SIMPLE_LICENSE ,LiveTVLicenses.xml, "Simple license with 30s RemovalDate" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

Test_ChangeTimeSeconds ( 45 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerCleanLicenseStore(FALSE)
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,0 )

If(DomainSupported)
' Domain Bound 
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )
TestManagerCreateXMRLicenseFromPool(SIMPLE_LICENSE,LiveTVLicenses.xml, "Simple license with 30s RemovalDate", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

Test_ChangeTimeSeconds ( 45 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerCleanLicenseStore(FALSE)
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,0 )
EndIf

' =================================================================================================
21549: SLS - A simple license can not have scalable license keys
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

' Device Bound 
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE, LiveTVLicenses.xml, "Simple license with 30s RemovalDate and scalable license keys" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_LICENSENOTFOUND

If(DomainSupported)
' Domain Bound 
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE, LiveTVLicenses.xml, "Simple license with 30s RemovalDate and scalable license keys", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_LICENSENOTFOUND
EndIf

' =================================================================================================
21572: SLS - Verify that when two Root licenses with the same KID are in the license store, the correct Root is used
TestManagerSetRights(Play)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
TestManagerCleanLicenseStore(1)

' Device Bound - Identical roots except for the LID 
TestManagerCreateXMRLicenseFromPool( ROOT1 ,LiveTVLicenses.xml, "Root with 31 locations and LID 1" )
TestManagerCreateXMRLicenseFromPool( ROOT2 ,LiveTVLicenses.xml, "Root with 31 locations and LID 2" )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( ROOT1 , ROOT2 , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,2 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== , XMR ,1 )

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - One root with scalable license keys and another without scalable license keys 
TestManagerCreateXMRLicenseFromPool( ROOT1 ,LiveTVLicenses.xml, "Root with 31 locations and LID 1" )
TestManagerCreateXMRLicenseFromPool( ROOT2 ,LiveTVLicenses.xml, "Non-scalable root and LID 3" )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( ROOT1 , ROOT2 , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,2 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== , XMR ,1 )

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - One root with scalable license keys and another with scalable license keys subset of first 
TestManagerCreateXMRLicenseFromPool( ROOT1 ,LiveTVLicenses.xml, "Root with 31 locations and LID 1" )
TestManagerCreateXMRLicenseFromPool( ROOT2 ,LiveTVLicenses.xml, "Root with 128 locations and LID 4" )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 65" )
TestManagerGenerateXMRResponse( ROOT1 , ROOT2 , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,2 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== , XMR ,1 )

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - One root with scalable license keys and another with the same set, but different actual keys
TestManagerCreateXMRLicenseFromPool( ROOT1 ,LiveTVLicenses.xml, "Root with 31 locations and LID 1" )
TestManagerCreateXMRLicenseFromPool( ROOT2 ,LiveTVLicenses.xml, "Root with 31 locations and LID 5 - Different Base Key" )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( ROOT1 , ROOT2 , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )

TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,2 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== , XMR ,1 )

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Two roots with different scalable license key sets 
TestManagerCreateXMRLicenseFromPool( ROOT1 ,LiveTVLicenses.xml, "Root with 4 locations and LID 6 - Set 1" )
TestManagerCreateXMRLicenseFromPool( ROOT2 ,LiveTVLicenses.xml, "Root with 4 locations and LID 7 - Set 2" )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 10" )
TestManagerGenerateXMRResponse( ROOT1 , ROOT2 , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )

TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,2 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== , XMR ,1 )

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - One root with a RemovalDate and one root without a RemovalDate 
TestManagerCreateXMRLicenseFromPool( ROOT1 ,LiveTVLicenses.xml, "Root with 31 locations and LID 8 - RemovalDate" )
TestManagerCreateXMRLicenseFromPool( ROOT2 ,LiveTVLicenses.xml, "Root with 31 locations and LID 1" )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( ROOT1 , ROOT2 , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )

TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,2 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== , XMR ,1 )

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

If(DomainSupported)
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Identical roots except for the LID 
TestManagerCreateXMRLicenseFromPool( ROOT1 ,LiveTVLicenses.xml, "Root with 31 locations and LID 1", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( ROOT2 ,LiveTVLicenses.xml, "Root with 31 locations and LID 2", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( ROOT1 , ROOT2 , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )

TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,2 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== , XMR ,1 )

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - One root with scalable license keys and another without scalable license keys 
TestManagerCreateXMRLicenseFromPool( ROOT1 ,LiveTVLicenses.xml, "Root with 31 locations and LID 1", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( ROOT2 ,LiveTVLicenses.xml, "Non-scalable root and LID 3", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( ROOT1 , ROOT2 , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )

TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,2 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== , XMR ,1 )

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - One root with scalable license keys and another with scalable license keys subset of first 
TestManagerCreateXMRLicenseFromPool( ROOT1 ,LiveTVLicenses.xml, "Root with 31 locations and LID 1", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( ROOT2 ,LiveTVLicenses.xml, "Root with 128 locations and LID 4", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 65" )
TestManagerGenerateXMRResponse( ROOT1 , ROOT2 , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )

TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,2 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== , XMR ,1 )

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - One root with scalable license keys and another with the same set, but different actual keys 
TestManagerCreateXMRLicenseFromPool( ROOT1 ,LiveTVLicenses.xml, "Root with 31 locations and LID 1", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( ROOT2 ,LiveTVLicenses.xml, "Root with 31 locations and LID 5 - Different Base Key", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( ROOT1 , ROOT2 , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )

TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,2 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== , XMR ,1 )

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Two roots with different scalable license key sets 
TestManagerCreateXMRLicenseFromPool( ROOT1 ,LiveTVLicenses.xml, "Root with 4 locations and LID 6 - Set 1", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( ROOT2 ,LiveTVLicenses.xml, "Root with 4 locations and LID 7 - Set 2", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 10" )
TestManagerGenerateXMRResponse( ROOT1 , ROOT2 , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )

TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,2 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== , XMR ,1 )

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - One root with a RemovalDate and one root without a RemovalDate 
TestManagerCreateXMRLicenseFromPool( ROOT1 ,LiveTVLicenses.xml, "Root with 31 locations and LID 8 - RemovalDate", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( ROOT2 ,LiveTVLicenses.xml, "Root with 31 locations and LID 1", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( ROOT1 , ROOT2 , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )

TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,2 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== , XMR ,1 )

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - One root device bound and one root domain bound 
TestManagerCreateXMRLicenseFromPool( ROOT1 ,LiveTVLicenses.xml, "Root with 31 locations and LID 1" )
TestManagerCreateXMRLicenseFromPool( ROOT2 ,LiveTVLicenses.xml, "Root with 31 locations and LID 2", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( ROOT1 , ROOT2 , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )

TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,2 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== , XMR ,1 )

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

EndIf

' =================================================================================================
21573:FUNC: SLS - Verify that when root and Simple licenses have the same KID are in the license store the root license is used
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

' Device Bound - root has scalable license keys and simple does not have scalable license keys 
TestManagerCreateXMRLicenseFromPool( ROOT1 ,LiveTVLicenses.xml, "Root with 31 locations and LID 1" )
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE ,LiveTVLicenses.xml, "Simple license with root KID and LID 2" )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( ROOT1 , SIMPLE_LICENSE , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,2 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== , XMR ,1 )

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - root does not have scalable license keys and simple does not have scalable license keys  
TestManagerCreateXMRLicenseFromPool( ROOT1 ,LiveTVLicenses.xml, "Non-scalable root and LID 3" )
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE ,LiveTVLicenses.xml, "Simple license with root KID and LID 2" )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( ROOT1 , SIMPLE_LICENSE , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,2 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== , XMR ,1 )

'this test scenario is expected to return error
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UPLINKLICENSENOTFOUND

If(DomainSupported)

TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

'Domain Bound - root has scalable license keys and simple does not have scalable license keys
TestManagerCreateXMRLicenseFromPool( ROOT1 ,LiveTVLicenses.xml, "Root with 31 locations and LID 1", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE ,LiveTVLicenses.xml, "Simple license with root KID and LID 2", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( ROOT1 , SIMPLE_LICENSE , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,2 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== , XMR ,1 )

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - root does not have scalable license keys and simple does not have scalable license keys  
TestManagerCreateXMRLicenseFromPool( ROOT1 ,LiveTVLicenses.xml, "Non-scalable root and LID 3", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE ,LiveTVLicenses.xml, "Simple license with root KID and LID 2", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( ROOT1 , SIMPLE_LICENSE , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,2 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== , XMR ,1 )

'this test scenario is expected to return error
TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)=DRM_E_UPLINKLICENSENOTFOUND

EndIf

' =================================================================================================
21566: SLS - Root and Leaf licenses with a RemovalDate are automatically put in the permanent license store
TestManagerSetRights( Play )
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

'Device Bound
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 30s RemovalDate" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestVerifyStoreSlotCount( "LicStorexmr", 2 )

If(DomainSupported)
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

'Domain Bound
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "Root with 30s RemovalDate", NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestVerifyStoreSlotCount( "LicStorexmr", 2 )

EndIf

' =================================================================================================
21567: SLS - Simple license with a RemovalDate is automatically put in the permanent license store
TestManagerSetRights( Play )
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

'Device Bound
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE , LiveTVLicenses.xml, "Simple license with 30s RemovalDate" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE  )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestVerifyStoreSlotCount( "LicStorexmr", 1 )

If(DomainSupported)
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

'Domain Bound
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE , LiveTVLicenses.xml, "Simple license with 30s RemovalDate" , NjU0MzIxMDk4NzY1NDMyMQ==  )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestVerifyStoreSlotCount( "LicStorexmr", 1 )
EndIf

' =================================================================================================
21547: SLS - Root license with scalable license keys and no RemovalDate object is usable
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

' Device Bound 
TestManagerCreateXMRLicenseFromPool( ROOT ,LiveTVLicenses.xml, "Permanent Root with 2500 locations" )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( ROOT , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,1 ) 

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

If(DomainSupported)
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound 
TestManagerCreateXMRLicenseFromPool( ROOT ,LiveTVLicenses.xml, "Permanent Root with 2500 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool( LEAF ,LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( ROOT , LEAF )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( KQNXs2nvVdiUypvlgcROrA== , XMR ,1 ) 

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, NULL)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

EndIf

' =================================================================================================
21595: SLS - Non-stateful restrictions in a simple license with a RemovalDate continue to work
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

' Device Bound - Analog Video OPL 
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE , LiveTVLicenses.xml, "Simple license with 30s RemovalDate - Analog Video OPL" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,150,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Analog Video Extensions 
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE , LiveTVLicenses.xml, "Simple license with 30s RemovalDate - Analog Video Extensions" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,150,100,100,0,1)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Compressed Digital Video OPL 
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE , LiveTVLicenses.xml, "Simple license with 30s RemovalDate - Compressed Digital Video OPL" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(400,100,100,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Compressed Digital Audio OPL 
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE , LiveTVLicenses.xml, "Simple license with 30s RemovalDate - Compressed Digital Audio OPL" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,100,150,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Uncompressed Digital Video OPL 
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE , LiveTVLicenses.xml, "Simple license with 30s RemovalDate - Uncompressed Digital Video OPL" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,250,100,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Uncompressed Digital Audio OPL 
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE , LiveTVLicenses.xml, "Simple license with 30s RemovalDate - Uncompressed Digital Audio OPL" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,100,100,150,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

If(DomainSupported) 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Analog Video OPL 
TestManagerCreateXMRLicenseFromPool(SIMPLE_LICENSE , LiveTVLicenses.xml, "Simple license with 30s RemovalDate - Analog Video OPL", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,150,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Analog Video Extensions 
TestManagerCreateXMRLicenseFromPool(SIMPLE_LICENSE , LiveTVLicenses.xml, "Simple license with 30s RemovalDate - Analog Video Extensions", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,150,100,100,0,1)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Compressed Digital Video OPL 
TestManagerCreateXMRLicenseFromPool(SIMPLE_LICENSE , LiveTVLicenses.xml, "Simple license with 30s RemovalDate - Compressed Digital Video OPL", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(400,100,100,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Compressed Digital Audio OPL 
TestManagerCreateXMRLicenseFromPool(SIMPLE_LICENSE , LiveTVLicenses.xml, "Simple license with 30s RemovalDate - Compressed Digital Audio OPL", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,100,150,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Uncompressed Digital Video OPL 
TestManagerCreateXMRLicenseFromPool(SIMPLE_LICENSE, LiveTVLicenses.xml, "Simple license with 30s RemovalDate - Uncompressed Digital Video OPL", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,250,100,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Uncompressed Digital Audio OPL 
TestManagerCreateXMRLicenseFromPool(SIMPLE_LICENSE, LiveTVLicenses.xml, "Simple license with 30s RemovalDate - Uncompressed Digital Audio OPL", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,100,100,150,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

EndIf

' =================================================================================================
21596: SLS - Non-stateful restrictions in a root license with scalable license keys and a RemovalDate continue to work
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

' Device Bound - Analog Video OPL 
TestManagerCreateXMRLicenseFromPool( ROOT , LiveTVLicenses.xml, "Root license - Analog Video OPL" )
TestManagerCreateXMRLicenseFromPool( LEAF , LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,150,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Analog Video Extensions 
TestManagerCreateXMRLicenseFromPool(ROOT, LiveTVLicenses.xml, "Root license - Analog Video Extensions" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,150,100,100,0,1)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Compressed Digital Video OPL 
TestManagerCreateXMRLicenseFromPool(ROOT, LiveTVLicenses.xml, "Root license - Compressed Digital Video OPL" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(400,100,100,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Compressed Digital Audio OPL 
TestManagerCreateXMRLicenseFromPool(ROOT, LiveTVLicenses.xml, "Root license - Compressed Digital Audio OPL" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,100,150,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Uncompressed Digital Video OPL 
TestManagerCreateXMRLicenseFromPool(ROOT, LiveTVLicenses.xml, "Root license - Uncompressed Digital Video OPL" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,250,100,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Uncompressed Digital Audio OPL 
TestManagerCreateXMRLicenseFromPool(ROOT, LiveTVLicenses.xml, "Root license - Uncompressed Digital Audio OPL" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,100,100,150,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

If(DomainSupported)
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Analog Video OPL 
TestManagerCreateXMRLicenseFromPool(ROOT , LiveTVLicenses.xml, "Root license - Analog Video OPL", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,150,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Analog Video Extensions 
TestManagerCreateXMRLicenseFromPool(ROOT , LiveTVLicenses.xml, "Root license - Analog Video Extensions", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,150,100,100,0,1)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Compressed Digital Video OPL 
TestManagerCreateXMRLicenseFromPool(ROOT , LiveTVLicenses.xml, "Root license - Compressed Digital Video OPL", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(400,100,100,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Compressed Digital Audio OPL 
TestManagerCreateXMRLicenseFromPool(ROOT , LiveTVLicenses.xml, "Root license - Compressed Digital Audio OPL", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,100,150,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Uncompressed Digital Video OPL 
TestManagerCreateXMRLicenseFromPool(ROOT , LiveTVLicenses.xml, "Root license - Uncompressed Digital Video OPL", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,250,100,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Uncompressed Digital Audio OPL 
TestManagerCreateXMRLicenseFromPool(ROOT , LiveTVLicenses.xml, "Root license - Uncompressed Digital Audio OPL", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf 0" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,100,100,150,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

EndIf

' =================================================================================================
21598: SLS - Non-stateful restrictions in a leaf license with scalable license keys and a RemovalDate continue to work
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

' Device Bound - Analog Video OPL 
TestManagerCreateXMRLicenseFromPool(ROOT, LiveTVLicenses.xml, "Root with 1000 locations" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf license - Analog Video OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,150,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Analog Video Extensions 
TestManagerCreateXMRLicenseFromPool(ROOT, LiveTVLicenses.xml, "Root with 1000 locations" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf license - Analog Video Extensions" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,150,100,100,0,1)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Compressed Digital Video OPL 
TestManagerCreateXMRLicenseFromPool(ROOT, LiveTVLicenses.xml, "Root with 1000 locations" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf license - Compressed Digital Video OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(400,100,100,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Compressed Digital Audio OPL 
TestManagerCreateXMRLicenseFromPool(ROOT, LiveTVLicenses.xml, "Root with 1000 locations" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf license - Compressed Digital Audio OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,100,150,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Uncompressed Digital Video OPL 
TestManagerCreateXMRLicenseFromPool(ROOT, LiveTVLicenses.xml, "Root with 1000 locations" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf license - Uncompressed Digital Video OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,250,100,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Uncompressed Digital Audio OPL 
TestManagerCreateXMRLicenseFromPool(ROOT, LiveTVLicenses.xml, "Root with 1000 locations" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf license - Uncompressed Digital Audio OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,100,100,150,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

If(DomainSupported)
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Analog Video OPL 
TestManagerCreateXMRLicenseFromPool(ROOT , LiveTVLicenses.xml, "Root with 1000 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF , LiveTVLicenses.xml, "Leaf license - Analog Video OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,150,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Analog Video Extensions 
TestManagerCreateXMRLicenseFromPool(ROOT , LiveTVLicenses.xml, "Root with 1000 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF , LiveTVLicenses.xml, "Leaf license - Analog Video Extensions" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,150,100,100,0,1)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Compressed Digital Video OPL 
TestManagerCreateXMRLicenseFromPool(ROOT , LiveTVLicenses.xml, "Root with 1000 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF , LiveTVLicenses.xml, "Leaf license - Compressed Digital Video OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(400,100,100,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Compressed Digital Audio OPL 
TestManagerCreateXMRLicenseFromPool(ROOT , LiveTVLicenses.xml, "Root with 1000 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF , LiveTVLicenses.xml, "Leaf license - Compressed Digital Audio OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,100,150,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Uncompressed Digital Video OPL 
TestManagerCreateXMRLicenseFromPool(ROOT , LiveTVLicenses.xml, "Root with 1000 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF , LiveTVLicenses.xml, "Leaf license - Uncompressed Digital Video OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,250,100,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Uncompressed Digital Audio OPL 
TestManagerCreateXMRLicenseFromPool(ROOT , LiveTVLicenses.xml, "Root with 1000 locations", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF , LiveTVLicenses.xml, "Leaf license - Uncompressed Digital Audio OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,100,100,150,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

EndIf

' =================================================================================================
21599: SLS - Non-stateful restrictions in a root and leaf license with scalable license keys and a RemovalDate continue to work
TestManagerSetRights(Play)
TestManagerSetKID(!3x8NSroVg4eXCzWqPU!BA==)
TestManagerCleanLicenseStore(1)

' Device Bound - Analog Video OPL 
TestManagerCreateXMRLicenseFromPool(ROOT, LiveTVLicenses.xml, "Root license - Analog Video OPL" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf license - Analog Video OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,150,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Analog Video Extensions 
TestManagerCreateXMRLicenseFromPool(ROOT, LiveTVLicenses.xml, "Root license - Analog Video Extensions" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf license - Analog Video Extensions" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,150,100,100,0,1)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Compressed Digital Video OPL 
TestManagerCreateXMRLicenseFromPool(ROOT, LiveTVLicenses.xml, "Root license - Compressed Digital Video OPL" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf license - Compressed Digital Video OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(400,100,100,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Compressed Digital Audio OPL 
TestManagerCreateXMRLicenseFromPool(ROOT, LiveTVLicenses.xml, "Root license - Compressed Digital Audio OPL" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf license - Compressed Digital Audio OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,100,150,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Uncompressed Digital Video OPL 
TestManagerCreateXMRLicenseFromPool(ROOT, LiveTVLicenses.xml, "Root license - Uncompressed Digital Video OPL" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf license - Uncompressed Digital Video OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,250,100,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )

' Device Bound - Uncompressed Digital Audio OPL 
TestManagerCreateXMRLicenseFromPool(ROOT, LiveTVLicenses.xml, "Root license - Uncompressed Digital Audio OPL" )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf license - Uncompressed Digital Audio OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,100,100,150,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

If(DomainSupported)

TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Analog Video OPL 
TestManagerCreateXMRLicenseFromPool(ROOT, LiveTVLicenses.xml, "Root license - Analog Video OPL", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF, LiveTVLicenses.xml, "Leaf license - Analog Video OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,150,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Analog Video Extensions 
TestManagerCreateXMRLicenseFromPool(ROOT , LiveTVLicenses.xml, "Root license - Analog Video Extensions", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF , LiveTVLicenses.xml, "Leaf license - Analog Video Extensions" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,150,100,100,0,1)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Compressed Digital Video OPL 
TestManagerCreateXMRLicenseFromPool(ROOT , LiveTVLicenses.xml, "Root license - Compressed Digital Video OPL", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF , LiveTVLicenses.xml, "Leaf license - Compressed Digital Video OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(400,100,100,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Compressed Digital Audio OPL 
TestManagerCreateXMRLicenseFromPool(ROOT , LiveTVLicenses.xml, "Root license - Compressed Digital Audio OPL", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF , LiveTVLicenses.xml, "Leaf license - Compressed Digital Audio OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,100,150,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Uncompressed Digital Video OPL 
TestManagerCreateXMRLicenseFromPool(ROOT , LiveTVLicenses.xml, "Root license - Uncompressed Digital Video OPL", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF , LiveTVLicenses.xml, "Leaf license - Uncompressed Digital Video OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,250,100,100,100,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit
 
TestManagerReinitialize( Reset, TRUE )
TestManagerSetRights(Play,TRUE)
TestManagerSetKID( !3x8NSroVg4eXCzWqPU!BA== )
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )=0x02 ( DRM_S_MORE_DATA )

' Domain Bound - Uncompressed Digital Audio OPL 
TestManagerCreateXMRLicenseFromPool(ROOT , LiveTVLicenses.xml, "Root license - Uncompressed Digital Audio OPL", NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerCreateXMRLicenseFromPool(LEAF , LiveTVLicenses.xml, "Leaf license - Uncompressed Digital Audio OPL" )
TestManagerGenerateXMRResponse( LEAF, ROOT )
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestEnumLicense( !3x8NSroVg4eXCzWqPU!BA== ,XMR,1 )
TestManagerPrepareOPLCallback(100,100,100,100,150,0,0)

TestManagerBind(8 save decryptor into test variable, Dump, Decryptor1, CallBack)
TestManagerEncrypt( AES CipherType, 100 DataLengthToEncrypt )
TestSetupDecryptor(Decryptor1)
TestManagerInitDecrypt( NORMAL DecryptContext, NORMAL InitDecryptContext ) 
TestManagerDecrypt( NORMAL DecryptContext, 100 DataLengthToDecrypt, NORMAL pbData, 0 MisAlignmentBytes, NORMAL CounterModeCtx )
TestManagerCommit

EndIf

' =================================================================================================
21249: Verify licenses with RemovalDate have no secure store entry  -  Device Bound

' Simple with LID 
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE , LiveTVLicenses.xml, "Simple ExpirationDate with LID" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestVerifySecureStoreEntry( "SimpleExpirationDate72==" )

' Simple with 30s RemovalDate 
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE , LiveTVLicenses.xml, "Simple with RemovalDate of 30 seconds" )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestVerifySecureStoreEntry( "SimpleRemovalDate30sec==" ) =DRM_S_FALSE

' Root with 30s RemovalDate 
TestManagerCreateXMRLicenseFromPool( ROOT , LiveTVLicenses.xml, "Root with RemovalDate of 30 seconds" )
TestManagerGenerateXMRResponse( ROOT )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestVerifySecureStoreEntry( "RootRemovalDateOf30sec==" ) =DRM_S_FALSE

' Leaf with 30s RemovalDate 
TestManagerCreateXMRLicenseFromPool( LEAF , LiveTVLicenses.xml, "Leaf with RemovalDate of 30 seconds" )
TestManagerGenerateXMRResponse( LEAF )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestVerifySecureStoreEntry( "LeafRemovalDateOf30sec==" ) =DRM_S_FALSE

If(DomainSupported)
ProcessDomainJoinResponse( 0, DomainResponseForEmbeddingTest.dat )= DRM_S_MORE_DATA 

' Simple with LID 
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE , LiveTVLicenses.xml, "Simple ExpirationDate with LID" , NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestVerifySecureStoreEntry( "SimpleExpirationDate72==" )

' Simple with 30s RemovalDate 
TestManagerCreateXMRLicenseFromPool( SIMPLE_LICENSE , LiveTVLicenses.xml, "Simple with RemovalDate of 30 seconds" , NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerGenerateXMRResponse( SIMPLE_LICENSE )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestVerifySecureStoreEntry( "SimpleRemovalDate30sec==" ) =DRM_S_FALSE

' Root with 30s RemovalDate 
TestManagerCreateXMRLicenseFromPool( ROOT , LiveTVLicenses.xml, "Root with RemovalDate of 30 seconds" , NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerGenerateXMRResponse( ROOT )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestVerifySecureStoreEntry( "RootRemovalDateOf30sec==" ) =DRM_S_FALSE

' Leaf with 30s RemovalDate 
TestManagerCreateXMRLicenseFromPool( LEAF , LiveTVLicenses.xml, "Leaf with RemovalDate of 30 seconds" , NjU0MzIxMDk4NzY1NDMyMQ== )
TestManagerGenerateXMRResponse( LEAF )       
TestManagerProcessResponse( Dump, Dump, 0, 0 )
TestVerifySecureStoreEntry( "LeafRemovalDateOf30sec==" ) =DRM_S_FALSE

EndIf