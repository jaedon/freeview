' BVT test cases

1019: Successful initialization
Test_DRM_NDT_Initialize

1049: Sucessful initialization and uninitialization
Test_DRM_NDT_Initialize
Test_DRM_NDT_Uninitialize()

1548: Successful registration request/response
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()

1675: Registration, not revoked
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_SetRevocationList(WMDRMNET,files\\crl_wmdrmnd_5.b64)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()

1678: Registration, leaf-license revoked
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_SetRevocationList(WMDRMNET,files\\crl_wmdrmnd_8.b64)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()=0X8004C053(DRM_E_CERTIFICATE_REVOKED)

1681: Registration, Newer revocation list replaces old one
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_SetRevocationList(WMDRMNET,files\\crl_wmdrmnd_5.b64)
Test_SetRevocationList(WMDRMNET,files\\crl_wmdrmnd_8.b64)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()=0X8004C053(DRM_E_CERTIFICATE_REVOKED)

1684: Registration, non leaf-license revoked
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_SetRevocationList(WMDRMNET,files\\crl_wmdrmnd_6.b64)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()=0X8004C053(DRM_E_CERTIFICATE_REVOKED)

1481: Successful proximity
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)

1135: Successful open media session
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_Close()
EndIf


1139: Verify DRM status - license available
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_CheckASFFlags(NDTMGR_ASF_WMDRMPROTECTED, 1)
Test_CheckASFFlags(NDTMGR_ASF_LICENSE_PLAYAVAILABLE, 1)
Test_NDTMGR_ASF_Close()
EndIf


1145: Read to end
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_CheckASFFlags(NDTMGR_ASF_WMDRMPROTECTED, 1)
Test_CheckASFFlags(NDTMGR_ASF_LICENSE_PLAYAVAILABLE, 1)
Test_NDTMGR_ASF_ReadAllData(4096)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()
' Check that jazz1_output.wma matches jazz1.wma as is without any encryption or decryption.
EndIf


1158: Open media session without registering
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_Close()
EndIf


1224: Verify DRM status - unprotected content, no license available
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma)
Test_CheckASFFlags(NDTMGR_ASF_WMDRMPROTECTED, 0)
Test_CheckASFFlags(NDTMGR_ASF_LICENSE_PLAYAVAILABLE, 0)
Test_NDTMGR_ASF_Close()

1229: Open media session protected content when another session is already open
If(WMDRMSupported)
'Adding license for jazz1.wma
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
'Add license for jazz2.wma
TestManagerAddLicenseToResponse(7VUynQnO1kSIh5PA7asPfA==,{1CB8F9A7-AEA1-4B10-9A5C-BEB1B3D3F8D1},64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (machine.datetime > #20141125Z#)?(secstate.deleted=1;deletelicense();0):(!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)) && (machine.datetime <= #20141125Z#?1:(secstate.drmreason=1;0)))  ]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_Init(jazz2.wma, MUXED, jazz2_output.wma)
Test_NDTMGR_ASF_Close()
EndIf


1686: Get License
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_NDTMGR_ASF_Close()
EndIf


1692: Get license for unprotected content
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)=0x8004c013(DRM_E_LICENSENOTFOUND)
Test_NDTMGR_ASF_Close()

1724: Get License for content with high minimum security level
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 2000?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)=0x8004c013(DRM_E_LICENSENOTFOUND)
Test_NDTMGR_ASF_Close()
EndIf


1733: Verify Device Key
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_NDTMGR_ASF_Close()
Test_CheckDeviceKey(files\\DeviceRSAPubKey1.bin)
EndIf


1735: Verify SettingsObject
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_NDTMGR_ASF_Close()
Test_CheckSettingsObject(1)
EndIf


5026: Verify failure of NDTMGR_ASF_InitTranscryption called without registering device first
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=0X8004CE04(DRM_E_ND_INVALID_SESSION)
Test_NDTMGR_ASF_Close()=0X8004CE04(DRM_E_ND_INVALID_SESSION)
EndIf


1739: Verify Source ID
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS,"<INCLUSIONLIST><GUID>{00000507-0009-0010-8000-00AA006D2EA4}</GUID><GUID>{00000508-0009-0010-8000-00AA006D2EA5}</GUID></INCLUSIONLIST><SOURCEID>3</SOURCEID><ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_NDTMGR_ASF_Close()
Test_CheckSourceID(3)
EndIf


1742: Verify Inclusion List
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS,"<INCLUSIONLIST><GUID>{00000507-0009-0010-8000-00AA006D2EA4}</GUID><GUID>{00000508-0009-0010-8000-00AA006D2EA5}</GUID></INCLUSIONLIST><SOURCEID>3</SOURCEID><ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_NDTMGR_ASF_Close()
Test_CheckInclusionList({00000507-0009-0010-8000-00AA006D2EA4},{00000508-0009-0010-8000-00AA006D2EA5})
EndIf


1988: Verify Source ID in SAMPLES mode
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS,"<INCLUSIONLIST><GUID>{00000507-0009-0010-8000-00AA006D2EA4}</GUID><GUID>{00000508-0009-0010-8000-00AA006D2EA5}</GUID></INCLUSIONLIST><SOURCEID>3</SOURCEID><ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_CheckSourceID(3)
Test_NDTMGR_ASF_Close()
EndIf


1989: Verify Inclusion List in Samples Mode
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS,"<INCLUSIONLIST><GUID>{00000507-0009-0010-8000-00AA006D2EA4}</GUID><GUID>{00000508-0009-0010-8000-00AA006D2EA5}</GUID></INCLUSIONLIST><SOURCEID>3</SOURCEID><ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_CheckInclusionList({00000507-0009-0010-8000-00AA006D2EA4},{00000508-0009-0010-8000-00AA006D2EA5})
Test_NDTMGR_ASF_Close()
EndIf


1990: Call NDT_ASF_GetHeader sucessfully
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_GetHeader(jazz1.wma)
Test_NDTMGR_ASF_Close()
EndIf


5208: NDT_ASF_GetHeader called without calling NDTMGR_ASF_InitTranscryption first (Not a failure)
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_Close()
EndIf


1996: Call NDT_ASF_GetLeafLicenseResponse sucessfully
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_NDTMGR_ASF_Close()
EndIf


1558: Transfer file - do not get license, just transfer
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_CheckASFFlags(NDTMGR_ASF_WMDRMPROTECTED, 1)
Test_CheckASFFlags(NDTMGR_ASF_LICENSE_PLAYAVAILABLE, 1)
Test_GetHeaders()
Test_NDTMGR_ASF_ReadAllData(4096, jazz1.wma)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()
EndIf


1563: Get License Transfer file
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(4096)
Test_NDTMGR_ASF_Close()
EndIf


1573: Transfer file - clear content, no registration required
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma)
Test_NDTMGR_ASF_ReadAllData(4096)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()

1578: Transfer data after session is closed
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(4096)
Test_NDTMGR_ASF_Close()
Test_NDTMGR_ASF_ReadData(4096)=0X8004CE04(DRM_E_ND_INVALID_SESSION)
EndIf


1583: Transfer file protected content (play forever license)
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_GetHeaders()
Test_NDTMGR_ASF_ReadAllData(4096, jazz_clear.wma)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()
EndIf


1588: Transfer file protected content (play count license)
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[ secstate.PlayCount > 0  ]]></CONDITION><ACTION><![CDATA[ secstate.PlayCount--;(secstate.PlayCount <= 0)?(secstate.deleted=1;deletelicense();0):0  ]]></ACTION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT><ONSTORE><ACTION><![CDATA[ !exists(secstate.PlayCount)?secstate.PlayCount=5:0;!exists(secstate.BeginPlayCount)?secstate.BeginPlayCount=5:0;!exists(secstate.MinAppSecLevel)?secstate.MinAppSecLevel=150:0  ]]></ACTION></ONSTORE>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadAllData(4096)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()
EndIf


1593: Transfer file protected content (metered license)
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<MID>pIKx8Wsy5aYRQN8LLIIcTQ==</MID><ONACTION type=\"Play\"><CONDITION><![CDATA[ secstate.PlayCount > 0  ]]></CONDITION><ACTION><![CDATA[ secstate.PlayCount--;(secstate.PlayCount <= 0)?(secstate.deleted=1;deletelicense();0):0  ]]></ACTION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT><ONSTORE><ACTION><![CDATA[ !exists(secstate.PlayCount)?secstate.PlayCount=5:0;!exists(secstate.BeginPlayCount)?secstate.BeginPlayCount=5:0;!exists(secstate.MinAppSecLevel)?secstate.MinAppSecLevel=150:0  ]]></ACTION></ONSTORE>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadAllData(4096)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()
EndIf


1598: Transfer file protected content (OPL license)
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><RESTRICTIONS><ANALOGVIDEO level=\"200\"/></RESTRICTIONS><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>",7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadAllData(4096)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()
EndIf


1745: Transfer file and revalidate during the transfer
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(4096)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_ReadData(4096)
Test_NDTMGR_ASF_Close()
EndIf


1603: Transfer file clear content and verify not transcrypted
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma)
Test_GetHeaders()
Test_NDTMGR_ASF_ReadAllData(4096, jazz_clear.wma)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()

1608: Transfer file protected content and verify not transcrypted
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header2.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(7VUynQnO1kSIh5PA7asPfA==,{1CB8F9A7-AEA1-4B10-9A5C-BEB1B3D3F8D1}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (machine.datetime > #20141125Z#)?(secstate.deleted=1;deletelicense();0):(!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>",7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz2.wma, MUXED, jazz2_output.wma)
Test_NDTMGR_ASF_ReadAllData(4096)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()
' Check that jazz2_output.wma matches jazz2.wma as is without any encryption or decryption.
EndIf


1751: Transfer file and reregister during the transfer
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(4096)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_ASF_ReadData(131070)
Test_NDTMGR_ASF_Close()
' A decrypted Jazz1_output.wma should match jazz_clear.wma at this point.
EndIf


1764: Transfer file and reregister with different certificate during the transfer
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(4096)
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert2.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey2.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_ASF_ReadData(131070)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadAllData(4096)
Test_NDTMGR_ASF_Close()
' A decrypted Jazz1_output.wma should match jazz_clear.wma at this point.
EndIf


1773: Transfer file unprotected content and reregister during the transfer
Test_DRM_NDT_Initialize
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma)
Test_NDTMGR_ASF_ReadData(4096)
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_ReadData(131070)
Test_NDTMGR_ASF_Close()
' Check that jazz_clear_output.wma matches jazz_clear.wma as is without any encryption or decryption.

1777: Register with one certificate then register with another
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert2.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey2.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_GetHeaders()
Test_NDTMGR_ASF_ReadAllData(4096,jazz_clear_wma.asf,31)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()
' A decrypted Jazz1_output.wma should match jazz_clear.wma at this point.
EndIf


6034: Read data without calling NDTMGR_ASF_InitTranscryption first
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_ReadData(4096)
Test_NDTMGR_ASF_Close()
EndIf


1870: License with revocation check, not revoked
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_SetRevocationList(WMDRMNET,files\\crl_wmdrmnd_5.b64)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_Close()
EndIf


1872: License with revocation check, leaf-license revoked
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_SetRevocationList(WMDRMNET,files\\crl_wmdrmnd_8.b64)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)=0X8004C053(DRM_E_CERTIFICATE_REVOKED)
Test_NDTMGR_ASF_Close()
EndIf


1874: Newer revocation list replaces old one
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_SetRevocationList(WMDRMNET,files\\crl_wmdrmnd_5.b64)
Test_SetRevocationList(WMDRMNET,files\\crl_wmdrmnd_8.b64)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)=0X8004C053(DRM_E_CERTIFICATE_REVOKED)
Test_NDTMGR_ASF_Close()
EndIf


6200: Call NDTMGR_ASF_ReadSample successfully
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_ReadSample(8192, jazz_clear.wma)
Test_NDTMGR_ASF_Close()
EndIf


6201: Call NDTMGR_ASF_ReadSample and read to end successfully
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_ReadAllSamples(8192)
Test_NDTMGR_ASF_Close()
EndIf


6202: Call NDTMGR_ASF_ReadSample, seek forward, read sample, seek backward, and read sample
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(4500)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(0)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Close()
EndIf


6203: Call NDTMGR_ASF_ReadSample after seeking immediately
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_Seek(4500)
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Close()
EndIf


6312: Seek command immediately after license acquisition protected content
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_Seek(2000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Close()
EndIf


6320: Set current time position to middle of file unprotected content
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, SAMPLES, jazz_clear_output.wma)
Test_NDTMGR_ASF_GetHeader(jazz_clear.wma)
Test_NDTMGR_ASF_Seek(5000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_ReadSample(131070)
Test_NDTMGR_ASF_Close()

6321: Set current time position to middle of file protected content
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_NDTMGR_ASF_GetHeader(jazz1.wma)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(5000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_ReadSample(131070)
Test_NDTMGR_ASF_Close()
EndIf


6330: Set current time position to start of file protected content
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_NDTMGR_ASF_GetHeader(jazz1.wma)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(0)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Close()
EndIf


6331: Set current time position to start of file unprotected content
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, SAMPLES, jazz_clear_output.wma)
Test_NDTMGR_ASF_GetHeader(jazz_clear.wma)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(0)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Close()

6361: Jump current time position around a bit unprotected content
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, SAMPLES, jazz_clear_output.wma)
Test_NDTMGR_ASF_GetHeader(jazz_clear.wma)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(8000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Seek(5000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Seek(2000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Close()

1800: Set current time position to middle of file unprotected content
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma)
Test_NDTMGR_ASF_Seek(5000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_ReadData(131070)
Test_NDTMGR_ASF_Close()

1802: Set current time position to middle of file protected content
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(5000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_ReadData(131070)
Test_NDTMGR_ASF_Close()
EndIf


1804: Set current time position to start of file protected content
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(0)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Close()
EndIf


1806: Set current time position to start of file unprotected content
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(0)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Close()

1816: Jump current time position around a bit protected content
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(8000)
Test_NDTMGR_ASF_ReadData(8192)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Seek(5000)
Test_NDTMGR_ASF_ReadData(8192)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Seek(2000)
Test_NDTMGR_ASF_ReadData(8192)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Close()
EndIf


1818: Jump current time position around a bit unprotected content
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(8000)
Test_NDTMGR_ASF_ReadData(8192)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Seek(5000)
Test_NDTMGR_ASF_ReadData(8192)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Seek(2000)
Test_NDTMGR_ASF_ReadData(8192)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Close()

1820: Jump current time position around a bit protected content
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_Seek(8000)
Test_NDTMGR_ASF_Seek(5000)
Test_NDTMGR_ASF_Seek(2000)
Test_NDTMGR_ASF_ReadData(8192)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Close()
EndIf


1822: Jump current time position around a bit unprotected content
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma)
Test_NDTMGR_ASF_Seek(8000)
Test_NDTMGR_ASF_Seek(5000)
Test_NDTMGR_ASF_Seek(2000)
Test_NDTMGR_ASF_ReadData(8192)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Close()

1950: Call NDTMGR_ProcessLicenseChallenge successfully with SIMPLE license mode
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_NDTMGR_CloseSession(CONTENT)

1951: Call NDTMGR_ProcessLicenseChallenge successfully with CHAINED license mode
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_NDTMGR_CloseSession(CONTENT)

2065: Verify failure of NDTMGR_ProcessLicenseChallenge called without registering device first
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)=0X8004CE04(DRM_E_ND_INVALID_SESSION)

2066: Verify failure of NDTMGR_ProcessLicenseChallenge called without initiate session
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)=0X8004CE04(DRM_E_ND_INVALID_SESSION)

2029: Call NDTMGR_GetLeafLicenseResponse successfully
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_NDTMGR_GetLeafLicenseResponse()
Test_NDTMGR_CloseSession(CONTENT)

8401: test asf encrypt with null pointer input
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_SetCryptoDataNULL()
Test_NDTMGR_Encrypt_ASF( DeviceTestCert.crt, 0263516363427762, 0 )=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_CloseSession(CONTENT)

8600: Verify failure when ASF content has higher app security level than global min app security level
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 1000, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)=0x8004a004(DRM_E_DEVICE_SECURITY_LEVEL_TOO_LOW)
Test_NDTMGR_ASF_Close()
EndIf


8601: Verify failure when a higher app security level is set in Test_NDTMGR_GetLeafLicenseResponse  than global min ap security level set in NDTMGR_ProcessLicenseChallenge
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 150, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 1000, 0, 0)
Test_NDTMGR_GetLeafLicenseResponse()=0x8004a004(DRM_E_DEVICE_SECURITY_LEVEL_TOO_LOW)
Test_NDTMGR_ASF_Close()
EndIf


1470: Verify reading samples from multiple sessions
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)

TestManagerAddLicenseToResponse(Cab3lNlCjE+C+sjhTqC5ZA==,{E35DEAEA-CD39-4f9f-8B27-0B2E62906D8C}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION>",GwaZ58UTSek9yUUsriK8*pproW*bgn6bb9QS!2I52A62iJZiTUngWA==,C9kAEfarjbkdVR26QNN0H8M1D2dV1YKvzJboDis9)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, SAMPLES, jazz_clear_output.wma)
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_ReadSample(8192, jazz_clear.wma)
'
Test_SwitchMediaSession(1)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
'
Test_SwitchMediaSession(2)
Test_NDTMGR_ASF_Init(DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv, SAMPLES, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps_output.wmv)
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_ReadSample(131070, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
Test_NDTMGR_ASF_ReadSample(131070, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
'
Test_SwitchMediaSession(3)
Test_NDTMGR_ASF_Init(9TC1_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv, SAMPLES, 9TC1_523kbps_450kbpsVideo_64kbpsAudio_30fps_output.wmv)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_ReadSample(131070, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
Test_NDTMGR_ASF_ReadSample(131070, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
'
Test_SwitchMediaSession(1)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_ReadSample(8192, jazz_clear.wma)
Test_NDTMGR_ASF_Seek(4500)
Test_NDTMGR_ASF_ReadSample(8192, jazz_clear.wma)
Test_NDTMGR_ASF_Seek(0)
'
Test_SwitchMediaSession(0)
Test_NDTMGR_ASF_ReadSample(8192, jazz_clear.wma)
Test_NDTMGR_ASF_ReadSample(8192, jazz_clear.wma)
'
Test_SwitchMediaSession(1)
Test_NDTMGR_ASF_ReadSample(8192, jazz_clear.wma)
Test_NDTMGR_ASF_ReadSample(8192, jazz_clear.wma)
'
Test_SwitchMediaSession(2)
Test_NDTMGR_ASF_ReadSample(8192, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
Test_NDTMGR_ASF_ReadSample(8192, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
Test_NDTMGR_ASF_ReadSample(8192, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
'
Test_SwitchMediaSession(3)
Test_NDTMGR_ASF_ReadSample(131070, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
Test_NDTMGR_ASF_ReadSample(131070, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
'Test_NDTMGR_ASF_ReadSample(131070, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
'
Test_SwitchMediaSession(0)
Test_NDTMGR_ASF_Close()
'
Test_SwitchMediaSession(1)
Test_NDTMGR_ASF_Close()
'
Test_SwitchMediaSession(2)
Test_NDTMGR_ASF_Close()
'
Test_SwitchMediaSession(3)
Test_NDTMGR_ASF_Close()
EndIf


'''''''''''''''''''''''''''''''
'PMF file streaming test cases

'Non-WMA/WMV cases disabled as they are not supported
'9261: Transfer file protected V4 AAC PMF content
'Test_DRM_NDT_Initialize
'Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
'Test_SetCertificate(files\DeviceTestCert1.crt)
'Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
'Test_NDTMGR_CreateSession(REGISTRATION)
'Test_NDTMGR_ProcessRegistrationRequest()
'Test_Proximity(0)
'Test_NDTMGR_CloseSession(REGISTRATION)
'TestManagerAddXMRLicense(OWjhtr3u9k+rdo1ILY0rag==,RANDOM,XVBovsmzhP9gRIZxWfFta3VVRPzVEWmJsazEJ46I)
'TestManagerProcessResponse( Dump, Dump, 0, 0 )
'Test_NDTMGR_ASF_Init(jazz_aes_V4_aac.asf, MUXED, jazz_aes_V4_aac_output.asf)
'Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
'Test_GetHeaders()
'Test_NDTMGR_ASF_ReadAllData(4096)
'Test_CheckLastDataBlock()
'Test_NDTMGR_ASF_Close()

'9262: Transfer file protected V4 AAC Plus
'Test_DRM_NDT_Initialize
'Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
'Test_SetCertificate(files\DeviceTestCert1.crt)
'Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
'Test_NDTMGR_CreateSession(REGISTRATION)
'Test_NDTMGR_ProcessRegistrationRequest()
'Test_Proximity(0)
'Test_NDTMGR_CloseSession(REGISTRATION)
'TestManagerAddXMRLicense(OWjhtr3u9k+rdo1ILY0rag==,RANDOM,XVBovsmzhP9gRIZxWfFta3VVRPzVEWmJsazEJ46I)
'TestManagerProcessResponse( Dump, Dump, 0, 0 )
'Test_NDTMGR_ASF_Init(jazz_aes_V4_aacPlus.asf, MUXED, jazz_aes_V4_aacPlus_output.asf)
'Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
'Test_GetHeaders()
'Test_NDTMGR_ASF_ReadAllData(4096)
'Test_CheckLastDataBlock()
'Test_NDTMGR_ASF_Close()

'9263: Transfer file protected V4 H264 PMF content
'Test_DRM_NDT_Initialize
'Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
'Test_SetCertificate(files\DeviceTestCert1.crt)
'Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
'Test_NDTMGR_CreateSession(REGISTRATION)
'Test_NDTMGR_ProcessRegistrationRequest()
'Test_Proximity(0)
'Test_NDTMGR_CloseSession(REGISTRATION)
'TestManagerAddXMRLicense(OWjhtr3u9k+rdo1ILY0rag==,RANDOM,XVBovsmzhP9gRIZxWfFta3VVRPzVEWmJsazEJ46I)
'TestManagerProcessResponse( Dump, Dump, 0, 0 )
'Test_NDTMGR_ASF_Init(MD220x176_96_384s_aes_V4_h264.asf, MUXED, MD220x176_96_384s_aes_V4_h264_output.asf)
'Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
'Test_GetHeaders()
'Test_NDTMGR_ASF_ReadAllData(4096)
'Test_CheckLastDataBlock()
'Test_NDTMGR_ASF_Close()

1473: Transfer file protected V4 WMA PMF content
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
TestManagerAddXMRLicense(OWjhtr3u9k+rdo1ILY0rag==,RANDOM,XVBovsmzhP9gRIZxWfFta3VVRPzVEWmJsazEJ46I)
TestManagerProcessResponse( Dump, Dump, 0, 0 )
Test_NDTMGR_ASF_Init(jazz_aes_V4_wma.pya, MUXED, jazz_aes_V4_wma_output.asf)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_GetHeaders()
Test_NDTMGR_ASF_ReadAllData(4096,jazz_clear_wma.asf,31)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()

1468: Transfer file protected V4 WMA PMF content where the PlayReady object is in the EHO
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
TestManagerAddXMRLicense(OWjhtr3u9k+rdo1ILY0rag==,RANDOM,XVBovsmzhP9gRIZxWfFta3VVRPzVEWmJsazEJ46I)
TestManagerProcessResponse( Dump, Dump, 0, 0 )
Test_NDTMGR_ASF_Init(jazz_aes_V4_wma_proineho.pya, MUXED, jazz_aes_V4_wma_proineho_output.asf)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_GetHeaders()
Test_NDTMGR_ASF_ReadAllData(4096,jazz_clear_wma.asf,31)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()

1399: Transfer file protected V4 WMV PMF content
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
TestManagerAddXMRLicense(OWjhtr3u9k+rdo1ILY0rag==,RANDOM,XVBovsmzhP9gRIZxWfFta3VVRPzVEWmJsazEJ46I)
TestManagerProcessResponse( Dump, Dump, 0, 0 )
Test_NDTMGR_ASF_Init(MD220x176_96_384s_aes_V4_wmv.pyv, MUXED, MD220x176_96_384s_aes_V4_wmv_output.asf)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_GetHeaders()
Test_NDTMGR_ASF_ReadAllData(4096,MD220x176_96_384s_clear_wmv.asf,594)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()

1469: Transfer file protected V4 WMA PMF content - Sample mode
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
TestManagerAddXMRLicense(OWjhtr3u9k+rdo1ILY0rag==,RANDOM,XVBovsmzhP9gRIZxWfFta3VVRPzVEWmJsazEJ46I)
TestManagerProcessResponse( Dump, Dump, 0, 0 )
Test_NDTMGR_ASF_Init(jazz_aes_V4_wma.pya, SAMPLES, jazz_aes_V4_wma_output.asf)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_ReadAllSamples(131070,jazz_clear_wma.asf,31)
Test_NDTMGR_ASF_Close()

1462: Transfer file protected V4 WMV PMF content - Sample mode
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
TestManagerAddXMRLicense(OWjhtr3u9k+rdo1ILY0rag==,RANDOM,XVBovsmzhP9gRIZxWfFta3VVRPzVEWmJsazEJ46I)
TestManagerProcessResponse( Dump, Dump, 0, 0 )
Test_NDTMGR_ASF_Init(MD220x176_96_384s_aes_V4_wmv.pyv, SAMPLES, MD220x176_96_384s_aes_V4_wmv_output.asf)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_ReadAllSamples(131070,MD220x176_96_384s_clear_wmv.asf,594)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()

7050: Transfer file protected V4 WMA PMF content, SIMPLE license with only RemovalDate, expect success
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
TestManagerCreateXMRLicenseFromPool(SIMPLE, files\licenses.xml, "Simple license with 30s RemovalDate")
TestManagerGenerateXMRResponse(SIMPLE)
TestManagerProcessResponse( Dump, Dump, 0, 0 )
Test_NDTMGR_ASF_Init(jazz_aes_V4_wma.pya, MUXED, jazz_aes_V4_wma_output.asf)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_GetHeaders()
Test_NDTMGR_ASF_ReadAllData(4096,jazz_clear_wma.asf,31)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()

7051: Transfer file protected V4 WMA PMF content, CHAINED scalable license, expect failure
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
TestManagerCreateXMRLicenseFromPool(ROOT, files\licenses.xml, "PAIR A - Root with 1 location and 30s RemovalDate")
TestManagerCreateXMRLicenseFromPool(LEAF, files\licenses.xml, "PAIR A - Permanent Leaf 0")
TestManagerGenerateXMRResponse(ROOT, LEAF)
TestManagerProcessResponse( Dump, Dump, 0, 0 )
Test_NDTMGR_ASF_Init(jazz_aes_V4_wma.pya, MUXED, jazz_aes_V4_wma_output.asf)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)=DRM_E_LICENSENOTFOUND

-------------------BVT ends here--------------------------

' Extended test cases

1067: Uninitialization with NULL context
'Test_DRM_NDT_Initialize
Test_SetpNdtDrmContext(0)
Test_DRM_NDT_Uninitialize()

1352: initialize with NULL context
Test_SetpNdtDrmContext(0)
Test_DRM_NDT_Initialize=-2147024809(DRM_E_INVALIDARG)

1082: initialize with NULL device store name
Test_DRM_NDT_Initialize(NULL)=-2147024809(DRM_E_INVALIDARG)

1953: Successful Registration Session Creation
Test_DRM_NDT_Initialize
Test_NDTMGR_CreateSession(REGISTRATION)

1546: Successful Content Session Creation
Test_DRM_NDT_Initialize
Test_NDTMGR_CreateSession(CONTENT)

1102: Successful Registration Session Creation and Closing
Test_DRM_NDT_Initialize
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_CloseSession(REGISTRATION)

1103: Successful Content Session Creation and Closing
Test_DRM_NDT_Initialize
Test_NDTMGR_CreateSession(CONTENT)
Test_NDTMGR_CloseSession(CONTENT)

1097: Close Session with NULL context
Test_DRM_NDT_Initialize
Test_NDTMGR_CreateSession(CONTENT)
Test_SetpNdtDrmContext(0)
Test_NDTMGR_CloseSession(CONTENT)=-2147024809(DRM_E_INVALIDARG)


'''''''''''''''''''''''


1098: Registration request/response with NULL context
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetpNdtDrmContext(0)
Test_NDTMGR_ProcessRegistrationRequest()=-2147024809(DRM_E_INVALIDARG)

1114: Registration request/response with invalid certificate
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(invalid_cert.crt)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()=0x8004c035(DRM_E_INVALIDDEVICECERTIFICATE)

1120: Registration request/response with invalid request blob
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetpbRegistrationRequestMsgNULL
Test_NDTMGR_ProcessRegistrationRequest()=-2147024809(DRM_E_INVALIDARG)

1126: Registration request/response with bad private key
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(invalid_ansi_rsa_key.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()=0x8004c3f0(DRM_E_RSA_DECRYPTION_ERROR)

1131: Registration response with small buffer
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetcbRegistrationResponseMsg(1)
Test_NDTMGR_ProcessRegistrationRequest()=-2147024774(DRM_E_BUFFERTOOSMALL)

1651: Re-Registration
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_NDTMGR_ProcessRegistrationRequest()=0x8004c3ec(DRM_E_DEVICE_ALREADY_REGISTERED)

1653: NULL pointer for pbRegistrationResponseMsg
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetpbRegistrationResponseMsgNULL()
Test_NDTMGR_ProcessRegistrationRequest()=-2147024809(DRM_E_INVALIDARG)

1655: WmdrmNetValidateMessage with un-unpackable message type
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetcbRegistrationRequestMsg(1)
Test_NDTMGR_ProcessRegistrationRequest()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1657: WmdrmNetValidateMessage with un-unpackable serial number
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetcbRegistrationRequestMsg(3)
Test_NDTMGR_ProcessRegistrationRequest()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1659: WmdrmNetValidateMessage with un-unpackable certificate size
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetcbRegistrationRequestMsg(19)
Test_NDTMGR_ProcessRegistrationRequest()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1661: WmdrmNetValidateMessage with un-unpackable certificate
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetcbRegistrationRequestMsg(23)
Test_NDTMGR_ProcessRegistrationRequest()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1663: WmdrmNetValidateMessage with incorrect protocol version
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetMessageProtocolVersion(1)
Test_NDTMGR_ProcessRegistrationRequest()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1665: WmdrmNetValidateMessage with incorrect message type
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetMessageType(99)
Test_NDTMGR_ProcessRegistrationRequest()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1667: Registration with alternate certificate
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert2.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey2.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()

1669: Registration with mismatch certificate/private key 1
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey2.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()=0x8004c3f0(DRM_E_RSA_DECRYPTION_ERROR)

1671: Registration with mismatch certificate/private key 2
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert2.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()=0x8004c3f0(DRM_E_RSA_DECRYPTION_ERROR)

1673: Registration with zero length certificate
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_SetcbCertificate(1)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()=0x8004c035(DRM_E_INVALIDDEVICECERTIFICATE)


'''''''''''''''''''''''


1234: Proximity challenge with null context
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_SetpNdtDrmContext(0)
Test_NDTMGR_ProcessProximityStartMsg()=-2147024809(DRM_E_INVALIDARG)

1239: Proximity challenge with bad registration session id
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_SetRegistrationSessionID(00000000000000000000000000000000)
Test_NDTMGR_ProcessProximityStartMsg()=0X8004CE04(DRM_E_ND_INVALID_SESSION)

1244: Proximity challenge in improper sequence
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessProximityStartMsg()=0x8004a000(DRM_E_DEVICE_NOT_REGISTERED)

1251: Proximity fails because it took too long
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(100)=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)

1256: Proximity with bad nonce
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_SetChallengeID(0, 1, 2, 3)
Test_Proximity(0)=0x8004CE07(DRM_E_ND_INVALID_PROXIMITY_RESPONSE)
Test_Proximity(0)=0x8004CE07(DRM_E_ND_INVALID_PROXIMITY_RESPONSE)
Test_Proximity(0)=0x8004CE07(DRM_E_ND_INVALID_PROXIMITY_RESPONSE)

1515: Proximity Response with NULL context
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_NDTMGR_ProcessProximityStartMsg()
Test_SetpNdtDrmContext(0)
Test_NDTMGR_ProcessProximityResponseMsg()=-2147024809(DRM_E_INVALIDARG)

1519: Proximity Response with bad registration session id
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_NDTMGR_ProcessProximityStartMsg()
Test_SetRegistrationSessionID(00000000000000000000000000000000)
Test_NDTMGR_ProcessProximityResponseMsg()=0X8004CE04(DRM_E_ND_INVALID_SESSION)

1523: Proximity Response in improper sequence
Test_DRM_NDT_Initialize
Test_NDTMGR_ProcessProximityResponseMsg()=0X8004CE04(DRM_E_ND_INVALID_SESSION)

1485: Too much time between registration and proximity challenge
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_ChangeTimeMilliseconds(REGISTRATION_TIMEOUT)
Test_NDTMGR_ProcessProximityStartMsg()=0x8004a000(DRM_E_DEVICE_NOT_REGISTERED)

1493: Successful proximity challenge after ten initial failures
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_Proximity(0)

1498: Successful proximity challenge after a few "dropped messages"
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_NDTMGR_ProcessProximityStartMsg()
Test_NDTMGR_ProcessProximityStartMsg()
Test_NDTMGR_ProcessProximityStartMsg()
Test_NDTMGR_ProcessProximityStartMsg()
Test_Proximity(0)

1509: Proximity challenge just above cutoff threshold
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(PROXIMITY_TIMEOUT)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)

3017: NDTMGR_ProcessProximityStartMsg will small challenge buffer
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_SetTestProximityBUFFERTOOSMALL
Test_NDTMGR_ProcessProximityStartMsg()=-2147024774(DRM_E_BUFFERTOOSMALL)

3018: NDTMGR_ProcessProximityResponseMsg with small result message buffer
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_NDTMGR_ProcessProximityStartMsg()
Test_SetTestProximityBUFFERTOOSMALL
Test_NDTMGR_ProcessProximityResponseMsg()=-2147024774(DRM_E_BUFFERTOOSMALL)

3019: NDTMGR_ProcessProximityStartMsg with invalid proximity start message
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_SetProximityStartMsgNULL
Test_NDTMGR_ProcessProximityStartMsg()=-2147024809(DRM_E_INVALIDARG)

3020: NDTMGR_ProcessProximityResponseMsg with invalid proximity response message
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_NDTMGR_ProcessProximityStartMsg()
Test_SetProximityResponseMsgNULL
Test_NDTMGR_ProcessProximityResponseMsg()=-2147024809(DRM_E_INVALIDARG)

3021: Proximity with IPv4 address
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(192.168.100.1)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)

3022: Proximity with IPv6 address
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(2001:0DB8:0000:0000:0000:0000:1428:57ab/64)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)

3023: Proximity with short address
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(a)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)

3024: Proximity with long (128 byte) address
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(0123456789abcdef01234567890abcdef0123456789abcdef01234567890abcdef0123456789abcdef01234567890abcdef0123456789abcdef01234567890abcdef)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)

3025: Proximity with hostname address
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(www.microsoft.com)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)

3026: Proximity with MTP address
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)

3027: Registration with numbers of different devices (up to 20 devices)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(00000000000000000000000000000001)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000002)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000003)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000004)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000005)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000006)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000007)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000008)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000009)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000010)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000011)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000012)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000013)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000014)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000015)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000016)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000017)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000018)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000019)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetSerialNumber(00000000000000000000000000000020)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_SetProximityDetectionAddress(MTP)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)

3028: Multiple proximities with the same registration Session
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_Proximity(0)
Test_Proximity(0)

3029: Verify failure of NDTMGR_ProcessProximityResponseMsg when called in an invalid state
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_Proximity(0)
Test_Proximity(0)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004a000(DRM_E_DEVICE_NOT_REGISTERED)


'''''''''''''''''''''''


1152: Open media session with NULL context
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header2.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(7VUynQnO1kSIh5PA7asPfA==,{1CB8F9A7-AEA1-4B10-9A5C-BEB1B3D3F8D1}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (machine.datetime > #20141125Z#)?(secstate.deleted=1;deletelicense();0):(!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>",7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetpNdtDrmContext(0)
Test_NDTMGR_ASF_Init(jazz2.wma, MUXED, jazz2_output.wma)=-2147024809(DRM_E_INVALIDARG)
EndIf


1165: Open media session with invalid delivery mode
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header2.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(7VUynQnO1kSIh5PA7asPfA==,{1CB8F9A7-AEA1-4B10-9A5C-BEB1B3D3F8D1}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (machine.datetime > #20141125Z#)?(secstate.deleted=1;deletelicense();0):(!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>",7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz2.wma, INVALID_MODE, jazz2_output.wma)=-2147024809(DRM_E_INVALIDARG)
EndIf


1173: Open media session when another session is already open
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma)
EndIf


1180: Open media session with non-existent file
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(file_does_not_exist.wma, MUXED, file_does_not_exist_output.wma)=0x8003006E(DRM_E_FILEOPEN)

1187: Open media session when revalidation time has expired
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_ChangeTimeMilliseconds(VALIDATION_TIMEOUT)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)=0x8004CE00(DRM_E_ND_MUST_REVALIDATE)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
EndIf


1192: Close media session with NULL context
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_SetpNdtDrmContext(0)
Test_NDTMGR_ASF_Close()=-2147024809(DRM_E_INVALIDARG)
EndIf


1197: Close media session with invalid media session id
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_SetMediaSessionID(000102030405060708090a0b0c0d0e0f)
Test_NDTMGR_ASF_Close()=0X8004CE04(DRM_E_ND_INVALID_SESSION)
EndIf


1211: Open media session with NULL media session id
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetMediaSessionIDNULL
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)=-2147024809(DRM_E_INVALIDARG)
EndIf


1212: Open media session with NULL ASF Flags
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetASFFlagsNULL
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)=-2147024809(DRM_E_INVALIDARG)
EndIf


1215: Close media session without calling NDTMGR_ASF_Init first
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Close()=0X8004CE04(DRM_E_ND_INVALID_SESSION)

1218: ASF init with null string
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(, MUXED, null_output.wma)=-2147024809(DRM_E_INVALIDARG)

1221: ASF init with bad asf file
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(DeviceTestCert.crt, MUXED, bad_output.wma)=0x8004CF00(DRM_E_ASF_BAD_ASF_HEADER)


'''''''''''''''''''''''


1689: Process license request with NULL context
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_SetpNdtDrmContext(0)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_ASF_Close()=-2147024809(DRM_E_INVALIDARG)
EndIf


1695: License request with improper message
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_SetcbLicenseChallengeMsg(1)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=0x8004CE09(DRM_E_ND_BAD_REQUEST)
Test_NDTMGR_ASF_Close()
EndIf


1698: License request with bad media session id
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_SetMediaSessionID(000102030405060708090a0b0c0d0e0f)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=0X8004CE04(DRM_E_ND_INVALID_SESSION)
Test_NDTMGR_ASF_Close()=0X8004CE04(DRM_E_ND_INVALID_SESSION)
EndIf


1701: License request with bad serial number
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=0x8004a000(DRM_E_DEVICE_NOT_REGISTERED)
Test_NDTMGR_ASF_Close()
EndIf


1704: License request with non matching certificate
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_SetCertificate(invalid_cert.crt)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=0x8004a000(DRM_E_DEVICE_NOT_REGISTERED)
Test_NDTMGR_ASF_Close()
EndIf


1707: License request with case-sensitive action
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, PlAy)
Test_NDTMGR_ASF_Close()
EndIf


1711: License request with invalid action
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, NOTAREALACTION)=0x8004CE09(DRM_E_ND_BAD_REQUEST)
Test_NDTMGR_ASF_Close()
EndIf


1553: License response with small buffer
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_SetcbLicenseResponseMsg(1)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=-2147024774(DRM_E_BUFFERTOOSMALL)
Test_NDTMGR_ASF_Close()
EndIf


1718: License request when revalidation time has expired
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_ChangeTimeMilliseconds(VALIDATION_TIMEOUT)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=0x8004CE00(DRM_E_ND_MUST_REVALIDATE)
Test_NDTMGR_ASF_Close()
EndIf


1721: NULL pointer for pbLicenseResponseMsg
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_SetpbLicenseResponseMsgNULL()
Test_SetcbLicenseResponseMsg(0)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=-2147024774(DRM_E_BUFFERTOOSMALL)
Test_NDTMGR_ASF_Close()
EndIf


1727: Get License for content with OPL > 100
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><RESTRICTIONS><UNCOMPRESSEDDIGITALVIDEO level=\"125\"/><UNCOMPRESSEDDIGITALAUDIO level=\"125\"/></RESTRICTIONS><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>",7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_Close()
EndIf


1730: Get License for content with analog audio/video > 100
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><RESTRICTIONS><ANALOGVIDEO level=\"125\"/></RESTRICTIONS><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>",7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_Close()
EndIf


1737: Verify failure of NDTMGR_ASF_InitTranscryption with NULL p and cb != 0
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_SetpbLicenseResponseMsgNULL()
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_ASF_Close()
EndIf


5025: Verify failure of NDTMGR_ASF_InitTranscryption with NULL cb
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_SetcbLicenseResponseMsgNULL()
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_ASF_Close()
EndIf


5027: Verify failure of NDTMGR_ASF_InitTranscryption called without initiate session
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=0X8004CE04(DRM_E_ND_INVALID_SESSION)
Test_NDTMGR_ASF_Close()=0X8004CE04(DRM_E_ND_INVALID_SESSION)

5028: Verify failure of NDTMGR_ASF_InitTranscryption called without calling NDTMGR_ASF_Init first
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=0X8004CE04(DRM_E_ND_INVALID_SESSION)
Test_NDTMGR_ASF_Close()=0X8004CE04(DRM_E_ND_INVALID_SESSION)


5029:
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_SetMediaSessionID(000102030405060708090a0b0c0d0e0f)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=0X8004CE04(DRM_E_ND_INVALID_SESSION)
EndIf


1991: Call NDT_ASF_GetHeader with NULL context
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_SetpNdtDrmContext(0)
Test_NDTMGR_ASF_GetHeader=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_ASF_Close()=-2147024809(DRM_E_INVALIDARG)
EndIf


1992: Call NDT_ASF_GetHeader with NULL pbHeader
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_SetpbHeaderNULL
Test_NDTMGR_ASF_GetHeader=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_ASF_Close()
EndIf


1993: Call NDT_ASF_GetHeader with NULL pcbHeader
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_SetpcbHeaderNULL
Test_NDTMGR_ASF_GetHeader=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_ASF_Close()
EndIf


1994: Call NDT_ASF_GetHeader with invalid session id
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_SetMediaSessionID(000102030405060708090a0b0c0d0e0f)
Test_NDTMGR_ASF_GetHeader=0X8004CE04(DRM_E_ND_INVALID_SESSION)
Test_NDTMGR_ASF_Close()=0X8004CE04(DRM_E_ND_INVALID_SESSION)
EndIf


1995: Call NDT_ASF_GetHeader with small output buffer
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_SetcbHeader(1)
Test_NDTMGR_ASF_GetHeader=-2147024774(DRM_E_BUFFERTOOSMALL)
Test_NDTMGR_ASF_Close()
EndIf


5206: Verify failure of NDT_ASF_GetHeader called without initiate session
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_ASF_GetHeader=0X8004CE04(DRM_E_ND_INVALID_SESSION)

5207: Verify failure of NDT_ASF_GetHeader called without calling NDTMGR_ASF_Init first
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_GetHeader=0X8004CE04(DRM_E_ND_INVALID_SESSION)

5209: Call NDT_ASF_GetHeader in muxed mode
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_NDTMGR_ASF_GetHeader(jazz1.wma)=-2147467259(DRM_E_FAIL)
EndIf


5210: Call NDT_ASF_GetHeader without leaf
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_NDTMGR_ASF_GetHeader(jazz1.wma)=-2147467259(DRM_E_FAIL)
EndIf


5211: Call NDT_ASF_GetHeader after timeout
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_ChangeTimeMilliseconds(VALIDATION_TIMEOUT)
Test_NDTMGR_ASF_GetHeader(jazz1.wma)=0x8004CE00(DRM_E_ND_MUST_REVALIDATE)
EndIf


1997: Call NDT_ASF_GetLeafLicenseResponse with NULL context
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_SetpNdtDrmContext(0)
Test_NDTMGR_ASF_GetLeafLicenseResponse()=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_ASF_Close()=-2147024809(DRM_E_INVALIDARG)
EndIf


1998: Call NDT_ASF_GetLeafLicenseResponse with NULL pKID
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_SetpKIDNULL
Test_NDTMGR_ASF_GetLeafLicenseResponse()=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_ASF_Close()
EndIf


1999: Call NDT_ASF_GetLeafLicenseResponse with NULL pbLeafLicenseResponse
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_SetpbLeafLicenseResponseNULL
Test_NDTMGR_ASF_GetLeafLicenseResponse()=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_ASF_Close()
EndIf


5304: Call NDT_ASF_GetLeafLicenseResponse with NULL pcbLeafLicenseResponse
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_SetpcbLeafLicenseResponseNULL
Test_NDTMGR_ASF_GetLeafLicenseResponse()=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_ASF_Close()
EndIf


5305: Call NDT_ASF_GetLeafLicenseResponse with invalid session id
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_SetMediaSessionID(000102030405060708090a0b0c0d0e0f)
Test_NDTMGR_ASF_GetLeafLicenseResponse()=0X8004CE04(DRM_E_ND_INVALID_SESSION)
Test_NDTMGR_ASF_Close()=0X8004CE04(DRM_E_ND_INVALID_SESSION)
EndIf


5306: Call NDT_ASF_GetLeafLicenseResponse with small output buffer
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_SetcbLeafLicenseResponse(1)
Test_NDTMGR_ASF_GetLeafLicenseResponse()=-2147024774(DRM_E_BUFFERTOOSMALL)
Test_NDTMGR_ASF_Close()
EndIf


5307: Verify failure of NDT_ASF_GetLeafLicenseResponse called without registering device first
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ASF_GetLeafLicenseResponse()=0X8004CE04(DRM_E_ND_INVALID_SESSION)

5308: Verify failure of NDT_ASF_GetLeafLicenseResponse called without initiate session
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_ASF_GetLeafLicenseResponse()=0X8004CE04(DRM_E_ND_INVALID_SESSION)

5309: Verify failure of NDT_ASF_GetLeafLicenseResponse called without calling NDTMGR_ASF_Init first
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_GetLeafLicenseResponse()=0X8004CE04(DRM_E_ND_INVALID_SESSION)

5310: Verify failure of NDT_ASF_GetLeafLicenseResponse called without calling NDTMGR_ASF_InitTranscryption first
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_GetLeafLicenseResponse()=0x8004a000(DRM_E_DEVICE_NOT_REGISTERED)
Test_NDTMGR_ASF_Close()
EndIf


5311: Call NDT_ASF_GetLeafLicenseResponse with MUXED mode specified in NDTMGR_ASF_Init
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Close()
EndIf


'''''''''''''''''''''''


1568: Read data with bad media session id
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_SetMediaSessionID(000102030405060708090a0b0c0d0e0f)
Test_NDTMGR_ASF_ReadData(4096)=0X8004CE04(DRM_E_ND_INVALID_SESSION)
Test_NDTMGR_ASF_Close()=0X8004CE04(DRM_E_ND_INVALID_SESSION)
EndIf


1613: Transfer file protected content with tiny block size
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_GetHeaders()
Test_NDTMGR_ASF_ReadAllData(256, jazz_clear.wma, 31)
Test_NDTMGR_ASF_Close()
EndIf


1618: Transfer file clear content with tiny block size
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma)
Test_GetHeaders()
Test_NDTMGR_ASF_ReadAllData(256, jazz_clear.wma)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()

1748: Transfer file, let validation time out, revalidate, resume transfer
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(4096)
Test_ChangeTimeMilliseconds(VALIDATION_TIMEOUT)
Test_NDTMGR_ASF_ReadData(4096)=0x8004CE00(DRM_E_ND_MUST_REVALIDATE)
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_ASF_ReadData(131070)
Test_NDTMGR_ASF_Close()
EndIf


1754: Transfer file transcrypted content with large block size
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(131070)
Test_NDTMGR_ASF_ReadData(131070)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()
' A decrypted Jazz1_output.wma should match jazz_clear.wma at this point.
EndIf


1623: Transfer file protected but not transcrypted content with large block size
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header2.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(7VUynQnO1kSIh5PA7asPfA==,{1CB8F9A7-AEA1-4B10-9A5C-BEB1B3D3F8D1}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (machine.datetime > #20141125Z#)?(secstate.deleted=1;deletelicense();0):(!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>",7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz2.wma, MUXED, jazz2_output.wma)
Test_NDTMGR_ASF_ReadAllData(131070)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()
' Check that jazz2_output.wma matches jazz2.wma as is without any encryption or decryption.
EndIf


1628: Transfer file clear content with large block size
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma)
Test_NDTMGR_ASF_ReadAllData(131070)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()
' Check that jazz_clear_output.wma matches jazz_clear.wma as is without any encryption or decryption.

1632: Transfer file protected but not transcrypted content with tiny block size
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header2.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(7VUynQnO1kSIh5PA7asPfA==,{1CB8F9A7-AEA1-4B10-9A5C-BEB1B3D3F8D1}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (machine.datetime > #20141125Z#)?(secstate.deleted=1;deletelicense();0):(!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>",7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz2.wma, MUXED, jazz2_output.wma)
Test_NDTMGR_ASF_ReadAllData(256)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()
' Check that jazz2_output.wma matches jazz2.wma as is without any encryption or decryption.
EndIf


1757: Play count license fails after play count runs out
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[ secstate.PlayCount > 0  ]]></CONDITION><ACTION><![CDATA[ secstate.PlayCount--;(secstate.PlayCount <= 0)?(secstate.deleted=1;deletelicense();0):0  ]]></ACTION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT><ONSTORE><ACTION><![CDATA[ !exists(secstate.PlayCount)?secstate.PlayCount=5:0;!exists(secstate.BeginPlayCount)?secstate.BeginPlayCount=5:0;!exists(secstate.MinAppSecLevel)?secstate.MinAppSecLevel=150:0  ]]></ACTION></ONSTORE>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)

Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)

Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(4096)
Test_NDTMGR_ASF_Close()

Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(4096)
Test_NDTMGR_ASF_Close()

Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(4096)
Test_NDTMGR_ASF_Close()

Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(4096)
Test_NDTMGR_ASF_Close()

Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(4096)
Test_NDTMGR_ASF_Close()

Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)=0x8004c013(DRM_E_LICENSENOTFOUND)
Test_NDTMGR_ASF_ReadData(4096)=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Close()
EndIf


1760: Play count does not decrement when content is not played
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[ secstate.PlayCount > 0  ]]></CONDITION><ACTION><![CDATA[ secstate.PlayCount--;(secstate.PlayCount <= 0)?(secstate.deleted=1;deletelicense();0):0  ]]></ACTION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT><ONSTORE><ACTION><![CDATA[ !exists(secstate.PlayCount)?secstate.PlayCount=5:0;!exists(secstate.BeginPlayCount)?secstate.BeginPlayCount=5:0;!exists(secstate.MinAppSecLevel)?secstate.MinAppSecLevel=150:0  ]]></ACTION></ONSTORE>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_Close()
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_Close()
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_Close()
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_Close()
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_Close()
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_Close()
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_Close()
EndIf


1771: Attempt transfer after failed license
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header2.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(7VUynQnO1kSIh5PA7asPfA==,{1CB8F9A7-AEA1-4B10-9A5C-BEB1B3D3F8D1}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (machine.datetime > #20041125Z#)?(secstate.deleted=1;deletelicense();0):(!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>",7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz2.wma, MUXED, jazz2_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)=0x8004c013(DRM_E_LICENSENOTFOUND)
Test_NDTMGR_ASF_ReadData(4096)=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Close()
EndIf


1775: Transfer a different file after a failed license
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[ secstate.PlayCount > 0  ]]></CONDITION><ACTION><![CDATA[ secstate.PlayCount--;(secstate.PlayCount <= 0)?(secstate.deleted=1;deletelicense();0):0  ]]></ACTION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT><ONSTORE><ACTION><![CDATA[ !exists(secstate.PlayCount)?secstate.PlayCount=5:0;!exists(secstate.BeginPlayCount)?secstate.BeginPlayCount=5:0;!exists(secstate.MinAppSecLevel)?secstate.MinAppSecLevel=150:0  ]]></ACTION></ONSTORE>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz2.wma, MUXED, jazz2_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)=0x8004c013(DRM_E_LICENSENOTFOUND)
Test_NDTMGR_ASF_ReadData(4096)=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Close()
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_GetHeaders()
Test_NDTMGR_ASF_ReadAllData(4096, jazz_clear.wma)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()
' A decrypted Jazz1_output.wma should match jazz_clear.wma at this point.
EndIf


' Following test requires that jazz1.wma be used for this. A different file may produce incorrect result.
1636: Transfer file protected content with block size == exact file size
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_GetHeaders()
Test_NDTMGR_ASF_ReadData(65536)
Test_NDTMGR_ASF_ReadData(65536)
Test_NDTMGR_ASF_ReadData(57897)
Test_CheckLastDataBlock()
Test_NDTMGR_ASF_Close()
EndIf


1946: Read data with NULL context
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_SetpNdtDrmContext(0)
Test_NDTMGR_ASF_ReadData(4096)=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_ASF_Close()=-2147024809(DRM_E_INVALIDARG)
EndIf


1947: Read data with NULL pbData argument
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_SetpbDataNULL
Test_NDTMGR_ASF_ReadData(0)=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_ASF_Close()
EndIf


1948: Read data with NULL pcbData argument
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_SetpcbDataNULL
Test_NDTMGR_ASF_ReadData(4096)=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_ASF_Close()
EndIf


1949: Read data without calling NDTMGR_ASF_Init first
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_ReadData(4096)=0X8004CE04(DRM_E_ND_INVALID_SESSION)

6035: Read data with SAMPLES delivery mode specified
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(4096)=-2147467259(DRM_E_FAIL)
EndIf


6080: Transfer file protected content (OPL license, sample)
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><RESTRICTIONS><ANALOGVIDEO level=\"200\"/></RESTRICTIONS><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>",7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_NDTMGR_ASF_GetHeader(jazz1.wma)
Test_NDTMGR_ASF_Close()
EndIf


6081: Read data after close
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(4096)
Test_NDTMGR_ASF_Close()
Test_NDTMGR_ASF_ReadData(4096)=0X8004CE04(DRM_E_ND_INVALID_SESSION)
EndIf


2069: License with revocation check, not revoked SAMPLE MODE
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_SetRevocationList(WMDRMNET,files\\crl_wmdrmnd_5.b64)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_NDTMGR_ASF_GetHeader(jazz1.wma)
Test_NDTMGR_ASF_Close()
EndIf


2070: License with revocation check, leaf-license revoked SAMPLE MODE
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_SetRevocationList(WMDRMNET,files\\crl_wmdrmnd_8.b64)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)=0X8004C053(DRM_E_CERTIFICATE_REVOKED)
Test_NDTMGR_ASF_Close()
EndIf


2071: Newer revocation list replaces old one SAMPLE MODE
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_SetRevocationList(WMDRMNET,files\\crl_wmdrmnd_5.b64)
Test_SetRevocationList(WMDRMNET,files\\crl_wmdrmnd_8.b64)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)=0X8004C053(DRM_E_CERTIFICATE_REVOKED)
Test_NDTMGR_ASF_Close()
EndIf


2072: License with revocation check, non leaf-license revoked SAMPLE MODE
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_SetRevocationList(WMDRMNET,files\\crl_wmdrmnd_6.b64)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)=0X8004C053(DRM_E_CERTIFICATE_REVOKED)
Test_NDTMGR_ASF_Close()
EndIf


6204: Call NDTMGR_ASF_ReadSample, seek forward or reverse 10 times, and read sample
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_Seek(0)
Test_NDTMGR_ASF_Seek(1000)
Test_NDTMGR_ASF_Seek(8000)
Test_NDTMGR_ASF_Seek(5000)
Test_NDTMGR_ASF_Seek(3000)
Test_NDTMGR_ASF_Seek(4000)
Test_NDTMGR_ASF_Seek(6000)
Test_NDTMGR_ASF_Seek(7000)
Test_NDTMGR_ASF_Seek(2000)
Test_NDTMGR_ASF_Seek(9000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Close()
EndIf


6205: Call NDTMGR_ASF_ReadSample, mixed read and seek 20 times
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_Seek(0)
Test_NDTMGR_ASF_Seek(1000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(8000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(5000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(3000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(4000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(6000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(7000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(2000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(9000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(0)
Test_NDTMGR_ASF_Seek(1000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(8000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(5000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(3000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(4000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(6000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(7000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(2000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(9000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Close()
EndIf


6210: Call NDT_ASF_ReadSample with NULL context
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_SetpNdtDrmContext(0)
Test_NDTMGR_ASF_ReadSample()=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_ASF_Close()=-2147024809(DRM_E_INVALIDARG)
EndIf


6211: Call NDT_ASF_ReadSample with NULL pSampleInfo
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_SetpSampleInfoNULL
Test_NDTMGR_ASF_ReadSample()=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_ASF_Close()
EndIf


6212: Call NDT_ASF_ReadSample with NULL pbSampleData
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_SetpbSampleDataNULL
Test_SetpcbSampleDataNULL
Test_NDTMGR_ASF_ReadSample()=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_ASF_Close()
EndIf


6213: Call NDT_ASF_ReadSample with NULL pcbSampleData
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_SetpcbSampleDataNULL
Test_NDTMGR_ASF_ReadSample()=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_ASF_Close()
EndIf


6214: Call NDT_ASF_ReadSample with invalid session id
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_SetMediaSessionID(000102030405060708090a0b0c0d0e0f)
Test_NDTMGR_ASF_ReadSample()=0X8004CE04(DRM_E_ND_INVALID_SESSION)
Test_NDTMGR_ASF_Close()=0X8004CE04(DRM_E_ND_INVALID_SESSION)
EndIf


6215: Call NDT_ASF_ReadSample with small output buffer
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_NDTMGR_ASF_GetHeader
Test_SetcbSampleData(1)
Test_NDTMGR_ASF_ReadSample()=-2147024774(DRM_E_BUFFERTOOSMALL)
Test_NDTMGR_ASF_Close()
EndIf


6216: Verify failure of NDT_ASF_ReadSample called without calling NDTMGR_ASF_Init first
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_ReadSample()=0X8004CE04(DRM_E_ND_INVALID_SESSION)

6217: Call NDT_ASF_ReadSample without calling NDTMGR_ASF_InitTranscryption first (not a failure)
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Close()
EndIf


6218: Call NDT_ASF_ReadSample with MUXED mode specified in NDTMGR_ASF_Init
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_ReadSample()=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Close()
EndIf

6219: attempt seek for video
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,headerVideo.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(Cab3lNlCjE+C+sjhTqC5ZA==,{E35DEAEA-CD39-4f9f-8B27-0B2E62906D8C}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION>",GwaZ58UTSek9yUUsriK8*pproW*bgn6bb9QS!2I52A62iJZiTUngWA==,C9kAEfarjbkdVR26QNN0H8M1D2dV1YKvzJboDis9)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(9TC1_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv, SAMPLES, 9TC1_523kbps_450kbpsVideo_64kbpsAudio_30fps_output.wmv)
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(4500)=-2147467263
EndIf


6220: Call NDTMGR_ASF_ReadSample after validation timeout
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_ReadSample(8192, jazz_clear.wma)
Test_ChangeTimeMilliseconds(VALIDATION_TIMEOUT)
Test_NDTMGR_ASF_ReadSample(8192, jazz_clear.wma)=0x8004CE00(DRM_E_ND_MUST_REVALIDATE)
Test_NDTMGR_ASF_Close()
EndIf


6221: Call NDTMGR_ASF_ReadSample before leaf
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadSample(8192, jazz_clear.wma)=-2147467259(DRM_E_FAIL)
EndIf


6340: Set current time position 1 second protected content
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_NDTMGR_ASF_GetHeader(jazz1.wma)
Test_NDTMGR_ASF_Seek(1000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Close()
EndIf


6341: Set current time position 1 second unprotected content
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, SAMPLES, jazz_clear_output.wma)
Test_NDTMGR_ASF_GetHeader(jazz_clear.wma)
Test_NDTMGR_ASF_Seek(1000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Close()

6350: Set current time position 1 second from end of file protected content
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_NDTMGR_ASF_GetHeader(jazz1.wma)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(10000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Close()
EndIf


6351: Set current time position 1 second from end of file unprotected content
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, SAMPLES, jazz_clear_output.wma)
Test_NDTMGR_ASF_GetHeader(jazz_clear.wma)
Test_NDTMGR_ASF_Seek(10000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Close()

6360: Jump current time position around a bit protected content
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_NDTMGR_ASF_GetHeader(jazz1.wma)
Test_NDTMGR_ASF_ReadSample(8192)
Test_NDTMGR_ASF_Seek(8000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Seek(5000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Seek(2000)
Test_NDTMGR_ASF_ReadSample(8192)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_NDTMGR_ASF_Close()
EndIf


1779: Check Decryption of a single packet
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_GetHeaders()
Test_NDTMGR_ASF_ReadData(12000, jazz_clear.wma)
Test_NDTMGR_ASF_Close()
EndIf


1780: Check Decryption of all packets
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_GetHeaders()
Test_NDTMGR_ASF_ReadAllData(5986, jazz_clear.wma, 31)
Test_NDTMGR_ASF_Close()
EndIf



'''''''''''''''''''''''


'NOTE: jazz1.wma must be used for the seeking tests
1781: Set current time position protected content
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(4500)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Close()
EndIf


1784: Set current time position with NULL context
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(8192)
Test_SetpNdtDrmContext(0)
Test_NDTMGR_ASF_Seek(2000)=-2147024809(DRM_E_INVALIDARG)
Test_NDTMGR_ASF_Close()=-2147024809(DRM_E_INVALIDARG)
EndIf


1786: Set current time position with invalid media session id
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(8192)
Test_SetMediaSessionID(000102030405060708090a0b0c0d0e0f)
Test_NDTMGR_ASF_Seek(2000)=0X8004CE04(DRM_E_ND_INVALID_SESSION)
Test_NDTMGR_ASF_Close()=0X8004CE04(DRM_E_ND_INVALID_SESSION)
EndIf


1788: Set current time position before session is open
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Seek(200000)=0X8004CE04(DRM_E_ND_INVALID_SESSION)
Test_NDTMGR_ASF_Close()=0X8004CE04(DRM_E_ND_INVALID_SESSION)

1790: Set current time position after session is closed
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Close()
Test_NDTMGR_ASF_Seek(200000)=0X8004CE04(DRM_E_ND_INVALID_SESSION)

1952: Set current time position without calling NDTMGR_ASF_InitTranscryption first
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_Seek(4500)
Test_NDTMGR_ASF_Close()
EndIf


1792: Seek command immediately after open media session unprotected content
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma)
Test_NDTMGR_ASF_Seek(2000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Close()

1794: Seek command immediately after open media session protected content
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_Seek(2000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Close()
EndIf


1796: Seek command immediately after license acquisition protected content
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_Seek(2000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Close()
EndIf


1798: Seek command before license acquisition and then acquire license
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_Seek(2000)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Close()
EndIf


1808: Set current time position 1 second protected content
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_Seek(1000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Close()
EndIf


1810: Set current time position 1 second unprotected content
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma)
Test_NDTMGR_ASF_Seek(1000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Close()

1812: Set current time position 1 second from end of file protected content
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(10000)
Test_NDTMGR_ASF_ReadData(2048)
Test_NDTMGR_ASF_Close()
EndIf


1814: Set current time position 1 second from end of file unprotected content
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma)
Test_NDTMGR_ASF_Seek(10000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Close()

1824: Set current time position past end of file protected content
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(200000)=0x8004CE0A(DRM_E_ND_FAILED_SEEK)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Close()
EndIf


1826: Set current time position past end of file unprotected content
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(200000)=0x8004CE0A(DRM_E_ND_FAILED_SEEK)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Close()

1828: Set current time position to an arbitrarily large value
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(4000000000)=0x8004CE0A(DRM_E_ND_FAILED_SEEK)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Close()

1829: Set current time position to exact end of file
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(10415)
Test_NDTMGR_ASF_ReadData(8196)
Test_NDTMGR_ASF_Close()
EndIf


7110: Call NDTMGR_ASF_ReadData, seek forward or reverse 10 times, and read sample
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_Seek(0)
Test_NDTMGR_ASF_Seek(1000)
Test_NDTMGR_ASF_Seek(8000)
Test_NDTMGR_ASF_Seek(5000)
Test_NDTMGR_ASF_Seek(3000)
Test_NDTMGR_ASF_Seek(4000)
Test_NDTMGR_ASF_Seek(6000)
Test_NDTMGR_ASF_Seek(7000)
Test_NDTMGR_ASF_Seek(2000)
Test_NDTMGR_ASF_Seek(9000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Close()
EndIf


7111: Call NDTMGR_ASF_ReadData, mixed read and seek 20 times
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_Seek(0)
Test_NDTMGR_ASF_Seek(1000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(8000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(5000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(3000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(4000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(6000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(7000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(2000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(9000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(0)
Test_NDTMGR_ASF_Seek(1000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(8000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(5000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(3000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(4000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(6000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(7000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(2000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Seek(9000)
Test_NDTMGR_ASF_ReadData(8192)
Test_NDTMGR_ASF_Close()
EndIf


'''''''''''''''''''''''


2026: Call NDTMGR_ProcessLicenseChallenge successfully with minimum security level of 150
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 150, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_NDTMGR_CloseSession(CONTENT)

2045: Call NDTMGR_ProcessLicenseChallenge successfully with minimum app revocation list version of 1
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 1, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_NDTMGR_CloseSession(CONTENT)

2046: Call NDTMGR_ProcessLicenseChallenge successfully with minimum app revocation list version of 2
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 2, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_NDTMGR_CloseSession(CONTENT)

2047: Call NDTMGR_ProcessLicenseChallenge successfully with minimum app revocation list version of 5
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 5, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_NDTMGR_CloseSession(CONTENT)

1955: Call NDTMGR_ProcessLicenseChallenge successfully with minimum app revocation list version of 8
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 8, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_NDTMGR_CloseSession(CONTENT)

1956: Call NDTMGR_ProcessLicenseChallenge successfully with minimum app revocation list version of 10
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 10, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_NDTMGR_CloseSession(CONTENT)

1957: Call NDTMGR_ProcessLicenseChallenge successfully with minimum device revocation list version of 1
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 1)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_NDTMGR_CloseSession(CONTENT)

1958: Call NDTMGR_ProcessLicenseChallenge successfully with minimum device revocation list version of 2
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 2)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_NDTMGR_CloseSession(CONTENT)

1959: Call NDTMGR_ProcessLicenseChallenge successfully with minimum device revocation list version of 5
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 5)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_NDTMGR_CloseSession(CONTENT)

1960: Call NDTMGR_ProcessLicenseChallenge successfully with minimum device revocation list version of 8
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 8)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_NDTMGR_CloseSession(CONTENT)

1961: Call NDTMGR_ProcessLicenseChallenge successfully with minimum device revocation list version of 10
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 10)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_NDTMGR_CloseSession(CONTENT)

1962: Call NDTMGR_ProcessLicenseChallenge successfully with long license challenge message
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_NDTMGR_CloseSession(CONTENT)

1963: Call NDTMGR_ProcessLicenseChallenge successfully with short license challenge message
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_NDTMGR_CloseSession(CONTENT)

1964: Call NDTMGR_ProcessLicenseChallenge unsuccessfully because of time out
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 150, 0, 0)
Test_ChangeTimeMilliseconds(VALIDATION_TIMEOUT)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)=0x8004CE00(DRM_E_ND_MUST_REVALIDATE)
Test_NDTMGR_CloseSession(CONTENT)

1965: Call NDTMGR_ProcessLicenseChallenge with non matching certificate
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 150, 0, 0)
Test_SetCertificate(invalid_cert.crt)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)=0x8004a000(DRM_E_DEVICE_NOT_REGISTERED)
Test_NDTMGR_CloseSession(CONTENT)

1966: Call NDTMGR_GetLeafLicenseResponse unsuccessfully because of time out
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, SAMPLES, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_ChangeTimeMilliseconds(VALIDATION_TIMEOUT)
Test_NDTMGR_ASF_GetLeafLicenseResponse()=0x8004CE00(DRM_E_ND_MUST_REVALIDATE)
Test_NDTMGR_ASF_Close()
EndIf


2027: Verify failure of NDTMGR_ProcessLicenseChallenge called with NULL context
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetpNdtDrmContext(0)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)=-2147024809(DRM_E_INVALIDARG)

2028: Verify failure of NDTMGR_ProcessLicenseChallenge called with NULL pPolicy
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)=-2147024809(DRM_E_INVALIDARG)

2059: Verify failure of NDTMGR_ProcessLicenseChallenge called with NULL pKID
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetpKIDNULL()
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)=-2147024809(DRM_E_INVALIDARG)

2060: Verify failure of NDTMGR_ProcessLicenseChallenge called with NULL pbLicenseResponseMsg
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetpbLicenseResponseMsgNULL()
Test_SetcbLicenseResponseMsgNULL()
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)=-2147024809(DRM_E_INVALIDARG)

2061: Verify failure of NDTMGR_ProcessLicenseChallenge called with NULL pcbLicenseResponseMsg
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetcbLicenseResponseMsgNULL()
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)=-2147024809(DRM_E_INVALIDARG)

2062: Verify failure of NDTMGR_ProcessLicenseChallenge called with invalid license challenge message
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetcbLicenseChallengeMsg(1)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)=0x8004CE09(DRM_E_ND_BAD_REQUEST)

2063: Verify failure of NDTMGR_ProcessLicenseChallenge called with invalid license mode
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, INVALID_MODE)=-2147024809(DRM_E_INVALIDARG)

81070: Verify failure of NDTMGR_ProcessLicenseChallenge called with invalid policy
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_SetWMDRMNETPolicy(INVALID_TYPE, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)=-2147024809(DRM_E_INVALIDARG)

2064: Verify failure of NDTMGR_ProcessLicenseChallenge called with small buffer
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetcbLicenseResponseMsg(1)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)=-2147024774(DRM_E_BUFFERTOOSMALL)

2030: Call NDTMGR_GetLeafLicenseResponse successfully with minimum security level of 150
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 150, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_NDTMGR_GetLeafLicenseResponse()
Test_NDTMGR_CloseSession(CONTENT)

2031: Call NDTMGR_GetLeafLicenseResponse successfully with minimum app revocation list version of 1
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 1, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_NDTMGR_GetLeafLicenseResponse()
Test_NDTMGR_CloseSession(CONTENT)

2032: Call NDTMGR_GetLeafLicenseResponse successfully with minimum app revocation list version of 2
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 2, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_NDTMGR_GetLeafLicenseResponse()
Test_NDTMGR_CloseSession(CONTENT)

8207: Call NDTMGR_GetLeafLicenseResponse successfully with minimum app revocation list version of 5
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 5, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_NDTMGR_GetLeafLicenseResponse()
Test_NDTMGR_CloseSession(CONTENT)

8208: Call NDTMGR_GetLeafLicenseResponse successfully with minimum app revocation list version of 8
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 8, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_NDTMGR_GetLeafLicenseResponse()
Test_NDTMGR_CloseSession(CONTENT)

8209: Call NDTMGR_GetLeafLicenseResponse successfully with minimum app revocation list version of 10
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 10, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_NDTMGR_GetLeafLicenseResponse()
Test_NDTMGR_CloseSession(CONTENT)

8210: Call NDTMGR_GetLeafLicenseResponse successfully with minimum device revocation list version of 1
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 1)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_NDTMGR_GetLeafLicenseResponse()
Test_NDTMGR_CloseSession(CONTENT)

8211: Call NDTMGR_GetLeafLicenseResponse successfully with minimum device revocation list version of 2
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 2)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_NDTMGR_GetLeafLicenseResponse()
Test_NDTMGR_CloseSession(CONTENT)

8212: Call NDTMGR_GetLeafLicenseResponse successfully with minimum device revocation list version of 5
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 5)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_NDTMGR_GetLeafLicenseResponse()
Test_NDTMGR_CloseSession(CONTENT)

8213: Call NDTMGR_GetLeafLicenseResponse successfully with minimum device revocation list version of 8
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 8)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_NDTMGR_GetLeafLicenseResponse()
Test_NDTMGR_CloseSession(CONTENT)

8214: Call NDTMGR_GetLeafLicenseResponse successfully with minimum device revocation list version of 10
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 10)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_NDTMGR_GetLeafLicenseResponse()
Test_NDTMGR_CloseSession(CONTENT)

8215: Call NDTMGR_GetLeafLicenseResponse unsuccessfully with minimum security level of 1
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 1, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_NDTMGR_GetLeafLicenseResponse()
Test_NDTMGR_CloseSession(CONTENT)

2033: Verify failure of NDTMGR_GetLeafLicenseResponse called with NULL context
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_SetpNdtDrmContext(0)
Test_NDTMGR_GetLeafLicenseResponse()=-2147024809(DRM_E_INVALIDARG)

2034: Verify failure of NDTMGR_GetLeafLicenseResponse called with NULL pPolicy
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_SetWMDRMNETPolicy
Test_NDTMGR_GetLeafLicenseResponse()=-2147024809(DRM_E_INVALIDARG)

2035: Verify failure of NDTMGR_GetLeafLicenseResponse called with NULL pKID
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_SetpKIDNULL()
Test_NDTMGR_GetLeafLicenseResponse()=-2147024809(DRM_E_INVALIDARG)

2036: Verify failure of NDTMGR_GetLeafLicenseResponse called with NULL pbLeafLicenseResponse
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_SetpbLeafLicenseResponseNULL()
Test_NDTMGR_GetLeafLicenseResponse()=-2147024809(DRM_E_INVALIDARG)

2037: Verify failure of NDTMGR_GetLeafLicenseResponse called with NULL pcbLeafLicenseResponse
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_SetpcbLeafLicenseResponseNULL()
Test_NDTMGR_GetLeafLicenseResponse()=-2147024809(DRM_E_INVALIDARG)

2038: Verify failure of NDTMGR_GetLeafLicenseResponse called with invalid session id
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_SetMediaSessionID(000102030405060708090a0b0c0d0e0f)
Test_NDTMGR_GetLeafLicenseResponse()=0X8004CE04(DRM_E_ND_INVALID_SESSION)

2039: Verify failure of NDTMGR_GetLeafLicenseResponse called with invalid policy
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_SetWMDRMNETPolicy(INVALID_TYPE, 100, 0, 0)
Test_NDTMGR_GetLeafLicenseResponse()=-2147024809(DRM_E_INVALIDARG)

8307: Verify failure of NDTMGR_GetLeafLicenseResponse called with small buffer
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)
Test_SetcbLeafLicenseResponse(1)
Test_NDTMGR_GetLeafLicenseResponse()=-2147024774(DRM_E_BUFFERTOOSMALL)

8308: Verify failure of NDTMGR_GetLeafLicenseResponse called without registering device first
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, CHAINED)=0x8004a000(DRM_E_DEVICE_NOT_REGISTERED)
Test_NDTMGR_GetLeafLicenseResponse()=0x8004a000(DRM_E_DEVICE_NOT_REGISTERED)

8309: Verify failure of NDTMGR_GetLeafLicenseResponse called without initiate session
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_GetLeafLicenseResponse()=0X8004CE04(DRM_E_ND_INVALID_SESSION)

8310: Verify failure of NDTMGR_GetLeafLicenseResponse called when in SIMPLE license mode
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_NDTMGR_GetLeafLicenseResponse()=-2147467259(DRM_E_FAIL)

8400: link encryption mp3
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_LinkEncryption(jazz_clear.mp3, jazz_encrypted.3le, 1024);
Test_NDTMGR_CloseSession(CONTENT)

8402: test asf encrypt with null pointer input
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_SetpNdtDrmContext(0)
Test_NDTMGR_Encrypt_ASF( files\\DeviceTestCert1.crt, 0263516363427762, 0 )=-2147024809(DRM_E_INVALIDARG)

8403: test asf encrypt with invalid session id
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_SetMediaSessionID(000102030405060708090a0b0c0d0e0f)
Test_NDTMGR_Encrypt_ASF( files\\DeviceTestCert1.crt, 0263516363427762, 0 )=0X8004CE04(DRM_E_ND_INVALID_SESSION)

8404: test asf encrypt with invalid encryption mode
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_SetEncryptionMode(500)
Test_NDTMGR_Encrypt_ASF( files\\DeviceTestCert1.crt, 0263516363427762, 0 )=-2147024809(DRM_E_INVALIDARG)

8405: test asf encrypt with invalid session id
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(CONTENT)
Test_NDTMGR_Encrypt_ASF( files\\DeviceTestCert1.crt, 0263516363427762, 0 )=0X8004CE04(DRM_E_ND_INVALID_SESSION)

8406: test asf encryption
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_NDTMGR_Encrypt_ASF( files\\DeviceTestCert1.crt, 0263516363427762, 0 )
Test_NDTMGR_CloseSession(CONTENT)

8407: link encryption mp3 with no block id
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_LinkEncryption(jazz_clear.mp3, jazz_encrypted.3le, 1024, 1);
Test_NDTMGR_CloseSession(CONTENT)

8408: link encryption mp3 with no block id and no encryption
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_LinkEncryption(jazz_clear.mp3, jazz_encrypted.3le, 1024, 1, 1);
Test_NDTMGR_CloseSession(CONTENT)

8500: test mpeg encryption
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_CreateSession(CONTENT)
Test_SetWMDRMNETPolicy(TRANSCRYPTPLAY, 100, 0, 0)
Test_NDTMGR_ProcessLicenseChallenge(08544947f9b8c4b47ad6aaca3d39e7c2, Play, SIMPLE)
Test_NDTMGR_Encrypt_MPEG( files\\DeviceTestCert1.crt, 0263516363427762, 0 )
Test_NDTMGR_CloseSession(CONTENT)


''''''''''''''''''''''''''''''''


1876: Verify MUXED Mode WMV, Clear
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv, MUXED, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps_output.wmv)
Test_GetHeaders()
Test_NDTMGR_ASF_ReadData(52000, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
Test_NDTMGR_ASF_Close()

2055: Verify MUXED Mode WMV, DRM
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,headerVideo.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(Cab3lNlCjE+C+sjhTqC5ZA==,{E35DEAEA-CD39-4f9f-8B27-0B2E62906D8C}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION>",GwaZ58UTSek9yUUsriK8*pproW*bgn6bb9QS!2I52A62iJZiTUngWA==,C9kAEfarjbkdVR26QNN0H8M1D2dV1YKvzJboDis9)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(9TC1_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv, MUXED, 9TC1_523kbps_450kbpsVideo_64kbpsAudio_30fps_output.wmv)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_GetHeaders()
Test_NDTMGR_ASF_ReadData(12000, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
Test_NDTMGR_ASF_Close()
EndIf


2057: Verify MUXED Mode WMV, VBR
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(PD320x420_32kbps.wmv, MUXED, PD320x420_32kbps_output.wmv)
Test_GetHeaders()
Test_NDTMGR_ASF_ReadData(12000, PD320x420_32kbps.wmv  )
Test_NDTMGR_ASF_Close()


9013: Verify MUXED Mode WMV DRM, Read to end
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,headerVideo.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(Cab3lNlCjE+C+sjhTqC5ZA==,{E35DEAEA-CD39-4f9f-8B27-0B2E62906D8C}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION>",GwaZ58UTSek9yUUsriK8*pproW*bgn6bb9QS!2I52A62iJZiTUngWA==,C9kAEfarjbkdVR26QNN0H8M1D2dV1YKvzJboDis9)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(9TC1_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv, MUXED, 9TC1_523kbps_450kbpsVideo_64kbpsAudio_30fps_output.wmv)
Test_NDTMGR_ASF_InitTranscryption(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_GetHeaders()
Test_NDTMGR_ASF_ReadAllData(131070, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv, 4996)
Test_NDTMGR_ASF_Close()
EndIf


9100: Verify SAMPLES Mode WMV, Clear
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv, SAMPLES, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps_output.wmv)
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_ReadSample(8192, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
Test_NDTMGR_ASF_ReadSample(8192, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
Test_NDTMGR_ASF_ReadSample(8192, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
Test_NDTMGR_ASF_ReadSample(8192, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
Test_NDTMGR_ASF_ReadSample(8192, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
Test_NDTMGR_ASF_Close()

9101: Verify SAMPLES Mode WMV, DRM
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,headerVideo.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(Cab3lNlCjE+C+sjhTqC5ZA==,{E35DEAEA-CD39-4f9f-8B27-0B2E62906D8C}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION>",GwaZ58UTSek9yUUsriK8*pproW*bgn6bb9QS!2I52A62iJZiTUngWA==,C9kAEfarjbkdVR26QNN0H8M1D2dV1YKvzJboDis9)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(9TC1_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv, SAMPLES, 9TC1_523kbps_450kbpsVideo_64kbpsAudio_30fps_output.wmv)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_ReadSample(131070, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
Test_NDTMGR_ASF_ReadSample(131070, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
Test_NDTMGR_ASF_ReadSample(131070, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
Test_NDTMGR_ASF_ReadSample(131070, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
'Test_NDTMGR_ASF_ReadSample(131070, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv)
Test_NDTMGR_ASF_Close()
EndIf


1542: Verify SAMPLES Mode WMV, VBR
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(PD320x420_32kbps.wmv, SAMPLES, PD320x420_32kbps_output.wmv)
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_ReadSample(8192, PD320x420_32kbps.wmv)
Test_NDTMGR_ASF_ReadSample(8192, PD320x420_32kbps.wmv)
Test_NDTMGR_ASF_ReadSample(8192, PD320x420_32kbps.wmv)
Test_NDTMGR_ASF_ReadSample(8192, PD320x420_32kbps.wmv)
Test_NDTMGR_ASF_ReadSample(8192, PD320x420_32kbps.wmv)
Test_NDTMGR_ASF_Close()


1541: Verify SAMPLES Mode WMV DRM, Read to End
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,headerVideo.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(Cab3lNlCjE+C+sjhTqC5ZA==,{E35DEAEA-CD39-4f9f-8B27-0B2E62906D8C}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION>",GwaZ58UTSek9yUUsriK8*pproW*bgn6bb9QS!2I52A62iJZiTUngWA==,C9kAEfarjbkdVR26QNN0H8M1D2dV1YKvzJboDis9)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(9TC1_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv, SAMPLES, 9TC1_523kbps_450kbpsVideo_64kbpsAudio_30fps_output.wmv)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_GetLeafLicenseResponse()
Test_NDTMGR_ASF_GetHeader
Test_NDTMGR_ASF_ReadAllSamples(131070, DotNetCommercial_523kbps_450kbpsVideo_64kbpsAudio_30fps.wmv, 4996)
Test_NDTMGR_ASF_Close()
EndIf


9200: Revocation list request with wmdrm revocation list
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_WmdrmNetPackRevocationListRequestMessage({cd75e604-543d-4a9c-9f09-fe6d24e8bf90})
Test_NDTMGR_ProcessRevocationListRequest()

1392: Revocation list request with all types
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_WmdrmNetPackRevocationListRequestMessage({90a37313-0ecf-4caa-a906-b188f6129300},{3129e375-ceb0-47d5-9cca-9db74cfd4332},{cd75e604-543d-4a9c-9f09-fe6d24e8bf90},{ccde5a55-a688-4405-a88b-d13f90d5ba3e})
Test_NDTMGR_ProcessRevocationListRequest()

1385: Revocation list request with no types
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_WmdrmNetPackRevocationListRequestMessage
Test_NDTMGR_ProcessRevocationListRequest

1386: GetRevocationListRequest wmdrmnd type
Test_DRM_NDT_Initialize
Test_SwitchNdtContexts(1)
Test_DRM_NDT_Initialize(secondstore.hds)
Test_NDTMGR_GetRevocationListRequest(NET)
Test_SwitchNdtContexts(0)
Test_NDTMGR_ProcessRevocationListRequest()
Test_SwitchNdtContexts(1)
Test_NDTMGR_ProcessRevocationListResponse()

1388: GetRevocationListRequest all types
Test_DRM_NDT_Initialize
Test_SwitchNdtContexts(1)
Test_DRM_NDT_Initialize(secondstore.hds)
Test_NDTMGR_GetRevocationListRequest(ALL)
Test_SwitchNdtContexts(0)
Test_NDTMGR_ProcessRevocationListRequest()
Test_SwitchNdtContexts(1)
Test_NDTMGR_ProcessRevocationListResponse()

1430: ProcessRevocationListRequest with small buffer
Test_DRM_NDT_Initialize
Test_WmdrmNetPackRevocationListRequestMessage({90a37313-0ecf-4caa-a906-b188f6129300})
Test_SetNoHandleBufferTooSmall(1)
Test_NDTMGR_ProcessRevocationListRequest()=-2147024774(DRM_E_BUFFERTOOSMALL)
Test_CheckcbRevocationListResponse(22)

1390: Revocation request for existing device CRL
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_SetRevocationList(WMDRMNET,files\\crl_wmdrmnd_5.b64)
Test_InitializeRevocationListResponse(1)
Test_AddRevocationListToResponse(2, files\\crl_wmdrmnd_5.b64_wchar)
Test_WmdrmNetPackRevocationListResponseMessage()
Test_DumpRevocationListResponse()
Test_WmdrmNetPackRevocationListRequestMessage({cd75e604-543d-4a9c-9f09-fe6d24e8bf90})
Test_NDTMGR_ProcessRevocationListRequest()
Test_VerifyRevocationListResponse()

1471: Request for a non-available CRL and match the response with the behavior
Test_DRM_NDT_Initialize
Test_InitializeRevocationListResponse(0)
Test_WmdrmNetPackRevocationListRequestMessage({cd75e604-543d-4a9c-9f09-fe6d24e8bf90})
Test_NDTMGR_ProcessRevocationListRequest()
Test_VerifyRevocationListResponse()

1393: improper crl request message
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_SetMessageProtocolVersion(1)
Test_WmdrmNetPackRevocationListRequestMessage({cd75e604-543d-4a9c-9f09-fe6d24e8bf90})
Test_NDTMGR_ProcessRevocationListRequest()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1432: Update of revocation lists with non-revoked device and registration
Test_DRM_NDT_Initialize
Test_SetRevocationList(WMDRMNET,files\\crl_wmdrmnd_5.b64)
Test_SwitchNdtContexts(1)
Test_DRM_NDT_Initialize(secondstore.hds)
Test_NDTMGR_GetRevocationListRequest(NET)
Test_SwitchNdtContexts(0)
Test_NDTMGR_ProcessRevocationListRequest()
Test_SwitchNdtContexts(1)
Test_NDTMGR_ProcessRevocationListResponse()
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()

1434: RIV info of transmitter lesser than receiving transmitter
Test_DRM_NDT_Initialize
Test_SetRevocationList(WMDRMNET, files\\crl_wmdrmnd_5.b64)
Test_SetRevocationList(RIV, files\rlvi_1_wmdrmnd_5.b64.signed_wchar)
Test_CheckRivSequenceNumber(1)
Test_SwitchNdtContexts(1)
Test_DRM_NDT_Initialize(secondstore.hds)
Test_SetRevocationList(WMDRMNET, files\\crl_wmdrmnd_8.b64)
Test_SetRevocationList(RIV, files\rlvi_7_wmdrmnd_8.b64.signed_wchar)
Test_CheckRivSequenceNumber(7)
Test_NDTMGR_GetRevocationListRequest(RIV)
Test_SwitchNdtContexts(0)
Test_NDTMGR_ProcessRevocationListRequest()
Test_SwitchNdtContexts(1)
Test_NDTMGR_ProcessRevocationListResponse()
Test_CheckRivSequenceNumber(7)

9213: Revocation list request with NULL context
Test_DRM_NDT_Initialize
Test_SetpNdtDrmContext(0)
Test_NDTMGR_ProcessRevocationListRequest()=-2147024809(DRM_E_INVALIDARG)

1435: Revocation list request with request blob
Test_DRM_NDT_Initialize
Test_NDTMGR_ProcessRevocationListRequest()=-2147024809(DRM_E_INVALIDARG)

1436: Revocation list request with null response size address
Test_DRM_NDT_Initialize
Test_WmdrmNetPackRevocationListRequestMessage({cd75e604-543d-4a9c-9f09-fe6d24e8bf90})
Test_SetpcbRevocationListResponse(0)
Test_NDTMGR_ProcessRevocationListRequest()=-2147024809(DRM_E_INVALIDARG)

1437: Revocation list request with null response blob and non-zero response size
Test_DRM_NDT_Initialize
Test_SetcbRevocationListResponse(1024)
Test_NDTMGR_ProcessRevocationListRequest()=-2147024809(DRM_E_INVALIDARG)

1438: Revocation list request unable to unpack message version
Test_DRM_NDT_Initialize
Test_WmdrmNetPackRevocationListRequestMessage({cd75e604-543d-4a9c-9f09-fe6d24e8bf90})
Test_SetcbRevocationListRequest(0)
Test_NDTMGR_ProcessRevocationListRequest()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1439: Revocation list request unable to unpack message type
Test_DRM_NDT_Initialize
Test_WmdrmNetPackRevocationListRequestMessage({cd75e604-543d-4a9c-9f09-fe6d24e8bf90})
Test_SetcbRevocationListRequest(1)
Test_NDTMGR_ProcessRevocationListRequest()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1450: Revocation list request message too small
Test_DRM_NDT_Initialize
Test_WmdrmNetPackRevocationListRequestMessage({cd75e604-543d-4a9c-9f09-fe6d24e8bf90})
Test_SetcbRevocationListRequest(2)
Test_NDTMGR_ProcessRevocationListRequest()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1452: revocation list request invalid message version
Test_DRM_NDT_Initialize
Test_WmdrmNetPackRevocationListRequestMessage({cd75e604-543d-4a9c-9f09-fe6d24e8bf90})
Test_SetMessageProtocolVersion(1)
Test_NDTMGR_ProcessRevocationListRequest()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1458: revocation list request invalid message type
Test_DRM_NDT_Initialize
Test_WmdrmNetPackRevocationListRequestMessage({cd75e604-543d-4a9c-9f09-fe6d24e8bf90})
Test_SetMessageType(99)
Test_NDTMGR_ProcessRevocationListRequest()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1396: revocation list request unable to unpack guids
Test_DRM_NDT_Initialize
Test_WmdrmNetPackRevocationListRequestMessage({cd75e604-543d-4a9c-9f09-fe6d24e8bf90})
Test_SetcbRevocationListRequest(11)
Test_NDTMGR_ProcessRevocationListRequest()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1398: revocation list request, response buffer too small
Test_DRM_NDT_Initialize
Test_WmdrmNetPackRevocationListRequestMessage({cd75e604-543d-4a9c-9f09-fe6d24e8bf90})
Test_SetNoHandleBufferTooSmall(1)
Test_NDTMGR_ProcessRevocationListRequest()=-2147024774(DRM_E_BUFFERTOOSMALL)

1454: Request with bad guid
Test_DRM_NDT_Initialize
Test_WmdrmNetPackRevocationListRequestMessage({abcdef01-543d-4a9c-9f09-fe6d24e8bf90})
Test_NDTMGR_ProcessRevocationListRequest()=-2147024809(DRM_E_INVALIDARG)

9226: Get revocation list request with null context
Test_DRM_NDT_Initialize
Test_SetpNdtDrmContext(0)
Test_NDTMGR_GetRevocationListRequest(RIV)=-2147024809(DRM_E_INVALIDARG)

1403: Get revocation list request buffer too small
Test_DRM_NDT_Initialize
Test_SetNoHandleBufferTooSmall(1)
Test_NDTMGR_GetRevocationListRequest(RIV)=-2147024774(DRM_E_BUFFERTOOSMALL)

1429: get revocation list request null message size address
Test_DRM_NDT_Initialize
Test_SetpcbRevocationListRequest(0)
Test_NDTMGR_GetRevocationListRequest(RIV)=-2147024809(DRM_E_INVALIDARG)

1416: get revocation list request null message blob and non-zero message size
Test_DRM_NDT_Initialize
Test_SetcbRevocationListRequest(1024)
Test_NDTMGR_GetRevocationListRequest(RIV)=-2147024809(DRM_E_INVALIDARG)

1455: get revocation list request invalid enumerant
Test_DRM_NDT_Initialize
Test_NDTMGR_GetRevocationListRequest(500)=-2147024809(DRM_E_INVALIDARG)

1456: process revocation list response with null context
Test_DRM_NDT_Initialize
Test_SetpNdtDrmContext(0)
Test_NDTMGR_ProcessRevocationListResponse()=-2147024809(DRM_E_INVALIDARG)

1457: process revocation list response unable to unpack version
Test_DRM_NDT_Initialize
Test_InitializeRevocationListResponse(0)
Test_WmdrmNetPackRevocationListResponseMessage()
Test_SetcbRevocationListResponse(0)
Test_NDTMGR_ProcessRevocationListResponse()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1431: process revocation list response unable to unpack message type
Test_DRM_NDT_Initialize
Test_InitializeRevocationListResponse(0)
Test_WmdrmNetPackRevocationListResponseMessage()
Test_SetcbRevocationListResponse(1)
Test_NDTMGR_ProcessRevocationListResponse()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1433: process revocation list response invalid protocol version
Test_DRM_NDT_Initialize
Test_InitializeRevocationListResponse(0)
Test_WmdrmNetPackRevocationListResponseMessage()
Test_SetMessageProtocolVersion(1)
Test_NDTMGR_ProcessRevocationListResponse()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1387: process revocation list response invalid message type
Test_DRM_NDT_Initialize
Test_InitializeRevocationListResponse(0)
Test_WmdrmNetPackRevocationListResponseMessage()
Test_SetMessageType(99)
Test_NDTMGR_ProcessRevocationListResponse()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1459: process revocation list response unable to unpack guid
Test_DRM_NDT_Initialize
Test_InitializeRevocationListResponse(1)
Test_AddRevocationListToResponse(2, files\\crl_wmdrmnd_5.b64_wchar)
Test_WmdrmNetPackRevocationListResponseMessage()
Test_SetcbRevocationListResponse(10)
Test_NDTMGR_ProcessRevocationListResponse()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1460: process revocation list response unable to unpack crl size
Test_DRM_NDT_Initialize
Test_InitializeRevocationListResponse(1)
Test_AddRevocationListToResponse(2, files\\crl_wmdrmnd_5.b64_wchar)
Test_WmdrmNetPackRevocationListResponseMessage()
Test_SetcbRevocationListResponse(20)
Test_NDTMGR_ProcessRevocationListResponse()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1389: process revocation list response unable to unpack crl
Test_DRM_NDT_Initialize
Test_InitializeRevocationListResponse(1)
Test_AddRevocationListToResponse(2, files\\crl_wmdrmnd_5.b64_wchar)
Test_WmdrmNetPackRevocationListResponseMessage()
Test_SetcbRevocationListResponse(22)
Test_NDTMGR_ProcessRevocationListResponse()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1461: Requesting the same revocation list guid multiple times
Test_DRM_NDT_Initialize
Test_SetRevocationList(WMDRMNET,files\\crl_wmdrmnd_5.b64)
Test_WmdrmNetPackRevocationListRequestMessage({cd75e604-543d-4a9c-9f09-fe6d24e8bf90}, {cd75e604-543d-4a9c-9f09-fe6d24e8bf90}, {cd75e604-543d-4a9c-9f09-fe6d24e8bf90})
Test_NDTMGR_ProcessRevocationListRequest()
Test_DumpRevocationListResponse()

1464: zero-length revocation lists
Test_DRM_NDT_Initialize
Test_InitializeRevocationListResponse(1)
Test_AddRevocationListToResponse(2, files\\empty.b64_wchar)
Test_WmdrmNetPackRevocationListResponseMessage()
Test_DumpRevocationListResponse()
Test_NDTMGR_ProcessRevocationListResponse()

1465: response with bad guid
Test_DRM_NDT_Initialize
Test_InitializeRevocationListResponse(1)
Test_AddRevocationListToResponse({00000000-0000-0000-0000-000000000000}, files\rlvi_7_wmdrmnd_8.b64.signed_wchar)
Test_WmdrmNetPackRevocationListResponseMessage()
Test_DumpRevocationListResponse()
Test_NDTMGR_ProcessRevocationListResponse()

1466: truncated response
Test_DRM_NDT_Initialize
Test_InitializeRevocationListResponse(1)
Test_AddRevocationListToResponse(2, files\\crl_wmdrmnd_5.b64_wchar)
Test_WmdrmNetPackRevocationListResponseMessage()
Test_DumpRevocationListResponse()
Test_SetcbRevocationListResponse(256)
Test_NDTMGR_ProcessRevocationListResponse()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1467: truncated request before guid
Test_DRM_NDT_Initialize
Test_WmdrmNetPackRevocationListRequestMessage({cd75e604-543d-4a9c-9f09-fe6d24e8bf90})
Test_SetcbRevocationListRequest(3)
Test_NDTMGR_ProcessRevocationListRequest()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1391: truncated request in middle of guid
Test_DRM_NDT_Initialize
Test_WmdrmNetPackRevocationListRequestMessage({cd75e604-543d-4a9c-9f09-fe6d24e8bf90})
Test_SetcbRevocationListRequest(10)
Test_NDTMGR_ProcessRevocationListRequest()=0x8004CE09(DRM_E_ND_BAD_REQUEST)

1451: extra bytes in request at end
Test_DRM_NDT_Initialize
Test_WmdrmNetPackRevocationListRequestMessage({cd75e604-543d-4a9c-9f09-fe6d24e8bf90})
Test_SetcbRevocationListRequest(19)
Test_NDTMGR_ProcessRevocationListRequest()

1453: Revocation list request with duplicate RIV
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(DeviceTestCert.crt)
Test_WmdrmNetPackRevocationListRequestMessage({90a37313-0ecf-4caa-a906-b188f6129300},{3129e375-ceb0-47d5-9cca-9db74cfd4332},{cd75e604-543d-4a9c-9f09-fe6d24e8bf90},{ccde5a55-a688-4405-a88b-d13f90d5ba3e},{ccde5a55-a688-4405-a88b-d13f90d5ba3e})
Test_NDTMGR_ProcessRevocationListRequest()

1395: process revocation list response with no revocation lists
Test_DRM_NDT_Initialize
Test_InitializeRevocationListResponse(0)
Test_WmdrmNetPackRevocationListResponseMessage()
Test_NDTMGR_ProcessRevocationListResponse()

1397: process revocation list response with no revocation lists
Test_DRM_NDT_Initialize
Test_InitializeRevocationListResponse(1)
Test_AddRevocationListToResponse({ccde5a55-a688-4405-a88b-d13f90d5ba3e}, invalid_cert.crt)
Test_WmdrmNetPackRevocationListResponseMessage()
Test_NDTMGR_ProcessRevocationListResponse()=-2147024809(DRM_E_INVALIDARG)

9260: RIV in license
If(WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<REVINFOVERSION>1</REVINFOVERSION><ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey1.bin)
Test_SetRevocationList(WMDRMNET, files\\crl_wmdrmnd_5.b64)
Test_SetRevocationList(RIV, files\rlvi_1_wmdrmnd_5.b64.signed_wchar)
Test_CheckRivSequenceNumber(1)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz1.wma, MUXED, jazz1_output.wma)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_CheckRivInLicense(1)
EndIf


1489: Proximity challenge which is just under cut off time
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert2.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey2.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)


1496: ten proximity challenge failures due to >7ms delay between challenge and response
Test_DRM_NDT_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\\DeviceTestCert2.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey2.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)
Test_NDTMGR_ProcessProximityStartMsg()
Test_ChangeTimeMilliseconds(15)
Test_NDTMGR_ProcessProximityResponseMsg()=0x8004CE06(DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY)


1290: unprotected content, encrypt it
Test_DRM_NDT_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\\DeviceTestCert2.crt)
Test_SetPrivateKeyDirectly(files\\DeviceRSAPrivKey2.bin)
Test_NDTMGR_CreateSession(REGISTRATION)
Test_NDTMGR_ProcessRegistrationRequest()
Test_Proximity(0)
Test_NDTMGR_CloseSession(REGISTRATION)
Test_NDTMGR_ASF_Init(jazz_clear.wma, MUXED, jazz_clear_output.wma, TRUE)
Test_NDTMGR_ASF_InitTranscryption(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_NDTMGR_ASF_ReadAllData(4096)
Test_NDTMGR_ASF_Close()

------------------- Metering BVT Begins here--------------------------

'Valid MAS prikey: lVvvpn!q4bMJi!BosMpAPZ9IERg=

1292:DRM_Manager_GenerateMeterChallenge and DRM_Manager_ProcessMeterResponse: with valid parameters should work
If(WMDRMSupported)
TestDRM_Manager_Initialize()
TestDRM_Manager_AddMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_Manager_GenerateMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", "pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
EndIf


1287:MGR_MTR_GenerateMeteringChallenge returns no data.
If(WMDRMSupported)
TestDRM_Manager_Initialize()
TestDRM_Manager_GenerateMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=")
EndIf


1288:MGR_MTR_GenerateMeteringChallenge returns proper MIDs metering data.
If(WMDRMSupported)
TestDRM_Manager_Initialize()
TestDRM_Manager_AddMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_Manager_AddMeteringData("EXchRPpxP2YvGZR1d1OKKA==", "37HRLgAfR0G4fVSEAeR2lw==", "Copy", "3")
TestDRM_Manager_GenerateMeterChallenge(files\\metercert2.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", "EXchRPpxP2YvGZR1d1OKKA==", "37HRLgAfR0G4fVSEAeR2lw==", "Copy", "3")
TestDRM_Manager_GenerateMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", "pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
EndIf


1289:MGR_MTR_GenerateMeteringChallenge returns multiple actions
If(WMDRMSupported)
TestDRM_Manager_Initialize()
TestDRM_Manager_AddMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_Manager_AddMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Copy", "3")
TestDRM_Manager_GenerateMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", "pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2", "27HRLgAfR0G4fVSEAeR2lw==", "Copy", "3")
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
EndIf


1286:MGR_MTR_ProcessMeteringResponse clears data
If(WMDRMSupported)
TestDRM_Manager_Initialize()
TestDRM_Manager_AddMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_Manager_GenerateMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", "pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GenerateMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=")
EndIf


11577:MGR_MTR_GenerateMeteringChallenge returns multiple KIDs
If(WMDRMSupported)
TestDRM_Manager_Initialize()
TestDRM_Manager_AddMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_Manager_AddMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", "37HRLgAfR0G4fVSEAeR2lw==", "Copy", "3")
TestDRM_Manager_GenerateMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", "pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2", "37HRLgAfR0G4fVSEAeR2lw==", "Copy", "3")
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
EndIf


1284:MGR_MTR_ProcessMeteringResponse clears proper KIDs data
If(WMDRMSupported)
TestDRM_Manager_Initialize()
TestDRM_Manager_AddMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_Manager_GenerateMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", "pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_Manager_AddMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", "37HRLgAfR0G4fVSEAeR2lw==", "Copy", "3")
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GenerateMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", "pIKx8Wsy5aYRQN8LLIIcTQ==", "37HRLgAfR0G4fVSEAeR2lw==", "Copy", "3")
EndIf


1285:MGR_MTR_ProcessMeteringResponse clears proper action data
If(WMDRMSupported)
TestDRM_Manager_Initialize()
TestDRM_Manager_AddMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_Manager_GenerateMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", "pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_Manager_AddMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Copy", "3")
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GenerateMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=")
EndIf


12604:Partial metering 200KIDs with 16K buffer
If(WMDRMSupported)
Test_SetRandomSeed( RANDOM )
TestDRM_Manager_Initialize()
TestDRM_Manager_AddManyMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", 200)
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", NULL, 16384)
EndIf


12605:Partial metering intermixed 4 metercert each with 200 KIDs with 16K buffer
If(WMDRMSupported)
Test_SetRandomSeed( RANDOM )
TestDRM_Manager_Initialize()
TestDRM_Manager_AddManyMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", 50)
TestDRM_Manager_AddManyMeteringData("EXchRPpxP2YvGZR1d1OKKA==", 50)
TestDRM_Manager_AddManyMeteringData("3IKx8Wsy5aYRQN8LLIIcTQ==", 50)
TestDRM_Manager_AddManyMeteringData("4IKx8Wsy5aYRQN8LLIIcTQ==", 50)

TestDRM_Manager_AddManyMeteringData("EXchRPpxP2YvGZR1d1OKKA==", 50)
TestDRM_Manager_AddManyMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", 50)
TestDRM_Manager_AddManyMeteringData("4IKx8Wsy5aYRQN8LLIIcTQ==", 50)
TestDRM_Manager_AddManyMeteringData("3IKx8Wsy5aYRQN8LLIIcTQ==", 50)

TestDRM_Manager_AddManyMeteringData("3IKx8Wsy5aYRQN8LLIIcTQ==", 50)
TestDRM_Manager_AddManyMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", 50)
TestDRM_Manager_AddManyMeteringData("EXchRPpxP2YvGZR1d1OKKA==", 50)
TestDRM_Manager_AddManyMeteringData("4IKx8Wsy5aYRQN8LLIIcTQ==", 50)

TestDRM_Manager_AddManyMeteringData("4IKx8Wsy5aYRQN8LLIIcTQ==", 50)
TestDRM_Manager_AddManyMeteringData("EXchRPpxP2YvGZR1d1OKKA==", 50)
TestDRM_Manager_AddManyMeteringData("3IKx8Wsy5aYRQN8LLIIcTQ==", 50)
TestDRM_Manager_AddManyMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", 50)

TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert3.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert3.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert2.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert2.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert4.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert4.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")

TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert2.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert2.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert3.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert3.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert4.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert4.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")

TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert4.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert4.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert4.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert4.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert3.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert3.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert3.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert3.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")

TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert2.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert2.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert2.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert2.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")

TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert2.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert2.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert3.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert3.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert4.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert4.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")

TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert2.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert2.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert3.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert3.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert4.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", 16384)
TestDRM_Manager_ProcessMeterResponse(files\\metercert4.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml")

TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=",  NULL, 16384)
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert2.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", NULL, 16384)
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert3.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", NULL, 16384)
TestDRM_Manager_GeneratePartialMeterChallenge(files\\metercert4.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", NULL, 16384)
EndIf


11855:DRM_Manager_ProcessMeterResponse - Response signed with wrong key
If(WMDRMSupported)
TestDRM_Manager_Initialize()
TestDRM_Manager_AddMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_Manager_GenerateMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", "pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "dsml2vSSmIIkNScihY5niY95fSQ=", "files\\response.xml") = 0X8004A013( DRM_E_INVALID_METERRESPONSE_SIGNATURE )
EndIf


12609:Verify TID accuracy if meter challenge is interrupted before processing
If(WMDRMSupported)
TestDRM_Manager_Initialize()
TestDRM_Manager_AddMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_Manager_GenerateMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response.xml", "pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_Manager_GenerateMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response1.xml", "pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_VerifyTID("files\\response.xml", "files\\response1.xml", TRUE)
TestDRM_Manager_ProcessMeterResponse(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response1.xml")
TestDRM_Manager_AddMeteringData("pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_Manager_GenerateMeterChallenge(files\\metercert.xml, "lVvvpn!q4bMJi!BosMpAPZ9IERg=", "files\\response2.xml", "pIKx8Wsy5aYRQN8LLIIcTQ==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_VerifyTID("files\\response.xml", "files\\response2.xml", FALSE)
EndIf


30003:DRT:P0:TestDRM_MTR_GenerateMeterCertChallenge
TestDRM_Manager_Initialize()
TestDRM_MTR_GenerateMeterCertChallenge("pIKx8Wsy5aYRQN8LLIIcTQ==", "Hello World")

30005:TestDRM_MTR_GenerateMeterCertChallenge with null custom data
TestDRM_Manager_Initialize()
TestDRM_MTR_GenerateMeterCertChallenge("pIKx8Wsy5aYRQN8LLIIcTQ==", NULL)

30006:TestDRM_MRT_GenerateMeterCertChallenge with null MID
TestDRM_Manager_Initialize()
TestDRM_MTR_GenerateMeterCertChallenge(NULL, "Hello World") = 0x80070057 (DRM_E_INVALIDARG)

40100:TestDRM_Manager_GenerateMeterChallengeV3 NULL APP context
TestDRM_Manager_Initialize()
TestDRM_Manager_AddMeteringData("wi3CyaMTD0W24xGQrxEiFg==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_Manager_AddMeteringData("wi3CyaMTD0W24xGQrxEiFg==", "27HRLgAfR0G4FVSEAeR2lw==", "Play1", "4")
TestDRM_Manager_GenerateMeterChallengeV3(NULL, "files\\binmetercert1.dat", "Hello World", NORMAL, NORMAL, NORMAL) = 0x80070057

40101:TestDRM_Manager_GenerateMeterChallengeV3 NULL Meter Cert
TestDRM_Manager_Initialize()
TestDRM_Manager_AddMeteringData("wi3CyaMTD0W24xGQrxEiFg==", "27HRLgAfR0G4fVSEAeR2lw==", "Play", "2")
TestDRM_Manager_AddMeteringData("wi3CyaMTD0W24xGQrxEiFg==", "27HRLgAfR0G4FVSEAeR2lw==", "Play1", "4")
TestDRM_Manager_GenerateMeterChallengeV3(NORMAL, NULL, "Hello World", NORMAL, NORMAL, NORMAL) = 0x80070057


------------------- Metering BVT ends here--------------------------

