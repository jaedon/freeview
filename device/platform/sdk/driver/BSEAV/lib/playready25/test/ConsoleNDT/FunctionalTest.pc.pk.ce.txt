1045: Successful initialization
Test_DRM_PFD_Initialize

1058: Sucessful initialization and uninitialization
Test_DRM_PFD_Initialize
Test_DRM_PFD_Uninitialize()

1359: initialize with NULL context
Test_SetpPfdDrmContext(0)
Test_DRM_PFD_Initialize=-2147024809(DRM_E_INVALIDARG)

1087: initialize with NULL device store name
Test_DRM_PFD_Initialize(NULL)=-2147024809(DRM_E_INVALIDARG)

1550: Successful registration request
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_ProcessRequest()

1108: Registration request with NULL context
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_SetpPfdDrmContext(0)
Test_Drm_Pfd_Registration_ProcessRequest()=-2147024809(DRM_E_INVALIDARG)

1117: Registration request with invalid certificate
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(invalid_cert.crt)
Test_Drm_Pfd_Registration_ProcessRequest()=0X8004C035 DRM_E_INVALID_CERTIFICATE
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()=0x8004CE04 DRM_E_ND_INVALID_SESSION

1123: Successful registration request and response
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()

1476: Registration response with NULL context
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetpPfdDrmContext(0)
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()=-2147024809(DRM_E_INVALIDARG)

1129: Registration response with bad private key
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKey(invalid_ansi_rsa_key.bin)=-2147024809(DRM_E_INVALIDARG)

1646: Registration response with bad transaction id
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetTransactionID(0)
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()=0x8004CE04 DRM_E_ND_INVALID_SESSION

1649: Registration Response in improper sequence
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()=0x8004CE04 DRM_E_ND_INVALID_SESSION

1134: Registration response with small buffer
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_SetcbRegistrationResponseMsg(1)
Test_Drm_Pfd_Registration_GenerateResponse()=-2147024774(DRM_E_BUFFERTOOSMALL)

1652: Re-Registration
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Drm_Pfd_Registration_ProcessRequest()
Test_Drm_Pfd_Registration_GenerateResponse()

1654: NULL pointer for pbRegistrationResponseMsg
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_SetpbRegistrationResponseMsgNULL()
Test_Drm_Pfd_Registration_GenerateResponse()=-2147024809)(DRM_E_INVALIDARG)

1656: WmdrmNetValidateMessage with un-unpackable message type
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetcbRegistrationRequestMsg(1)
Test_Drm_Pfd_Registration_ProcessRequest()=0x8004CE09 DRM_E_ND_BAD_REQUEST

1658: WmdrmNetValidateMessage with un-unpackable serial number
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetcbRegistrationRequestMsg(3)
Test_Drm_Pfd_Registration_ProcessRequest()=0x8004CE09 DRM_E_ND_BAD_REQUEST

1660: WmdrmNetValidateMessage with un-unpackable certificate size
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetcbRegistrationRequestMsg(19)
Test_Drm_Pfd_Registration_ProcessRequest()=0x8004CE09 DRM_E_ND_BAD_REQUEST

1662: WmdrmNetValidateMessage with un-unpackable certificate
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetcbRegistrationRequestMsg(23)
Test_Drm_Pfd_Registration_ProcessRequest()=0x8004CE09 DRM_E_ND_BAD_REQUEST

1664: WmdrmNetValidateMessage with incorrect protocol version
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetMessageProtocolVersion(1)
Test_Drm_Pfd_Registration_ProcessRequest()=0x8004CE09 DRM_E_ND_BAD_REQUEST

1666: WmdrmNetValidateMessage with incorrect message type
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetMessageType(99)
Test_Drm_Pfd_Registration_ProcessRequest()=0x8004CE09 DRM_E_ND_BAD_REQUEST

1668: Registration with alternate certificate
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert2.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey2.bin)
Test_Drm_Pfd_Registration_GenerateResponse()

1670: Registration with bad certificate signature 1
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(DeviceTestCert_badsig1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()=0X8004C035 DRM_E_INVALID_CERTIFICATE
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()=0x8004CE04 DRM_E_ND_INVALID_SESSION

1672: Registration with bad certificate signature 2
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(DeviceTestCert_badsig2.crt)
Test_Drm_Pfd_Registration_ProcessRequest()=0X8004C035 DRM_E_INVALID_CERTIFICATE
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()=0x8004CE04 DRM_E_ND_INVALID_SESSION

1860: Registration with bad certificate signature 3
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(DeviceTestCert_badsig3.crt)
Test_Drm_Pfd_Registration_ProcessRequest()=0X8004C035 DRM_E_INVALID_CERTIFICATE
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()=0x8004CE04 DRM_E_ND_INVALID_SESSION

1674: Registration with zero length certificate
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetcbCertificate(1)
Test_Drm_Pfd_Registration_ProcessRequest()=0X8004C035 DRM_E_INVALID_CERTIFICATE
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()=0x8004CE04 DRM_E_ND_INVALID_SESSION

1676: Registration, not revoked
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetRevocationList(WMDRMNET,files\crl_wmdrmnd_5.b64)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()

1679: Registration, leaf-license revoked
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetRevocationList(WMDRMNET,files\crl_wmdrmnd_8.b64)
Test_Drm_Pfd_Registration_ProcessRequest()=0x8004C053 DRM_E_CERTIFICATE_REVOKED
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()=0x8004CE04 DRM_E_ND_INVALID_SESSION

1682: Registration, Newer revocation list replaces old one
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetRevocationList(WMDRMNET,files\crl_wmdrmnd_5.b64)
Test_SetRevocationList(WMDRMNET,files\crl_wmdrmnd_8.b64)
Test_Drm_Pfd_Registration_ProcessRequest()=0x8004C053 DRM_E_CERTIFICATE_REVOKED
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()=0x8004CE04 DRM_E_ND_INVALID_SESSION

1685: Registration, non leaf-license revoked
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetRevocationList(WMDRMNET,files\crl_wmdrmnd_6.b64)
Test_Drm_Pfd_Registration_ProcessRequest()=0x8004C053 DRM_E_CERTIFICATE_REVOKED
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()=0x8004CE04 DRM_E_ND_INVALID_SESSION

1483: Successful proximity
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)

1237: Proximity challenge with null context
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_SetpPfdDrmContext(0)
Test_Drm_Pfd_Proximity_GenerateChallenge()=-2147024809(DRM_E_INVALIDARG)

1242: Proximity challenge with bad transaction id
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_SetTransactionID(0)
Test_Drm_Pfd_Proximity_GenerateChallenge()=0x8004CE04 DRM_E_ND_INVALID_SESSION

1248: Proximity challenge in improper sequence
Test_DRM_PFD_Initialize
Test_Drm_Pfd_Proximity_GenerateChallenge()=0x8004CE04 DRM_E_ND_INVALID_SESSION

1254: Proximity fails because it took too long
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Drm_Pfd_Proximity_GenerateChallenge()
Test_Sleep(100)
Test_Drm_Pfd_Proximity_ProcessResponse()=0x8004CE06 DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY

1259: Proximity with bad nonce
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_SetNonce(0, 1, 2, 3)
Test_Drm_Pfd_Proximity_GenerateChallenge()
Test_Drm_Pfd_Proximity_ProcessResponse()=0x8004CE07 DRM_E_ND_INVALID_PROXIMITY_RESPONSE

1517: Proximity Response with NULL context
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Drm_Pfd_Proximity_GenerateChallenge()
Test_SetpPfdDrmContext(0)
Test_Drm_Pfd_Proximity_ProcessResponse()=-2147024809(DRM_E_INVALIDARG)

1521: Proximity Response with bad transaction id
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Drm_Pfd_Proximity_GenerateChallenge()
Test_SetTransactionID(0)
Test_Drm_Pfd_Proximity_ProcessResponse()=0x8004CE04 DRM_E_ND_INVALID_SESSION

1526: Proximity Response in improper sequence
Test_DRM_PFD_Initialize
Test_Drm_Pfd_Proximity_ProcessResponse()=0x8004CE04 DRM_E_ND_INVALID_SESSION

1487: Too much time between registration and proximity challenge
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Sleep(REGISTRATION_TIMEOUT)
Test_Drm_Pfd_Proximity_GenerateChallenge()=0x8004A000 DRM_E_DEVICE_NOT_REGISTERED

1491: Proximity challenge which is just under cut off time
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Drm_Pfd_Proximity_GenerateChallenge()
Test_Sleep(0)
Test_Drm_Pfd_Proximity_ProcessResponse()

1495: Successful proximity challenge after a few initial failures
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Drm_Pfd_Proximity_GenerateChallenge()
Test_Sleep(15)
Test_Drm_Pfd_Proximity_ProcessResponse()=0x8004CE06 DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY
Test_Drm_Pfd_Proximity_GenerateChallenge()
Test_Sleep(15)
Test_Drm_Pfd_Proximity_ProcessResponse()=0x8004CE06 DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY
Test_Drm_Pfd_Proximity_GenerateChallenge()
Test_Sleep(15)
Test_Drm_Pfd_Proximity_ProcessResponse()=0x8004CE06 DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY
Test_Drm_Pfd_Proximity_GenerateChallenge()
Test_Drm_Pfd_Proximity_ProcessResponse()

1500: Successful proximity challenge after a few "dropped messages"
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Drm_Pfd_Proximity_GenerateChallenge()
Test_Drm_Pfd_Proximity_GenerateChallenge()
Test_Drm_Pfd_Proximity_GenerateChallenge()
Test_Drm_Pfd_Proximity_GenerateChallenge()
Test_Drm_Pfd_Proximity_ProcessResponse()

1511: Proximity challenge just above cutoff threshold
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Drm_Pfd_Proximity_GenerateChallenge()
Test_Sleep(8)
Test_Drm_Pfd_Proximity_ProcessResponse()=0x8004CE06 DRM_E_ND_UNABLE_TO_VERIFY_PROXIMITY

1137: Successful open media session
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_Aavt_CloseMediaSession()


1142: Verify DRM status - license available
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_CheckdwControlCapabilities(0)
Test_CheckdwDRMStatus(1)
Test_CheckdwLicenseStatus(1)
Test_CheckdwDeliveryOptions(1)
Test_Drm_Pfd_Aavt_CloseMediaSession()


1001: Verify DRM status - license available but it is blocked for ndt because it is scalable
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerCreateXMRLicenseFromPool( ROOT, LiveTVLicenses.xml, "NDT_Root 2 6 12" )
TestManagerCreateXMRLicenseFromPool( LEAF, LiveTVLicenses.xml, "NDT_Leaf 6" )
TestManagerGenerateXMRResponse( LEAF, ROOT)
TestManagerProcessResponse( Dump, Dump, 0, 0 )
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_CheckdwControlCapabilities(0)
Test_CheckdwDRMStatus(1)
Test_CheckdwLicenseStatus(0)
Test_CheckdwDeliveryOptions(0)
Test_Drm_Pfd_Aavt_CloseMediaSession()

1149: Verify DRM status - license unavailable
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz2.wma,1,47361,jazz2output.wma)
Test_CheckdwDRMStatus(1)
Test_CheckdwLicenseStatus(0)
Test_CheckdwDeliveryOptions(0)
Test_Drm_Pfd_Aavt_GetAllDataBlocks(4096)
Test_CheckLastDataBlock()
Test_Drm_Pfd_Aavt_CloseMediaSession()
' Check that jazz2output.wma matches jazz2.wma as is without any encryption or decryption.

1155: Open media session with NULL context
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_SetpPfdDrmContext(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)=-2147024809(DRM_E_INVALIDARG)


1162: Open media session without registering
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)


1184: Open media session with non-existent file
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(file_does_not_exist.wma,0,47361,jazz1output.wma)=0x8003006E DRM_E_FILEOPEN

1190: Open media session when revalidation time has expired
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Sleep(VALIDATION_TIMEOUT)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)=0x8004CE00 DRM_E_ND_MUST_REVALIDATE


1195: Close media session with NULL context
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_SetpPfdDrmContext(0)
Test_Drm_Pfd_Aavt_CloseMediaSession()=-2147024809(DRM_E_INVALIDARG)


1209: Close media session with invalid media session id
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_SetdwMediaSessionID(1234)
Test_Drm_Pfd_Aavt_CloseMediaSession()=0x8004CE04 DRM_E_ND_INVALID_SESSION


1227: Verify DRM status - unprotected content, no license available
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.wma,1,47361,jazz_clearoutput.wma)
Test_CheckdwControlCapabilities(0)
Test_CheckdwDRMStatus(0)
Test_CheckdwLicenseStatus(0)
Test_CheckdwDeliveryOptions(0)
Test_Drm_Pfd_Aavt_CloseMediaSession()

1232: Open media session protected content when another session is already open with force
SkipTestIf(!WMDRMSupported)
'Adding license for jazz1.wma
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
'Add license for jazz2.wma
TestManagerAddLicenseToResponse(7VUynQnO1kSIh5PA7asPfA==,{1CB8F9A7-AEA1-4B10-9A5C-BEB1B3D3F8D1},64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (machine.datetime > #20141125Z#)?(secstate.deleted=1;deletelicense();0):(!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)) && (machine.datetime <= #20141125Z#?1:(secstate.drmreason=1;0)))  ]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,0,47361,jazz1output.wma)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz2.wma,1,47361,jazz2output.wma)
Test_Drm_Pfd_Aavt_CloseMediaSession()


1687: Get License
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_CloseMediaSession()


1690: Process license request with NULL context
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_SetpPfdDrmContext(0)
Test_Drm_Pfd_License_ProcessRequest(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=-2147024809(DRM_E_INVALIDARG)


1863: Get license response with NULL context
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_SetpPfdDrmContext(0)
Test_Drm_Pfd_License_GenerateResponse()=-2147024809(DRM_E_INVALIDARG)


1693: Get license for unprotected content
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.wma,1,47361,jazz_clear_output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)=0x8004C013 DRM_E_LICENSE_NOT_FOUND

1696: License request with improper message
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_SetcbLicenseRequestMsg(1)
Test_Drm_Pfd_License_ProcessRequest(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=0x8004CE09 DRM_E_ND_BAD_REQUEST


1699: License request with bad media session id
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_SetdwMediaSessionID(1234)
Test_Drm_Pfd_License_ProcessRequest(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=0x8004CE04 DRM_E_ND_INVALID_SESSION


1702: License request with bad serial number
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_Drm_Pfd_License_ProcessRequest(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=0x8004A000 DRM_E_DEVICE_NOT_REGISTERED


1705: License request with non matching certificate
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_SetCertificate(invalid_cert.crt)
Test_Drm_Pfd_License_ProcessRequest(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=0x8004A000 DRM_E_DEVICE_NOT_REGISTERED


1709: License request with case-sensitive action
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(08544947f9b8c4b47ad6aaca3d39e7c2, PlAy)


1712: License request with invalid action
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(08544947f9b8c4b47ad6aaca3d39e7c2, NOTAREALACTION)=0x8004CE09 DRM_E_ND_BAD_REQUEST


1865: License response with bad media session id
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_SetdwMediaSessionID(1234)
Test_Drm_Pfd_License_GenerateResponse()=0x8004CE04 DRM_E_ND_INVALID_SESSION


1715: License response in improper sequence
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_GenerateResponse()=0x8004CE09 DRM_E_ND_BAD_REQUEST


1555: License response in improper sequence
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_SetcbLicenseResponseMsg(1)
Test_Drm_Pfd_License_GenerateResponse()=-2147024774(DRM_E_BUFFERTOOSMALL)


1719: License request when revalidation time has expired
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Sleep(VALIDATION_TIMEOUT)
Test_Drm_Pfd_License_ProcessRequest(08544947f9b8c4b47ad6aaca3d39e7c2, Play)=0x8004CE00 DRM_E_ND_MUST_REVALIDATE


1722: NULL pointer for pbLicenseResponseMsg
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_SetpbLicenseResponseMsgNULL()
Test_SetcbLicenseResponseMsg(0)
Test_Drm_Pfd_License_GenerateResponse()=-2147024774(DRM_E_BUFFERTOOSMALL)


1725: Get License for content with high minimum security level
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 2000?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz8.wma,1,47361,jazz8output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)=0x8004C013 DRM_E_LICENSE_NOT_FOUND


1728: Get License for content with OPL > 100
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><RESTRICTIONS><UNCOMPRESSEDDIGITALVIDEO level=\"125\"/><UNCOMPRESSEDDIGITALAUDIO level=\"125\"/></RESTRICTIONS><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>",7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()


1731: Get License for content with analog audio/video > 100
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><RESTRICTIONS><ANALOGVIDEO level=\"125\"/></RESTRICTIONS><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>",7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()


1734: Verify Device Key
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_CheckDeviceKey(files\device_public_key.bin)


1736: Verify SettingsObject
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_CheckSettingsObject(1)


1738: Verify failure of Drm_Pfd_License_GenerateResponse with NULL p and cb != 0
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_SetpbLicenseResponseMsgNULL()
Test_Drm_Pfd_License_GenerateResponse()=-2147024809(DRM_E_INVALIDARG)


1740: Verify Source ID
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS,"<INCLUSIONLIST><GUID>{00000507-0009-0010-8000-00AA006D2EA4}</GUID><GUID>{00000508-0009-0010-8000-00AA006D2EA5}</GUID></INCLUSIONLIST><SOURCEID>3</SOURCEID><ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_CheckSourceID(3)


1743: Verify Inclusion List
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS,"<INCLUSIONLIST><GUID>{00000507-0009-0010-8000-00AA006D2EA4}</GUID><GUID>{00000508-0009-0010-8000-00AA006D2EA5}</GUID></INCLUSIONLIST><SOURCEID>3</SOURCEID><ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(08544947f9b8c4b47ad6aaca3d39e7c2, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_CheckInclusionList({00000507-0009-0010-8000-00AA006D2EA4},{00000508-0009-0010-8000-00AA006D2EA5})


1560: Transfer file - do not get license, just transfer
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_CheckdwDRMStatus(1)
Test_CheckdwLicenseStatus(1)
Test_CheckdwDeliveryOptions(1)
Test_Drm_Pfd_Aavt_GetAllDataBlocks(4096)
Test_CheckLastDataBlock()
Test_Drm_Pfd_Aavt_CloseMediaSession()
' Check that jazz1output.wma matches jazz1.wma as is without any encryption or decryption.


1565: Get License Transfer file
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(4096)
Test_Drm_Pfd_Aavt_CloseMediaSession()


1570: Get next data block with bad media session id
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(edd00d00faced00d00faced00d00face)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_SetdwMediaSessionID(1234)
Test_Drm_Pfd_Aavt_GetNextDataBlock(4096)=0x8004CE04 DRM_E_ND_INVALID_SESSION


1575: Transfer file - clear content, no registration required
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.wma,1,47361,jazz_clear_output.wma)
Test_Drm_Pfd_Aavt_GetAllDataBlocks(4096)
Test_CheckLastDataBlock()
Test_Drm_Pfd_Aavt_CloseMediaSession()

1580: Transfer data after session is closed
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(4096)
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_Drm_Pfd_Aavt_GetNextDataBlock(4096)=0x8004CE04 DRM_E_ND_INVALID_SESSION


1585: Transfer file protected content (play forever license)
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetAllDataBlocks(4096)
Test_CheckLastDataBlock()
Test_Drm_Pfd_Aavt_CloseMediaSession()
' A decrypted Jazz1output.wma should match jazz_clear.wma at this point.


1590: Transfer file protected content (play count license)
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[ secstate.PlayCount > 0  ]]></CONDITION><ACTION><![CDATA[ secstate.PlayCount--;(secstate.PlayCount <= 0)?(secstate.deleted=1;deletelicense();0):0  ]]></ACTION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT><ONSTORE><ACTION><![CDATA[ !exists(secstate.PlayCount)?secstate.PlayCount=5:0;!exists(secstate.BeginPlayCount)?secstate.BeginPlayCount=5:0;!exists(secstate.MinAppSecLevel)?secstate.MinAppSecLevel=150:0  ]]></ACTION></ONSTORE>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetAllDataBlocks(4096)
Test_CheckLastDataBlock()
Test_Drm_Pfd_Aavt_CloseMediaSession()


1595: Transfer file protected content (metered license)
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<MID>pIKx8Wsy5aYRQN8LLIIcTQ==</MID><ONACTION type=\"Play\"><CONDITION><![CDATA[ secstate.PlayCount > 0  ]]></CONDITION><ACTION><![CDATA[ secstate.PlayCount--;(secstate.PlayCount <= 0)?(secstate.deleted=1;deletelicense();0):0  ]]></ACTION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT><ONSTORE><ACTION><![CDATA[ !exists(secstate.PlayCount)?secstate.PlayCount=5:0;!exists(secstate.BeginPlayCount)?secstate.BeginPlayCount=5:0;!exists(secstate.MinAppSecLevel)?secstate.MinAppSecLevel=150:0  ]]></ACTION></ONSTORE>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetAllDataBlocks(4096)
Test_CheckLastDataBlock()
Test_Drm_Pfd_Aavt_CloseMediaSession()


1600: Transfer file protected content (OPL license)
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><RESTRICTIONS><ANALOGVIDEO level=\"200\"/></RESTRICTIONS><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>",7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetAllDataBlocks(4096)
Test_CheckLastDataBlock()
Test_Drm_Pfd_Aavt_CloseMediaSession()


1746: Transfer file and revalidate during the transfer
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(4096)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_GetNextDataBlock(4096)
Test_Drm_Pfd_Aavt_CloseMediaSession()


1605: Transfer file clear content and verify not transcrypted
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.wma,1,47361,jazz_clearoutput.wma)
Test_Drm_Pfd_Aavt_GetAllDataBlocks(4096)
Test_CheckLastDataBlock()
Test_Drm_Pfd_Aavt_CloseMediaSession()
' Check that jazz_clearoutput.wma matches jazz_clear.wma as is without any encryption or decryption.

1610: Transfer file protected content and verify not transcrypted
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header2.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(7VUynQnO1kSIh5PA7asPfA==,{1CB8F9A7-AEA1-4B10-9A5C-BEB1B3D3F8D1}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (machine.datetime > #20141125Z#)?(secstate.deleted=1;deletelicense();0):(!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>",7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz2.wma,1,47361,jazz2output.wma)
Test_Drm_Pfd_Aavt_GetAllDataBlocks(4096)
Test_CheckLastDataBlock()
Test_Drm_Pfd_Aavt_CloseMediaSession()
' Check that jazz2output.wma matches jazz2.wma as is without any encryption or decryption.


1615: Transfer file protected content with tiny block size
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetAllDataBlocks(256)
Test_Drm_Pfd_Aavt_CloseMediaSession()
' A decrypted Jazz1output.wma should match jazz_clear.wma at this point.


1620: Transfer file clear content with tiny block size
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.wma,1,47361,jazz_clearoutput.wma)
Test_Drm_Pfd_Aavt_GetAllDataBlocks(256)
Test_CheckLastDataBlock()
Test_Drm_Pfd_Aavt_CloseMediaSession()
' Check that jazz_clearoutput.wma matches jazz_clear.wma as is without any encryption or decryption.

1749: Transfer file, let validation time out, revalidate, resume transfer
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(4096)
Test_Sleep(VALIDATION_TIMEOUT)
Test_Drm_Pfd_Aavt_GetNextDataBlock(4096)=0x8004CE00 DRM_E_ND_MUST_REVALIDATE
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_GetNextDataBlock(131070)
Test_Drm_Pfd_Aavt_CloseMediaSession()


1752: Transfer file and reregister during the transfer
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(4096)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_GetNextDataBlock(131070)
Test_Drm_Pfd_Aavt_CloseMediaSession()
' A decrypted Jazz1output.wma should match jazz_clear.wma at this point.


1755: Transfer file transcrypted content with large block size
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(131070)
Test_Drm_Pfd_Aavt_GetNextDataBlock(57899)
Test_CheckLastDataBlock()
Test_Drm_Pfd_Aavt_CloseMediaSession()
' A decrypted Jazz1output.wma should match jazz_clear.wma at this point.


1625: Transfer file protected but not transcrypted content with large block size
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header2.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(7VUynQnO1kSIh5PA7asPfA==,{1CB8F9A7-AEA1-4B10-9A5C-BEB1B3D3F8D1}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (machine.datetime > #20141125Z#)?(secstate.deleted=1;deletelicense();0):(!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>",7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz2.wma,1,47361,jazz2output.wma)
Test_Drm_Pfd_Aavt_GetAllDataBlocks(131070)
Test_CheckLastDataBlock()
Test_Drm_Pfd_Aavt_CloseMediaSession()
' Check that jazz2output.wma matches jazz2.wma as is without any encryption or decryption.


1630: Transfer file clear content with large block size
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.wma,1,47361,jazz_clearoutput.wma)
Test_Drm_Pfd_Aavt_GetAllDataBlocks(131070)
Test_CheckLastDataBlock()
Test_Drm_Pfd_Aavt_CloseMediaSession()
' Check that jazz_clearoutput.wma matches jazz_clear.wma as is without any encryption or decryption.

1634: Transfer file protected but not transcrypted content with tiny block size
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header2.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(7VUynQnO1kSIh5PA7asPfA==,{1CB8F9A7-AEA1-4B10-9A5C-BEB1B3D3F8D1}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (machine.datetime > #20141125Z#)?(secstate.deleted=1;deletelicense();0):(!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>",7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz2.wma,1,47361,jazz2output.wma)
Test_Drm_Pfd_Aavt_GetAllDataBlocks(256)
Test_CheckLastDataBlock()
Test_Drm_Pfd_Aavt_CloseMediaSession()
' Check that jazz2output.wma matches jazz2.wma as is without any encryption or decryption.


1758: Play count license fails after play count runs out
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[ secstate.PlayCount > 0  ]]></CONDITION><ACTION><![CDATA[ secstate.PlayCount--;(secstate.PlayCount <= 0)?(secstate.deleted=1;deletelicense();0):0  ]]></ACTION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT><ONSTORE><ACTION><![CDATA[ !exists(secstate.PlayCount)?secstate.PlayCount=5:0;!exists(secstate.BeginPlayCount)?secstate.BeginPlayCount=5:0;!exists(secstate.MinAppSecLevel)?secstate.MinAppSecLevel=150:0  ]]></ACTION></ONSTORE>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(4096)
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(4096)
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(4096)
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(4096)
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(4096)
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)=0x8004C013 DRM_E_LICENSE_NOT_FOUND
Test_Drm_Pfd_Aavt_CloseMediaSession()


1761: Play count does not decrement when content is not played
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[ secstate.PlayCount > 0  ]]></CONDITION><ACTION><![CDATA[ secstate.PlayCount--;(secstate.PlayCount <= 0)?(secstate.deleted=1;deletelicense();0):0  ]]></ACTION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT><ONSTORE><ACTION><![CDATA[ !exists(secstate.PlayCount)?secstate.PlayCount=5:0;!exists(secstate.BeginPlayCount)?secstate.BeginPlayCount=5:0;!exists(secstate.MinAppSecLevel)?secstate.MinAppSecLevel=150:0  ]]></ACTION></ONSTORE>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_CloseMediaSession()


1765: Transfer file and reregister with different certificate during the transfer
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(4096)
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert2.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey2.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_GetNextDataBlock(131070)=0x8004CE04 DRM_E_ND_INVALID_SESSION
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetAllDataBlocks(4096)
Test_Drm_Pfd_Aavt_CloseMediaSession()
' A decrypted Jazz1output.wma should match jazz_clear.wma at this point.


1768: Transfer file mp3
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.mp3,1,12297,jazz1output.wma)
Test_CheckdwControlCapabilities(0)
Test_CheckdwDRMStatus(0)
Test_CheckdwLicenseStatus(0)
Test_CheckdwDeliveryOptions(0)
Test_Drm_Pfd_Aavt_GetAllDataBlocks(4096)
Test_CheckLastDataBlock()
Test_Drm_Pfd_Aavt_CloseMediaSession()
' Check that jazz1output.wma matches jazz1.wma as is without any encryption or decryption.

1772: Attempt transfer after failed license
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header2.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(7VUynQnO1kSIh5PA7asPfA==,{1CB8F9A7-AEA1-4B10-9A5C-BEB1B3D3F8D1}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (machine.datetime > #20041125Z#)?(secstate.deleted=1;deletelicense();0):(!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>",7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz2.wma,1,47361,jazz2output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)=0x8004C013 DRM_E_LICENSE_NOT_FOUND
Test_Drm_Pfd_Aavt_GetNextDataBlock(4096)=-2147467259(DRM_E_FAIL)
Test_Drm_Pfd_Aavt_CloseMediaSession()


1774: Transfer file unprotected content and reregister during the transfer
Test_DRM_PFD_Initialize
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.wma,1,47361,jazz_clearoutput.wma)
Test_Drm_Pfd_Aavt_GetNextDataBlock(4096)
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_GetNextDataBlock(131070)
Test_Drm_Pfd_Aavt_CloseMediaSession()
' Check that jazz_clearoutput.wma matches jazz_clear.wma as is without any encryption or decryption.

1776: Transfer a different file after a failed license
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[ secstate.PlayCount > 0  ]]></CONDITION><ACTION><![CDATA[ secstate.PlayCount--;(secstate.PlayCount <= 0)?(secstate.deleted=1;deletelicense();0):0  ]]></ACTION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT><ONSTORE><ACTION><![CDATA[ !exists(secstate.PlayCount)?secstate.PlayCount=5:0;!exists(secstate.BeginPlayCount)?secstate.BeginPlayCount=5:0;!exists(secstate.MinAppSecLevel)?secstate.MinAppSecLevel=150:0  ]]></ACTION></ONSTORE>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz2.wma,1,47361,jazz2output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)=0x8004C013 DRM_E_LICENSE_NOT_FOUND
Test_Drm_Pfd_Aavt_GetNextDataBlock(4096)=-2147467259(DRM_E_FAIL)
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetAllDataBlocks(4096)
Test_CheckLastDataBlock()
Test_Drm_Pfd_Aavt_CloseMediaSession()
' A decrypted Jazz1output.wma should match jazz_clear.wma at this point.


' Following test requires that jazz1.wma be used for this. A different file may produce incorrect result.
1638: Transfer file protected content with block size == exact file size
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(131070)
Test_Drm_Pfd_Aavt_GetNextDataBlock(57899)
Test_CheckLastDataBlock()
Test_Drm_Pfd_Aavt_CloseMediaSession()
' A decrypted Jazz1output.wma should match jazz_clear.wma at this point.


1778: Register with one certificate then register with another
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert2.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey2.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetAllDataBlocks(4096)
Test_CheckLastDataBlock()
Test_Drm_Pfd_Aavt_CloseMediaSession()
' A decrypted Jazz1output.wma should match jazz_clear.wma at this point.


6998: Check Decryption of a single packet
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_GetHeaders()
Test_Drm_Pfd_Aavt_GetNextDataBlock(PACKET, 0, jazz_clear.wma)
Test_Drm_Pfd_Aavt_CloseMediaSession()


6999: Check Decryption of all packets
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_GetHeaders()
Test_Drm_Pfd_Aavt_GetAllDataBlocks(PACKET, jazz_clear.wma)
Test_Drm_Pfd_Aavt_CloseMediaSession()


'NOTE: jazz1.wma must be used for the seeking tests
1782: Set current time position protected content
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(4500)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 4500)
Test_Drm_Pfd_Aavt_CloseMediaSession()


1785: Set current time position with NULL context
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_SetpPfdDrmContext(0)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(2000)=-2147024809(DRM_E_INVALIDARG)


1787: Set current time position with invalid media session id
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_SetdwMediaSessionID(1234)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(2000)=0x8004CE04 DRM_E_ND_INVALID_SESSION


1789: Set current time position before session is open
Test_DRM_PFD_Initialize
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(200000)= 0x8004CE04 DRM_E_ND_INVALID_SESSION

1791: Set current time position after session is closed
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.wma,1,47361,jazz_clear_output.wma)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_Drm_Pfd_Aavt_CloseMediaSession()
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(200000)= 0x8004CE04 DRM_E_ND_INVALID_SESSION

1793: Seek command immediately after open media session unprotected content
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.wma,1,47361,jazz_clear_output.wma)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(2000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 2000)
Test_Drm_Pfd_Aavt_CloseMediaSession()

1795: Seek command immediately after open media session protected content
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(2000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 2000)
Test_Drm_Pfd_Aavt_CloseMediaSession()


1797: Seek command immediately after license acquisition protected content
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(2000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 2000)
Test_Drm_Pfd_Aavt_CloseMediaSession()


1799: Seek command before license acquisition and then acquire license
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(2000)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 2000)
Test_Drm_Pfd_Aavt_CloseMediaSession()


1801: Set current time position to middle of file unprotected content
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(5000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 5000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(131070)
Test_Drm_Pfd_Aavt_CloseMediaSession()

1803: Set current time position to middle of file protected content
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(5000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 5000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(131070)
Test_Drm_Pfd_Aavt_CloseMediaSession()


1805: Set current time position to start of file protected content
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(0)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 0)


1807: Set current time position to start of file unprotected content
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.wma,1,47361,jazz_clear_output.wma)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(0)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 0)

1809: Set current time position 1 second protected content
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(1000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 1000)


1811: Set current time position 1 second unprotected content
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.wma,1,47361,jazz_clear_output.wma)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(1000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 1000)

1813: Set current time position 1 second from end of file protected content
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(10000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(2048, 10000)


1815: Set current time position 1 second from end of file unprotected content
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.wma,1,47361,jazz_clear_output.wma)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(10000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 10000)

1817: Jump current time position around a bit protected content
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(8000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 8000)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(5000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 5000)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(2000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 2000)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_Drm_Pfd_Aavt_CloseMediaSession()


1819: Jump current time position around a bit unprotected content
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(8000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 8000)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(5000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 5000)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(2000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 2000)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_Drm_Pfd_Aavt_CloseMediaSession()

1821: Jump current time position around a bit protected content
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(8000)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(5000)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(2000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 2000)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_Drm_Pfd_Aavt_CloseMediaSession()


1823: Jump current time position around a bit unprotected content
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(8000)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(5000)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(2000)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192, 2000)
Test_CheckLastDataBlock()=-2147467259(DRM_E_FAIL)
Test_Drm_Pfd_Aavt_CloseMediaSession()

1825: Set current time position past end of file protected content
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(200000)=0x8004CE09 DRM_E_ND_BAD_REQUEST
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_Drm_Pfd_Aavt_CloseMediaSession()


1827: Set current time position past end of file unprotected content
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(200000)=0x8004CE09 DRM_E_ND_BAD_REQUEST
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_Drm_Pfd_Aavt_CloseMediaSession()

1954: Set current time position to a negative value
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(-1)=0x8004CE09 DRM_E_ND_BAD_REQUEST
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_Drm_Pfd_Aavt_CloseMediaSession()

7073: Set current time position to an arbitrarily large value
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz_clear.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(4000000000)=0x8004CE09 DRM_E_ND_BAD_REQUEST
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_Drm_Pfd_Aavt_CloseMediaSession()

7100: Set current time position to exact end of file
SkipTestIf(!WMDRMSupported)
TestManagerSetRights(Play)
TestManagerSetHeader(NORMAL,header1.xml)
TestManagerInitResponse
TestManagerAddLicenseToResponse(vqvqngd40kuu9FnnqNrt7Q==,{E28E8B13-3E37-4DC6-8563-CC72CBCDDE91}, 64 OP_LICGEN_NO_DEFAULT_RIGHTS, "<ONACTION type=\"Play\"><CONDITION><![CDATA[1]]></CONDITION></ONACTION><ONSELECT><CONDITION><![CDATA[ (!exists(secstate.deleted) && (app.minseclevel >= 150?1:(secstate.drmreason=3;0)))]]></CONDITION></ONSELECT>", 7BZ*gTLq*LKyT3GcIWH8d5JkWiklMf7Aod!lhBgJpcTRu!chtojzMg==,zWVMVj8hZun5DyUU38zET5B1E4sl6QsmPIrqzkDP)
TestManagerGenerateResponse
TestManagerProcessResponse(Dump,Dump,0,0)
Test_DRM_PFD_Initialize
Test_SetSerialNumber(ABCDEF0123456789ABCDEF0123456789)
Test_SetCertificate(files\DeviceTestCert1.crt)
Test_Drm_Pfd_Registration_ProcessRequest()
Test_SetPrivateKeyDirectly(files\DeviceRSAPrivKey1.bin)
Test_Drm_Pfd_Registration_GenerateResponse()
Test_Proximity(0)
Test_Drm_Pfd_Aavt_OpenMediaSession(jazz1.wma,1,47361,jazz1output.wma)
Test_Drm_Pfd_License_ProcessRequest(AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, Play)
Test_Drm_Pfd_License_GenerateResponse()
Test_Drm_Pfd_Aavt_GetNextDataBlock(8192)
Test_Drm_Pfd_Aavt_SetCurrentTimePosition(10415)
Test_Drm_Pfd_Aavt_GetNextDataBlock(8196, 10415)


1642: Verify MTPStatus comes from correct HRESULT
Test_Drm_Pfd_GetMTPStatusFromDRMRESULT()

